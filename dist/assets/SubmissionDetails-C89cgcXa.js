import{c as Q,j as e,d as ne,B as me,r as k,_ as v,f as ie}from"./index-BIllfr20.js";import{r as g,b as xe}from"./router-GXfyPTrP.js";import{u as O,L as M,I as he,c as U,S as H,d as J,e as G,f as K,g as w,b as re}from"./useCustomQuery-kkihtKjO.js";import{B as f}from"./button-BjwHA_Ot.js";import{B as V}from"./badge-BHTVA8k8.js";import{F as W}from"./file-text-DSAM9nKx.js";import{C as I}from"./clock-CafZlDwP.js";import{C as A}from"./circle-alert-DAUss3-X.js";import{C as z}from"./circle-check-big-B5R14Zv0.js";import{C as q}from"./circle-x-D8AazdNT.js";import{U as Y}from"./user-DMZrfD0R.js";import{E as ue}from"./external-link-BO-O1ID7.js";import{f as C}from"./format-CWZx4aKk.js";import{D as Z,a as ee,b as se,c as te}from"./dialog-BFez96UF.js";import{C as ce}from"./chevron-right-CWFcGyHO.js";import{S as de}from"./square-pen-y_GftER1.js";import{C as P}from"./calendar-CqPZIdEc.js";import{U as je}from"./users-D9oLzyo7.js";import{B as ge}from"./book-Bpfj_trI.js";import{T as pe}from"./tag-DOl-dKHL.js";import{B as fe}from"./book-open-CxJ5VZxw.js";import"./axios-DmypytPv.js";/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=Q("ClipboardCheck",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=Q("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=Q("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);function b({className:s,...a}){return e.jsx("div",{className:ne("animate-pulse rounded-md bg-primary/10",s),...a})}const ve=()=>e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{className:"h-8 w-3/4"}),e.jsx(b,{className:"h-4 w-1/4"}),e.jsx(b,{className:"h-24 w-full"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(b,{className:"h-12 w-full"}),e.jsx(b,{className:"h-12 w-full"})]})]})}),ye={submitted:{color:"bg-blue-100 text-blue-800",icon:e.jsx(W,{className:"h-4 w-4"})},pending:{color:"bg-yellow-100 text-yellow-800",icon:e.jsx(I,{className:"h-4 w-4"})},under_review:{color:"bg-blue-100 text-blue-800",icon:e.jsx(A,{className:"h-4 w-4"})},accepted:{color:"bg-green-100 text-green-800",icon:e.jsx(z,{className:"h-4 w-4"})},rejected:{color:"bg-red-100 text-red-800",icon:e.jsx(q,{className:"h-4 w-4"})},revisions_required:{color:"bg-purple-100 text-purple-800",icon:e.jsx(W,{className:"h-4 w-4"})}},we=s=>{const a={color:"bg-gray-100 text-gray-800",icon:e.jsx(A,{className:"h-4 w-4"})};return s&&ye[s]||a},be=({author:s})=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[e.jsx(Y,{className:"h-5 w-5 mr-2 text-blue-600"}),"Author Information"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Name"}),e.jsx("p",{className:"text-gray-800",children:(s==null?void 0:s.fullName)||"Author information not available"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Email"}),e.jsx("p",{className:"text-gray-800",children:(s==null?void 0:s.email)||"Email not available"})]}),(s==null?void 0:s.affiliation)&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Affiliation"}),e.jsx("p",{className:"text-gray-800",children:s==null?void 0:s.affiliation})]})]})]}),Ce=({manuscriptUrl:s,manuscriptFile:a})=>{const l=r=>{window.open(r,"_blank")};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[e.jsx(W,{className:"h-5 w-5 mr-2 text-blue-600"}),"Files"]}),e.jsx("div",{className:"space-y-4",children:s?e.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-blue-100 rounded-full p-2",children:e.jsx(W,{className:"h-4 w-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-800",children:"Manuscript"}),e.jsx("p",{className:"text-xs text-gray-500",children:a||"manuscript.pdf"})]})]}),e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>l(`${me}/${a}`),children:e.jsx(ue,{className:"h-4 w-4"})})]})}):e.jsx("div",{className:"text-center py-4 text-gray-500",children:e.jsx("p",{children:"No files available"})})})]})},Re=({submission:s})=>{var i;const{reviewerAssignments:a=[],submissionDate:l,createdAt:r,status:d}=s||{};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[e.jsx(I,{className:"h-5 w-5 mr-2 text-blue-600"}),"Review Timeline"]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"relative pl-6 space-y-6 before:absolute before:left-2 before:top-0 before:h-full before:w-0.5 before:bg-gray-200",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -left-6 mt-1.5 h-3 w-3 rounded-full border-2 border-white bg-blue-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-blue-600",children:l?C(new Date(l),"MMM dd, yyyy"):""}),e.jsx("h3",{className:"text-sm font-medium text-gray-800",children:"SUBMISSION RECEIVED"}),((i=s==null?void 0:s.submittedBy)==null?void 0:i.fullName)&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Submitted by: ",s.submittedBy.fullName]})]})]}),(a==null?void 0:a.length)>0&&a.map((c,x)=>{var o;return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -left-6 mt-1.5 h-3 w-3 rounded-full border-2 border-white bg-blue-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-blue-600",children:c.commentedAt?C(new Date(c.commentedAt),"MMM dd, yyyy"):C(new Date,"MMM dd, yyyy")}),e.jsx("h3",{className:"text-sm font-medium text-gray-800",children:"REVIEWER ASSIGNED"}),((o=c.reviewer)==null?void 0:o.fullName)&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Reviewer: ",c.reviewer.fullName]}),c.comment&&e.jsxs("p",{className:"text-xs text-gray-600 mt-1 italic",children:['"',c.comment,'"']})]})]},x)}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -left-6 mt-1.5 h-3 w-3 rounded-full border-2 border-white bg-blue-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-blue-600",children:r?C(new Date(r),"MMM dd, yyyy"):""}),e.jsx("h3",{className:"text-sm font-medium text-gray-800",children:d?d.replace(/_/g," ").toUpperCase():"SUBMITTED"})]})]})]})})]})},Se=({reviewers:s,loading:a,open:l,onClose:r,onAssign:d})=>{const[i,c]=g.useState(null),[x,o]=g.useState(!1),p=async()=>{if(i){o(!0);try{await d(i)}finally{o(!1)}}};return e.jsx(Z,{open:l,onOpenChange:r,children:e.jsxs(ee,{children:[e.jsx(se,{children:e.jsx(te,{children:"Assign Reviewer"})}),a?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(L,{className:"h-6 w-6 animate-spin"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Select Reviewer"}),e.jsxs("select",{className:"w-full p-2 border rounded-md",value:i||"",onChange:n=>c(n.target.value),children:[e.jsx("option",{value:"",children:"Select a reviewer"}),s.map(n=>e.jsxs("option",{value:n._id,children:[n.fullName," (",n.email,")"]},n._id))]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(f,{variant:"outline",onClick:r,children:"Cancel"}),e.jsxs(f,{disabled:!i||x,onClick:p,children:[x?e.jsx(L,{className:"h-4 w-4 animate-spin mr-2"}):null,"Assign"]})]})]})]})})},D=g.forwardRef(({className:s,...a},l)=>e.jsx("textarea",{className:ne("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),ref:l,...a}));D.displayName="Textarea";const Me=({submissionId:s,onSuccess:a,onCancel:l,nextRoundNumber:r})=>{const[d,i]=g.useState(r),[c,x]=g.useState(""),o=O({}),p=async n=>{var t,h;n.preventDefault();try{const y=await o.mutateAsync({api:k.createReviewRound,data:{submissionId:s,roundNumber:d,editorNotes:c.trim()||void 0}});(t=y.data)!=null&&t.success?(v.success("Review round created successfully"),a()):v.error(((h=y.data)==null?void 0:h.message)||"Failed to create review round")}catch{v.error("Something went wrong while creating the review round")}};return e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"roundNumber",children:"Round Number"}),e.jsx(he,{id:"roundNumber",type:"number",value:d,onChange:n=>i(Number.parseInt(n.target.value)),min:1,required:!0})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"editorNotes",children:"Editor Notes (Optional)"}),e.jsx(D,{id:"editorNotes",value:c,onChange:n=>x(n.target.value),placeholder:"Add any notes for this review round",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(f,{type:"button",variant:"outline",onClick:l,children:"Cancel"}),e.jsxs(f,{type:"submit",disabled:o.isPending,children:[o.isPending&&e.jsx(L,{className:"h-4 w-4 mr-2 animate-spin"}),"Create Review Round"]})]})]})},ke={in_progress:{color:"bg-yellow-100 text-yellow-800",icon:e.jsx(I,{className:"h-4 w-4"})},completed:{color:"bg-green-100 text-green-800",icon:e.jsx(z,{className:"h-4 w-4"})},cancelled:{color:"bg-red-100 text-red-800",icon:e.jsx(q,{className:"h-4 w-4"})}},Ae=({submissionId:s,isAdmin:a,onSelectRound:l})=>{var n;const[r,d]=g.useState(!1),{data:i,isLoading:c,refetch:x}=U({api:`${(n=k)==null?void 0:n.getReviewRounds}?submissionId=${s}`,options:{enabled:!!s}}),o=(i==null?void 0:i.data)||[],p=()=>{d(!1),x()};return c?e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{className:"h-10 w-full"}),e.jsx(b,{className:"h-20 w-full"}),e.jsx(b,{className:"h-20 w-full"})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Review Rounds"}),a&&!r&&e.jsxs(f,{size:"sm",onClick:()=>d(!0),children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"New Round"]})]}),r&&e.jsx("div",{className:"mb-6 p-4 border border-gray-200 rounded-lg bg-gray-50",children:e.jsx(Me,{submissionId:s,onSuccess:p,onCancel:()=>d(!1),nextRoundNumber:o.length+1})}),o.length>0?e.jsx("div",{className:"space-y-3",children:o.map(t=>{const h=ke[t.status]||{color:"bg-gray-100 text-gray-800",icon:e.jsx(A,{className:"h-4 w-4"})};return e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>l(t._id),children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("h3",{className:"font-medium text-gray-800",children:["Round ",t.roundNumber]}),e.jsxs(V,{className:`${h.color} flex items-center gap-1`,children:[h.icon,t.status.replace("_"," ")]})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Started: ",C(new Date(t.startDate),"MMM dd, yyyy"),t.endDate&&` • Ended: ${C(new Date(t.endDate),"MMM dd, yyyy")}`]}),t.editorNotes&&e.jsxs("p",{className:"text-sm text-gray-600 mt-2 italic",children:['"',t.editorNotes,'"']})]}),e.jsx(ce,{className:"h-5 w-5 text-gray-400"})]})},t._id)})}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(I,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium mb-1",children:"No review rounds yet"}),e.jsx("p",{className:"text-sm",children:a?"Start the review process by creating a new review round.":"The review process has not started yet."})]})]})},Ee=({reviewRoundId:s,submissionId:a,onSuccess:l,onCancel:r})=>{const[d,i]=g.useState(""),[c,x]=g.useState(""),[o,p]=g.useState(""),n=O({}),t=async h=>{var y,R;if(h.preventDefault(),!d){v.error("Please select a recommendation");return}try{const u=await n.mutateAsync({api:k.createReview,data:{reviewRoundId:s,submissionId:a,recommendation:d,comments:c.trim()||void 0,confidentialComments:o.trim()||void 0,submissionDate:new Date().toISOString(),status:"completed"}});(y=u.data)!=null&&y.success?(v.success("Review submitted successfully"),l()):v.error(((R=u.data)==null?void 0:R.message)||"Failed to submit review")}catch{v.error("Something went wrong while submitting the review")}};return e.jsxs("form",{onSubmit:t,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"recommendation",children:"Recommendation"}),e.jsxs(H,{value:d,onValueChange:i,children:[e.jsx(J,{id:"recommendation",children:e.jsx(G,{placeholder:"Select your recommendation"})}),e.jsxs(K,{children:[e.jsx(w,{value:"accept",children:"Accept"}),e.jsx(w,{value:"minor_revisions",children:"Minor Revisions"}),e.jsx(w,{value:"major_revisions",children:"Major Revisions"}),e.jsx(w,{value:"reject",children:"Reject"})]})]})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"comments",children:"Comments to Author"}),e.jsx(D,{id:"comments",value:c,onChange:h=>x(h.target.value),placeholder:"Enter your comments for the author",rows:5})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"confidentialComments",children:"Confidential Comments to Editor"}),e.jsx(D,{id:"confidentialComments",value:o,onChange:h=>p(h.target.value),placeholder:"Enter confidential comments for the editor (not visible to the author)",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(f,{type:"button",variant:"outline",onClick:r,children:"Cancel"}),e.jsxs(f,{type:"submit",disabled:n==null?void 0:n.isPending,children:[(n==null?void 0:n.isPending)&&e.jsx(L,{className:"h-4 w-4 mr-2 animate-spin"}),"Submit Review"]})]})]})},Ie=({review:s,onBack:a,isAdmin:l})=>{const[r,d]=g.useState(!1),[i,c]=g.useState(s.status),[x,o]=g.useState(s.recommendation||""),[p,n]=g.useState(s.comments||""),[t,h]=g.useState(s.confidentialComments||""),y=O({}),R=re({}),u=()=>{d(!0)},_=async()=>{var N,m;try{const j=await R.mutateAsync({api:`${k.updateReview}/${s._id}`,data:{status:i,recommendation:x,comments:p.trim()||void 0,confidentialComments:t.trim()||void 0}});(N=j.data)!=null&&N.success?(v.success("Review updated successfully"),d(!1),a()):v.error(((m=j.data)==null?void 0:m.message)||"Failed to update review")}catch{v.error("Something went wrong while updating the review")}},S=N=>{const j={pending:{color:"bg-yellow-100 text-yellow-800",icon:e.jsx(I,{className:"h-4 w-4"})},completed:{color:"bg-green-100 text-green-800",icon:e.jsx(z,{className:"h-4 w-4"})},declined:{color:"bg-red-100 text-red-800",icon:e.jsx(q,{className:"h-4 w-4"})},overdue:{color:"bg-orange-100 text-orange-800",icon:e.jsx(A,{className:"h-4 w-4"})}}[N]||{color:"bg-gray-100 text-gray-800",icon:e.jsx(A,{className:"h-4 w-4"})};return e.jsxs(V,{className:`${j.color} flex items-center gap-1 px-3 py-1`,children:[j.icon,N]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(f,{variant:"outline",onClick:a,children:"Back to Reviews"}),l&&e.jsxs(f,{onClick:u,children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Edit Review"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Y,{className:"h-5 w-5 mr-2 text-blue-600"}),e.jsxs("h2",{className:"text-xl font-semibold text-gray-800",children:["Review by ",s.reviewerId.fullName]})]}),S(s.status)]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(P,{className:"h-4 w-4 mr-1 text-blue-600"}),"Assigned Date"]}),e.jsx("p",{className:"text-gray-800",children:C(new Date(s.createdAt),"MMM dd, yyyy")})]}),s.submissionDate&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(P,{className:"h-4 w-4 mr-1 text-blue-600"}),"Submission Date"]}),e.jsx("p",{className:"text-gray-800",children:C(new Date(s.submissionDate),"MMM dd, yyyy")})]}),s.dueDate&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(P,{className:"h-4 w-4 mr-1 text-blue-600"}),"Due Date"]}),e.jsx("p",{className:"text-gray-800",children:C(new Date(s.dueDate),"MMM dd, yyyy")})]})]}),s.recommendation&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Recommendation"}),e.jsx("p",{className:"text-gray-800 font-medium",children:s.recommendation.replace("_"," ")})]}),s.comments&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Comments to Author"}),e.jsx("div",{className:"bg-gray-50 p-3 rounded-md whitespace-pre-line",children:s.comments})]}),l&&s.confidentialComments&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Confidential Comments to Editor"}),e.jsx("div",{className:"bg-gray-50 p-3 rounded-md whitespace-pre-line border-l-4 border-blue-400",children:s.confidentialComments})]})]}),e.jsx(Z,{open:r,onOpenChange:d,children:e.jsxs(ee,{children:[e.jsx(se,{children:e.jsx(te,{children:"Edit Review"})}),e.jsxs("div",{className:"space-y-4 mt-2",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Status"}),e.jsxs(H,{value:i,onValueChange:c,children:[e.jsx(J,{children:e.jsx(G,{placeholder:"Select status"})}),e.jsxs(K,{children:[e.jsx(w,{value:"pending",children:"Pending"}),e.jsx(w,{value:"completed",children:"Completed"}),e.jsx(w,{value:"declined",children:"Declined"}),e.jsx(w,{value:"overdue",children:"Overdue"})]})]})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Recommendation"}),e.jsxs(H,{value:x,onValueChange:o,children:[e.jsx(J,{children:e.jsx(G,{placeholder:"Select recommendation"})}),e.jsxs(K,{children:[e.jsx(w,{value:"accept",children:"Accept"}),e.jsx(w,{value:"minor_revisions",children:"Minor Revisions"}),e.jsx(w,{value:"major_revisions",children:"Major Revisions"}),e.jsx(w,{value:"reject",children:"Reject"})]})]})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Comments to Author"}),e.jsx(D,{value:p,onChange:N=>n(N.target.value),placeholder:"Enter comments for the author",rows:4})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Confidential Comments to Editor"}),e.jsx(D,{value:t,onChange:N=>h(N.target.value),placeholder:"Enter confidential comments for the editor",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(f,{variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsxs(f,{onClick:_,disabled:y.isPending,children:[y.isPending&&e.jsx(L,{className:"h-4 w-4 mr-2 animate-spin"}),"Update"]})]})]})]})})]})},_e={pending:{color:"bg-yellow-100 text-yellow-800",icon:e.jsx(I,{className:"h-4 w-4"})},completed:{color:"bg-green-100 text-green-800",icon:e.jsx(z,{className:"h-4 w-4"})},declined:{color:"bg-red-100 text-red-800",icon:e.jsx(q,{className:"h-4 w-4"})},overdue:{color:"bg-orange-100 text-orange-800",icon:e.jsx(A,{className:"h-4 w-4"})}},De=({roundId:s,submissionId:a,isAdmin:l})=>{var N;const{user:r}=ie(),[d,i]=g.useState(null),[c,x]=g.useState(!1),{data:o,isLoading:p,refetch:n}=U({api:`${(N=k)==null?void 0:N.getReviews}?reviewRoundId=${s}`,options:{enabled:!!s}}),t=(o==null?void 0:o.data)||[],h=(r==null?void 0:r.role)==="Reviewer",y=t.find(m=>m.reviewerId._id===(r==null?void 0:r._id)),R=h&&!y&&!c,u=()=>{x(!1),n()},_=m=>{i(m)},S=()=>{i(null),n()};if(d){const m=t.find(j=>j._id===d);if(m)return e.jsx(Ie,{review:m,onBack:S,isAdmin:l})}return p?e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{className:"h-10 w-full"}),e.jsx(b,{className:"h-20 w-full"}),e.jsx(b,{className:"h-20 w-full"})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Reviews"}),R&&e.jsxs(f,{size:"sm",onClick:()=>x(!0),children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Submit Review"]})]}),c&&e.jsx("div",{className:"mb-6 p-4 border border-gray-200 rounded-lg bg-gray-50",children:e.jsx(Ee,{reviewRoundId:s,submissionId:a,onSuccess:u,onCancel:()=>x(!1)})}),t.length>0?e.jsx("div",{className:"space-y-3",children:t.map(m=>{const j=_e[m.status]||{color:"bg-gray-100 text-gray-800",icon:e.jsx(A,{className:"h-4 w-4"})};return e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>_(m._id),children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Y,{className:"h-4 w-4 mr-1 text-blue-600"}),e.jsx("h3",{className:"font-medium text-gray-800",children:m.reviewerId.fullName})]}),e.jsxs(V,{className:`${j.color} flex items-center gap-1`,children:[j.icon,m.status]})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Assigned: ",C(new Date(m.createdAt),"MMM dd, yyyy"),m.submissionDate&&` • Submitted: ${C(new Date(m.submissionDate),"MMM dd, yyyy")}`]}),m.recommendation&&e.jsxs("p",{className:"text-sm font-medium mt-2",children:["Recommendation: ",e.jsx("span",{className:"text-blue-600",children:m.recommendation.replace("_"," ")})]})]}),e.jsx(ce,{className:"h-5 w-5 text-gray-400"})]})},m._id)})}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Ne,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium mb-1",children:"No reviews yet"}),e.jsx("p",{className:"text-sm",children:h?"Submit your review for this submission.":"No reviewers have submitted reviews yet."})]})]})},$e=({roundId:s,submissionId:a,isAdmin:l,onBack:r})=>{var m;const[d,i]=g.useState(!1),[c,x]=g.useState(""),[o,p]=g.useState(""),n=O({}),t=re({}),{data:h,isLoading:y,refetch:R}=U({api:`${(m=k)==null?void 0:m.getReviewRoundById}/${s}`,options:{enabled:!!s}}),u=h==null?void 0:h.data,_=()=>{u&&(x(u.status),p(u.editorNotes||""),i(!0))},S=async()=>{var j,$,E;try{const B=await t.mutateAsync({api:`${(j=k)==null?void 0:j.updateReviewRound}/${s}`,data:{status:c,editorNotes:o.trim()||void 0,endDate:c==="completed"||c==="cancelled"?new Date().toISOString():void 0}});($=B.data)!=null&&$.success?(v.success("Review round updated successfully"),i(!1),R()):v.error(((E=B.data)==null?void 0:E.message)||"Failed to update review round")}catch{v.error("Something went wrong while updating the review round")}},N=j=>{const E={in_progress:{color:"bg-yellow-100 text-yellow-800",icon:e.jsx(I,{className:"h-4 w-4"})},completed:{color:"bg-green-100 text-green-800",icon:e.jsx(z,{className:"h-4 w-4"})},cancelled:{color:"bg-red-100 text-red-800",icon:e.jsx(q,{className:"h-4 w-4"})}}[j]||{color:"bg-gray-100 text-gray-800",icon:e.jsx(A,{className:"h-4 w-4"})};return e.jsxs(V,{className:`${E.color} flex items-center gap-1 px-3 py-1`,children:[E.icon,j.replace("_"," ")]})};return y?e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{className:"h-10 w-full"}),e.jsx(b,{className:"h-20 w-full"}),e.jsx(b,{className:"h-20 w-full"})]}):u?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(f,{variant:"outline",onClick:r,children:"Back to Review Rounds"}),l&&e.jsxs(f,{onClick:_,children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Edit Round"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-800 mb-2 md:mb-0",children:["Review Round ",u.roundNumber]}),N(u.status)]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(P,{className:"h-4 w-4 mr-1 text-blue-600"}),"Start Date"]}),e.jsx("p",{className:"text-gray-800",children:C(new Date(u.startDate),"MMM dd, yyyy")})]}),u.endDate&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(P,{className:"h-4 w-4 mr-1 text-blue-600"}),"End Date"]}),e.jsx("p",{className:"text-gray-800",children:C(new Date(u.endDate),"MMM dd, yyyy")})]})]}),u.editorNotes&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Editor Notes"}),e.jsx("p",{className:"text-gray-800 bg-gray-50 p-3 rounded-md",children:u.editorNotes})]})]}),e.jsx(De,{roundId:s,submissionId:a,isAdmin:l}),e.jsx(Z,{open:d,onOpenChange:i,children:e.jsxs(ee,{children:[e.jsx(se,{children:e.jsx(te,{children:"Edit Review Round"})}),e.jsxs("div",{className:"space-y-4 mt-2",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Status"}),e.jsxs(H,{value:c,onValueChange:x,children:[e.jsx(J,{children:e.jsx(G,{placeholder:"Select status"})}),e.jsxs(K,{children:[e.jsx(w,{value:"in_progress",children:"In Progress"}),e.jsx(w,{value:"completed",children:"Completed"}),e.jsx(w,{value:"cancelled",children:"Cancelled"})]})]})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Editor Notes"}),e.jsx(D,{value:o,onChange:j=>p(j.target.value),placeholder:"Add any notes for this review round",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(f,{variant:"outline",onClick:()=>i(!1),children:"Cancel"}),e.jsxs(f,{onClick:S,disabled:n.isPending,children:[n.isPending&&e.jsx(L,{className:"h-4 w-4 mr-2 animate-spin"}),"Update"]})]})]})]})})]}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(A,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium",children:"Review round not found"}),e.jsx(f,{variant:"outline",className:"mt-4",onClick:r,children:"Back to Review Rounds"})]})},Be=({submissionId:s,isAdmin:a})=>{const[l,r]=g.useState(null),d=c=>{r(c)},i=()=>{r(null)};return e.jsx("div",{className:"mt-6",children:l?e.jsx($e,{roundId:l,submissionId:s,isAdmin:a,onBack:i}):e.jsx(Ae,{submissionId:s,isAdmin:a,onSelectRound:d})})};function ls(){var N,m,j,$,E,B,ae;const s=O({}),{submissionId:a}=xe(),{user:l}=ie(),[r,d]=g.useState(!1),[i,c]=g.useState("details"),{data:x,isLoading:o}=U({api:`${(N=k)==null?void 0:N.getSubmissionsById}/${a}`,options:{enabled:!!a}}),{data:p,isLoading:n}=U({api:`${(m=k)==null?void 0:m.getAvailableReviewers}?submissionId=${a}`,options:{enabled:!!a&&(l==null?void 0:l.role)==="Admin"}}),t=x==null?void 0:x.data,h=((j=p==null?void 0:p.data)==null?void 0:j.docs)||[],y=(l==null?void 0:l.role)==="Reviewer",R=(l==null?void 0:l.role)==="Admin",u=F=>{if(!F)return"N/A";try{return C(new Date(F),"MMM dd, yyyy")}catch{return"Invalid date"}},_=async F=>{var T,le;try{const X=await s.mutateAsync({api:k.assignReviewer,data:{submissionId:a,reviewerId:F}});(T=X.data)!=null&&T.success?(v.success("Reviewer assigned successfully"),window.location.reload()):v.error(((le=X.data)==null?void 0:le.message)||"Failed to assign reviewer")}catch{v.error("Something went wrong while assigning reviewer")}};if(o)return e.jsx(ve,{});const S=we(t==null?void 0:t.status);return e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg shadow-md",children:[e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2 md:mb-0",children:t==null?void 0:t.title}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(V,{className:`${S==null?void 0:S.color} flex items-center gap-1 px-3 py-1 text-sm font-medium`,children:[S==null?void 0:S.icon,($=t==null?void 0:t.status)==null?void 0:$.replace("_"," ").toUpperCase()]}),R&&e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>d(!0),children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Assign Reviewer"]})]})]}),e.jsxs("div",{className:"flex border-b border-gray-200 mb-6",children:[e.jsx("button",{className:`px-4 py-2 font-medium text-sm ${i==="details"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,onClick:()=>c("details"),children:"Submission Details"}),e.jsx("button",{className:`px-4 py-2 font-medium text-sm ${i==="reviews"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,onClick:()=>c("reviews"),children:"Review Process"})]}),i==="details"?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[e.jsx(ge,{className:"h-5 w-5 mr-2 text-blue-600"}),"Submission Details"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Abstract"}),e.jsx("p",{className:"text-gray-800 whitespace-pre-line",children:t==null?void 0:t.abstract})]}),((E=t==null?void 0:t.keywords)==null?void 0:E.length)>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(pe,{className:"h-4 w-4 mr-1 text-blue-600"}),"Keywords"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(B=t==null?void 0:t.keywords)==null?void 0:B.map((F,T)=>e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full",children:F},T))})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(fe,{className:"h-4 w-4 mr-1 text-blue-600"}),"Journal"]}),e.jsx("p",{className:"text-gray-800",children:((ae=t==null?void 0:t.journalId)==null?void 0:ae.title)||"Journal information not available"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(P,{className:"h-4 w-4 mr-1 text-blue-600"}),"Submission Date"]}),e.jsx("p",{className:"text-gray-800",children:u((t==null?void 0:t.submissionDate)||(t==null?void 0:t.createdAt))})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(I,{className:"h-4 w-4 mr-1 text-blue-600"}),"Last Updated"]}),e.jsx("p",{className:"text-gray-800",children:u(t==null?void 0:t.updatedAt)})]})]})]})]})}),e.jsxs("div",{className:"space-y-6",children:[(R||y)&&e.jsx(be,{author:t==null?void 0:t.submittedBy}),e.jsx(Ce,{manuscriptUrl:t==null?void 0:t.fullManuscriptUrl,manuscriptFile:t==null?void 0:t.manuscriptFile}),e.jsx(Re,{submission:t})]})]}):e.jsx(Be,{submissionId:a,isAdmin:R})]}),R&&e.jsx(Se,{reviewers:h,loading:n,open:r,onClose:()=>d(!1),onAssign:_})]})}export{ls as default};
