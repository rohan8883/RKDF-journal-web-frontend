import{c as te,j as e,f as ie,B as me,r as S,_ as w,e as ae}from"./index-CcP31-MS.js";import{r as h,b as xe}from"./router-GXfyPTrP.js";import{u as z,a as V,b as re}from"./useCustomQuery-CyGYSctF.js";import{B as v}from"./button-1B5J0yav.js";import{B as q}from"./badge-B_hu0FcF.js";import{F as K}from"./file-text-Di_qLonZ.js";import{C as L}from"./clock-Bk9JcOmp.js";import{C as _}from"./circle-alert-DAhe4yYy.js";import{C as H}from"./circle-check-big-CF9E_136.js";import{C as J}from"./circle-x-YJBTlr2J.js";import{U as le}from"./user-CNZh8Ni9.js";import{E as he}from"./external-link-BgKmPZHx.js";import{D as Y,a as Z,b as ee,c as se,e as ue}from"./dialog-BhhobJmP.js";import{L as M,I as je,T as ge}from"./label-BZX6spI0.js";import{C as ce}from"./chevron-right-GzMuV-zV.js";import{f as A}from"./format-CWZx4aKk.js";import{S as X,b as G,c as Q,d as W,e as b}from"./select-CZPb9YGE.js";import{S as de}from"./square-pen-9yW6PE9n.js";import{C as O}from"./calendar-B7qepxDc.js";import{U as pe}from"./users-CMM0aWUc.js";import{B as ve}from"./book-Cw3T6Lat.js";import{T as fe}from"./tag-CpCZCl4W.js";import{B as we}from"./book-open-Ckb_domj.js";import"./axios-DmypytPv.js";/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=te("ClipboardCheck",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=te("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=te("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);function R({className:t,...a}){return e.jsx("div",{className:ie("animate-pulse rounded-md bg-primary/10",t),...a})}const ye=()=>e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(R,{className:"h-8 w-3/4"}),e.jsx(R,{className:"h-4 w-1/4"}),e.jsx(R,{className:"h-24 w-full"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(R,{className:"h-12 w-full"}),e.jsx(R,{className:"h-12 w-full"})]})]})}),be={submitted:{color:"bg-blue-100 text-blue-800",icon:e.jsx(K,{className:"h-4 w-4"})},pending:{color:"bg-yellow-100 text-yellow-800",icon:e.jsx(L,{className:"h-4 w-4"})},under_review:{color:"bg-blue-100 text-blue-800",icon:e.jsx(_,{className:"h-4 w-4"})},accepted:{color:"bg-green-100 text-green-800",icon:e.jsx(H,{className:"h-4 w-4"})},rejected:{color:"bg-red-100 text-red-800",icon:e.jsx(J,{className:"h-4 w-4"})},revisions_required:{color:"bg-purple-100 text-purple-800",icon:e.jsx(K,{className:"h-4 w-4"})}},Ce=t=>{const a={color:"bg-gray-100 text-gray-800",icon:e.jsx(_,{className:"h-4 w-4"})};return t&&be[t]||a},Re=({author:t})=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[e.jsx(le,{className:"h-5 w-5 mr-2 text-blue-600"}),"Author Information"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Name"}),e.jsx("p",{className:"text-gray-800",children:(t==null?void 0:t.fullName)||"Author information not available"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Email"}),e.jsx("p",{className:"text-gray-800",children:(t==null?void 0:t.email)||"Email not available"})]}),(t==null?void 0:t.affiliation)&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Affiliation"}),e.jsx("p",{className:"text-gray-800",children:t==null?void 0:t.affiliation})]})]})]}),Se=({manuscriptUrl:t,manuscriptFile:a})=>{const l=r=>{window.open(r,"_blank")};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[e.jsx(K,{className:"h-5 w-5 mr-2 text-blue-600"}),"Files"]}),e.jsx("div",{className:"space-y-4",children:t?e.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-blue-100 rounded-full p-2",children:e.jsx(K,{className:"h-4 w-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-800",children:"Manuscript"}),e.jsx("p",{className:"text-xs text-gray-500",children:a||"manuscript.pdf"})]})]}),e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>l(`${me}/${a}`),children:e.jsx(he,{className:"h-4 w-4"})})]})}):e.jsx("div",{className:"text-center py-4 text-gray-500",children:e.jsx("p",{children:"No files available"})})})]})},Me=({reviewers:t,loading:a,open:l,onClose:r,onAssign:c})=>{const[i,d]=h.useState(null),[x,o]=h.useState(!1),u=async()=>{if(i){o(!0);try{await c(i)}finally{o(!1)}}};return e.jsx(Y,{open:l,onOpenChange:r,children:e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsx(se,{children:"Assign Reviewer"})}),a?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(F,{className:"h-6 w-6 animate-spin"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Select Reviewer"}),e.jsxs("select",{className:"w-full p-2 border rounded-md",value:i||"",onChange:n=>d(n.target.value),children:[e.jsx("option",{value:"",children:"Select a reviewer"}),t.map(n=>e.jsxs("option",{value:n._id,children:[n.fullName," (",n.email,")"]},n._id))]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(v,{variant:"outline",onClick:r,children:"Cancel"}),e.jsxs(v,{disabled:!i||x,onClick:u,children:[x?e.jsx(F,{className:"h-4 w-4 animate-spin mr-2"}):null,"Assign"]})]})]})]})})},B=h.forwardRef(({className:t,...a},l)=>e.jsx("textarea",{className:ie("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",t),ref:l,...a}));B.displayName="Textarea";const ke=({submissionId:t,onSuccess:a,onCancel:l,nextRoundNumber:r})=>{const[c,i]=h.useState(r),[d,x]=h.useState(""),o=z({}),u=async n=>{var s,j;n.preventDefault();try{const N=await o.mutateAsync({api:S.createReviewRound,data:{submissionId:t,roundNumber:c,editorNotes:d.trim()||void 0}});(s=N.data)!=null&&s.success?(w.success("Review round created successfully"),a()):w.error(((j=N.data)==null?void 0:j.message)||"Failed to create review round")}catch{w.error("Something went wrong while creating the review round")}};return e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"roundNumber",children:"Round Number"}),e.jsx(je,{id:"roundNumber",type:"number",value:c,onChange:n=>i(Number.parseInt(n.target.value)),min:1,required:!0})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"editorNotes",children:"Editor Notes (Optional)"}),e.jsx(B,{id:"editorNotes",value:d,onChange:n=>x(n.target.value),placeholder:"Add any notes for this review round",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(v,{type:"button",variant:"outline",onClick:l,children:"Cancel"}),e.jsxs(v,{type:"submit",disabled:o.isPending,children:[o.isPending&&e.jsx(F,{className:"h-4 w-4 mr-2 animate-spin"}),"Create Review Round"]})]})]})},Ae={in_progress:{color:"bg-yellow-100 text-yellow-800",icon:e.jsx(L,{className:"h-4 w-4"})},completed:{color:"bg-green-100 text-green-800",icon:e.jsx(H,{className:"h-4 w-4"})},cancelled:{color:"bg-red-100 text-red-800",icon:e.jsx(J,{className:"h-4 w-4"})}},_e=({submissionId:t,isAdmin:a,onSelectRound:l})=>{var n;const[r,c]=h.useState(!1),{data:i,isLoading:d,refetch:x}=V({api:`${(n=S)==null?void 0:n.getReviewRounds}?submissionId=${t}`,options:{enabled:!!t}}),o=(i==null?void 0:i.data)||[],u=()=>{c(!1),x()};return d?e.jsxs("div",{className:"space-y-4",children:[e.jsx(R,{className:"h-10 w-full"}),e.jsx(R,{className:"h-20 w-full"}),e.jsx(R,{className:"h-20 w-full"})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Review Rounds"}),a&&!r&&e.jsxs(v,{size:"sm",onClick:()=>c(!0),children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"New Round"]})]}),r&&e.jsx("div",{className:"mb-6 p-4 border border-gray-200 rounded-lg bg-gray-50",children:e.jsx(ke,{submissionId:t,onSuccess:u,onCancel:()=>c(!1),nextRoundNumber:o.length+1})}),o.length>0?e.jsx("div",{className:"space-y-3",children:o.map(s=>{const j=Ae[s.status]||{color:"bg-gray-100 text-gray-800",icon:e.jsx(_,{className:"h-4 w-4"})};return e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>l(s._id),children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("h3",{className:"font-medium text-gray-800",children:["Round ",s.roundNumber]}),e.jsxs(q,{className:`${j.color} flex items-center gap-1`,children:[j.icon,s.status.replace("_"," ")]})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Started: ",A(new Date(s.startDate),"MMM dd, yyyy"),s.endDate&&` • Ended: ${A(new Date(s.endDate),"MMM dd, yyyy")}`]}),s.editorNotes&&e.jsxs("p",{className:"text-sm text-gray-600 mt-2 italic",children:['"',s.editorNotes,'"']})]}),e.jsx(ce,{className:"h-5 w-5 text-gray-400"})]})},s._id)})}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(L,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium mb-1",children:"No review rounds yet"}),e.jsx("p",{className:"text-sm",children:a?"Start the review process by creating a new review round.":"The review process has not started yet."})]})]})},Ee=({reviewRoundId:t,submissionId:a,onSuccess:l,onCancel:r})=>{const[c,i]=h.useState(""),[d,x]=h.useState(""),[o,u]=h.useState(""),n=z({}),s=async j=>{var N,y;if(j.preventDefault(),!c){w.error("Please select a recommendation");return}try{const g=await n.mutateAsync({api:S.createReview,data:{reviewRoundId:t,submissionId:a,recommendation:c,comments:d.trim()||void 0,confidentialComments:o.trim()||void 0,submissionDate:new Date().toISOString(),status:"completed"}});(N=g.data)!=null&&N.success?(w.success("Review submitted successfully"),l()):w.error(((y=g.data)==null?void 0:y.message)||"Failed to submit review")}catch{w.error("Something went wrong while submitting the review")}};return e.jsxs("form",{onSubmit:s,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"recommendation",children:"Recommendation"}),e.jsxs(X,{value:c,onValueChange:i,children:[e.jsx(G,{id:"recommendation",children:e.jsx(Q,{placeholder:"Select your recommendation"})}),e.jsxs(W,{children:[e.jsx(b,{value:"accept",children:"Accept"}),e.jsx(b,{value:"minor_revisions",children:"Minor Revisions"}),e.jsx(b,{value:"major_revisions",children:"Major Revisions"}),e.jsx(b,{value:"reject",children:"Reject"})]})]})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"comments",children:"Comments to Author"}),e.jsx(B,{id:"comments",value:d,onChange:j=>x(j.target.value),placeholder:"Enter your comments for the author",rows:5})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"confidentialComments",children:"Confidential Comments to Editor"}),e.jsx(B,{id:"confidentialComments",value:o,onChange:j=>u(j.target.value),placeholder:"Enter confidential comments for the editor (not visible to the author)",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(v,{type:"button",variant:"outline",onClick:r,children:"Cancel"}),e.jsxs(v,{type:"submit",disabled:n==null?void 0:n.isPending,children:[(n==null?void 0:n.isPending)&&e.jsx(F,{className:"h-4 w-4 mr-2 animate-spin"}),"Submit Review"]})]})]})},De=({review:t,onBack:a,isAdmin:l})=>{const[r,c]=h.useState(!1),[i,d]=h.useState(t.status),[x,o]=h.useState(t.recommendation||""),[u,n]=h.useState(t.comments||""),[s,j]=h.useState(t.confidentialComments||""),N=z({}),y=re({}),g=()=>{c(!0)},D=async()=>{var f,m;try{const p=await y.mutateAsync({api:`${S.updateReview}/${t._id}`,data:{status:i,recommendation:x,comments:u.trim()||void 0,confidentialComments:s.trim()||void 0}});(f=p.data)!=null&&f.success?(w.success("Review updated successfully"),c(!1),a()):w.error(((m=p.data)==null?void 0:m.message)||"Failed to update review")}catch{w.error("Something went wrong while updating the review")}},$=f=>{const p={pending:{color:"bg-yellow-100 text-yellow-800",icon:e.jsx(L,{className:"h-4 w-4"})},completed:{color:"bg-green-100 text-green-800",icon:e.jsx(H,{className:"h-4 w-4"})},declined:{color:"bg-red-100 text-red-800",icon:e.jsx(J,{className:"h-4 w-4"})},overdue:{color:"bg-orange-100 text-orange-800",icon:e.jsx(_,{className:"h-4 w-4"})}}[f]||{color:"bg-gray-100 text-gray-800",icon:e.jsx(_,{className:"h-4 w-4"})};return e.jsxs(q,{className:`${p.color} flex items-center gap-1 px-3 py-1`,children:[p.icon,f]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(v,{variant:"outline",onClick:a,children:"Back to Reviews"}),l&&e.jsxs(v,{onClick:g,children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Edit Review"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(le,{className:"h-5 w-5 mr-2 text-blue-600"}),e.jsxs("h2",{className:"text-xl font-semibold text-gray-800",children:["Review by ",t.reviewerId.fullName]})]}),$(t.status)]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(O,{className:"h-4 w-4 mr-1 text-blue-600"}),"Assigned Date"]}),e.jsx("p",{className:"text-gray-800",children:A(new Date(t.createdAt),"MMM dd, yyyy")})]}),t.submissionDate&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(O,{className:"h-4 w-4 mr-1 text-blue-600"}),"Submission Date"]}),e.jsx("p",{className:"text-gray-800",children:A(new Date(t.submissionDate),"MMM dd, yyyy")})]}),t.dueDate&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(O,{className:"h-4 w-4 mr-1 text-blue-600"}),"Due Date"]}),e.jsx("p",{className:"text-gray-800",children:A(new Date(t.dueDate),"MMM dd, yyyy")})]})]}),t.recommendation&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Recommendation"}),e.jsx("p",{className:"text-gray-800 font-medium",children:t.recommendation.replace("_"," ")})]}),t.comments&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Comments to Author"}),e.jsx("div",{className:"bg-gray-50 p-3 rounded-md whitespace-pre-line",children:t.comments})]}),l&&t.confidentialComments&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Confidential Comments to Editor"}),e.jsx("div",{className:"bg-gray-50 p-3 rounded-md whitespace-pre-line border-l-4 border-blue-400",children:t.confidentialComments})]})]}),e.jsx(Y,{open:r,onOpenChange:c,children:e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsx(se,{children:"Edit Review"})}),e.jsxs("div",{className:"space-y-4 mt-2",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Status"}),e.jsxs(X,{value:i,onValueChange:d,children:[e.jsx(G,{children:e.jsx(Q,{placeholder:"Select status"})}),e.jsxs(W,{children:[e.jsx(b,{value:"pending",children:"Pending"}),e.jsx(b,{value:"completed",children:"Completed"}),e.jsx(b,{value:"declined",children:"Declined"}),e.jsx(b,{value:"overdue",children:"Overdue"})]})]})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Recommendation"}),e.jsxs(X,{value:x,onValueChange:o,children:[e.jsx(G,{children:e.jsx(Q,{placeholder:"Select recommendation"})}),e.jsxs(W,{children:[e.jsx(b,{value:"accept",children:"Accept"}),e.jsx(b,{value:"minor_revisions",children:"Minor Revisions"}),e.jsx(b,{value:"major_revisions",children:"Major Revisions"}),e.jsx(b,{value:"reject",children:"Reject"})]})]})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Comments to Author"}),e.jsx(B,{value:u,onChange:f=>n(f.target.value),placeholder:"Enter comments for the author",rows:4})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Confidential Comments to Editor"}),e.jsx(B,{value:s,onChange:f=>j(f.target.value),placeholder:"Enter confidential comments for the editor",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(v,{variant:"outline",onClick:()=>c(!1),children:"Cancel"}),e.jsxs(v,{onClick:D,disabled:N.isPending,children:[N.isPending&&e.jsx(F,{className:"h-4 w-4 mr-2 animate-spin"}),"Update"]})]})]})]})})]})},$e={pending:{color:"bg-yellow-100 text-yellow-800",icon:e.jsx(L,{className:"h-4 w-4"})},completed:{color:"bg-green-100 text-green-800",icon:e.jsx(H,{className:"h-4 w-4"})},declined:{color:"bg-red-100 text-red-800",icon:e.jsx(J,{className:"h-4 w-4"})},overdue:{color:"bg-orange-100 text-orange-800",icon:e.jsx(_,{className:"h-4 w-4"})}},Ie=({roundId:t,submissionId:a,isAdmin:l})=>{var f;const{user:r}=ae(),[c,i]=h.useState(null),[d,x]=h.useState(!1),{data:o,isLoading:u,refetch:n}=V({api:`${(f=S)==null?void 0:f.getReviews}?reviewRoundId=${t}`,options:{enabled:!!t}}),s=(o==null?void 0:o.data)||[],j=(r==null?void 0:r.role)==="Reviewer",N=s.find(m=>m.reviewerId._id===(r==null?void 0:r._id)),y=j&&!N&&!d,g=()=>{x(!1),n()},D=m=>{i(m)},$=()=>{i(null),n()};if(c){const m=s.find(p=>p._id===c);if(m)return e.jsx(De,{review:m,onBack:$,isAdmin:l})}return u?e.jsxs("div",{className:"space-y-4",children:[e.jsx(R,{className:"h-10 w-full"}),e.jsx(R,{className:"h-20 w-full"}),e.jsx(R,{className:"h-20 w-full"})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Reviews"}),y&&e.jsxs(v,{size:"sm",onClick:()=>x(!0),children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Submit Review"]})]}),d&&e.jsx("div",{className:"mb-6 p-4 border border-gray-200 rounded-lg bg-gray-50",children:e.jsx(Ee,{reviewRoundId:t,submissionId:a,onSuccess:g,onCancel:()=>x(!1)})}),s.length>0?e.jsx("div",{className:"space-y-3",children:s.map(m=>{const p=$e[m.status]||{color:"bg-gray-100 text-gray-800",icon:e.jsx(_,{className:"h-4 w-4"})};return e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>D(m._id),children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(le,{className:"h-4 w-4 mr-1 text-blue-600"}),e.jsx("h3",{className:"font-medium text-gray-800",children:m.reviewerId.fullName})]}),e.jsxs(q,{className:`${p.color} flex items-center gap-1`,children:[p.icon,m.status]})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Assigned: ",A(new Date(m.createdAt),"MMM dd, yyyy"),m.submissionDate&&` • Submitted: ${A(new Date(m.submissionDate),"MMM dd, yyyy")}`]}),m.recommendation&&e.jsxs("p",{className:"text-sm font-medium mt-2",children:["Recommendation: ",e.jsx("span",{className:"text-blue-600",children:m.recommendation.replace("_"," ")})]})]}),e.jsx(ce,{className:"h-5 w-5 text-gray-400"})]})},m._id)})}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Ne,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium mb-1",children:"No reviews yet"}),e.jsx("p",{className:"text-sm",children:j?"Submit your review for this submission.":"No reviewers have submitted reviews yet."})]})]})},Fe=({roundId:t,submissionId:a,isAdmin:l,onBack:r})=>{var m;const[c,i]=h.useState(!1),[d,x]=h.useState(""),[o,u]=h.useState(""),n=z({}),s=re({}),{data:j,isLoading:N,refetch:y}=V({api:`${(m=S)==null?void 0:m.getReviewRoundById}/${t}`,options:{enabled:!!t}}),g=j==null?void 0:j.data,D=()=>{g&&(x(g.status),u(g.editorNotes||""),i(!0))},$=async()=>{var p,P,E;try{const T=await s.mutateAsync({api:`${(p=S)==null?void 0:p.updateReviewRound}/${t}`,data:{status:d,editorNotes:o.trim()||void 0,endDate:d==="completed"||d==="cancelled"?new Date().toISOString():void 0}});(P=T.data)!=null&&P.success?(w.success("Review round updated successfully"),i(!1),y()):w.error(((E=T.data)==null?void 0:E.message)||"Failed to update review round")}catch{w.error("Something went wrong while updating the review round")}},f=p=>{const E={in_progress:{color:"bg-yellow-100 text-yellow-800",icon:e.jsx(L,{className:"h-4 w-4"})},completed:{color:"bg-green-100 text-green-800",icon:e.jsx(H,{className:"h-4 w-4"})},cancelled:{color:"bg-red-100 text-red-800",icon:e.jsx(J,{className:"h-4 w-4"})}}[p]||{color:"bg-gray-100 text-gray-800",icon:e.jsx(_,{className:"h-4 w-4"})};return e.jsxs(q,{className:`${E.color} flex items-center gap-1 px-3 py-1`,children:[E.icon,p.replace("_"," ")]})};return N?e.jsxs("div",{className:"space-y-4",children:[e.jsx(R,{className:"h-10 w-full"}),e.jsx(R,{className:"h-20 w-full"}),e.jsx(R,{className:"h-20 w-full"})]}):g?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(v,{variant:"outline",onClick:r,children:"Back to Review Rounds"}),l&&e.jsxs(v,{onClick:D,children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Edit Round"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-800 mb-2 md:mb-0",children:["Review Round ",g.roundNumber]}),f(g.status)]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(O,{className:"h-4 w-4 mr-1 text-blue-600"}),"Start Date"]}),e.jsx("p",{className:"text-gray-800",children:A(new Date(g.startDate),"MMM dd, yyyy")})]}),g.endDate&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(O,{className:"h-4 w-4 mr-1 text-blue-600"}),"End Date"]}),e.jsx("p",{className:"text-gray-800",children:A(new Date(g.endDate),"MMM dd, yyyy")})]})]}),g.editorNotes&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Editor Notes"}),e.jsx("p",{className:"text-gray-800 bg-gray-50 p-3 rounded-md",children:g.editorNotes})]})]}),e.jsx(Ie,{roundId:t,submissionId:a,isAdmin:l}),e.jsx(Y,{open:c,onOpenChange:i,children:e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsx(se,{children:"Edit Review Round"})}),e.jsxs("div",{className:"space-y-4 mt-2",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Status"}),e.jsxs(X,{value:d,onValueChange:x,children:[e.jsx(G,{children:e.jsx(Q,{placeholder:"Select status"})}),e.jsxs(W,{children:[e.jsx(b,{value:"in_progress",children:"In Progress"}),e.jsx(b,{value:"completed",children:"Completed"}),e.jsx(b,{value:"cancelled",children:"Cancelled"})]})]})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Editor Notes"}),e.jsx(B,{value:o,onChange:p=>u(p.target.value),placeholder:"Add any notes for this review round",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(v,{variant:"outline",onClick:()=>i(!1),children:"Cancel"}),e.jsxs(v,{onClick:$,disabled:n.isPending,children:[n.isPending&&e.jsx(F,{className:"h-4 w-4 mr-2 animate-spin"}),"Update"]})]})]})]})})]}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(_,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium",children:"Review round not found"}),e.jsx(v,{variant:"outline",className:"mt-4",onClick:r,children:"Back to Review Rounds"})]})},Be=({submissionId:t,isAdmin:a})=>{const[l,r]=h.useState(null),c=d=>{r(d)},i=()=>{r(null)};return e.jsx("div",{className:"mt-6",children:l?e.jsx(Fe,{roundId:l,submissionId:t,isAdmin:a,onBack:i}):e.jsx(_e,{submissionId:t,isAdmin:a,onSelectRound:c})})};function Le({isAdmin:t,reviewerAssignments:a=[],onDeleteAssignment:l}){const[r,c]=h.useState(!1),[i,d]=h.useState(!1),[x,o]=h.useState(null),{user:u}=ae(),n=async()=>{if(!(!x||!l)){c(!0);try{await l(x),d(!1)}catch{w.error("Failed to remove reviewer")}finally{c(!1)}}};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Review Assignments"}),a.length===0?e.jsx("p",{className:"text-gray-500",children:"No reviewers assigned yet"}):e.jsx("div",{className:"space-y-4",children:a.map(s=>e.jsx("div",{className:"border rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:s.reviewer.fullName}),e.jsx("p",{className:"text-sm text-gray-500",children:s.reviewer.email})]}),(t||s.reviewer._id===(u==null?void 0:u._id))&&e.jsx("div",{className:" ",children:t&&e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>{o(s._id),d(!0)},children:e.jsx(ge,{className:"h-4 w-4 text-red-500"})})})]})},s._id))}),e.jsx(Y,{open:i,onOpenChange:d,children:e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsx(se,{children:"Remove Reviewer"})}),e.jsx("p",{children:"Are you sure you want to remove this reviewer?"}),e.jsxs(ue,{children:[e.jsx(v,{variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsxs(v,{variant:"destructive",onClick:n,disabled:r,children:[r&&e.jsx(F,{className:"h-4 w-4 animate-spin mr-2"}),"Remove"]})]})]})})]})}function cs(){var p,P,E,T,ne;const t=z({}),{submissionId:a}=xe(),{user:l}=ae(),[r,c]=h.useState(!1),[i,d]=h.useState("details"),{data:x,isLoading:o}=V({api:`${(p=S)==null?void 0:p.getSubmissionsById}/${a}`,options:{enabled:!!a}}),{data:u,isLoading:n}=V({api:`${(P=S)==null?void 0:P.getAvailableReviewers}?submissionId=${a}`,options:{enabled:!!a&&(l==null?void 0:l.role)==="Admin"}}),s=x==null?void 0:x.data,j=((E=u==null?void 0:u.data)==null?void 0:E.docs)||[],N=(l==null?void 0:l.role)==="Reviewer",y=(l==null?void 0:l.role)==="Admin",g=C=>{if(!C)return"N/A";try{return A(new Date(C),"MMM dd, yyyy")}catch{return"Invalid date"}},D=async C=>{var k,U;try{const I=await t.mutateAsync({api:S.assignReviewer,data:{submissionId:a,reviewerId:C}});(k=I.data)!=null&&k.success?(w.success("Reviewer assigned successfully"),window.location.reload()):w.error(((U=I.data)==null?void 0:U.message)||"Failed to assign reviewer")}catch{w.error("Something went wrong while assigning reviewer")}},$=async C=>{var k,U;try{const I=await t.mutateAsync({api:S.deleteReviewerAssignment,data:{submissionId:a,reviewerId:C}});(k=I.data)!=null&&k.success?(w.success("Reviewer removed successfully"),window.location.reload()):w.error(((U=I.data)==null?void 0:U.message)||"Failed to remove reviewer")}catch{w.error("Something went wrong while removing reviewer")}};if(o)return e.jsx(ye,{});const f=Ce(s==null?void 0:s.status),m=()=>s!=null&&s.abstract?s.abstract:"No abstract available";return e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg shadow-md",children:[e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2 md:mb-0",children:s==null?void 0:s.title}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(q,{className:`${f==null?void 0:f.color} flex items-center gap-1 px-3 py-1 text-sm font-medium`,children:[f==null?void 0:f.icon,(T=s==null?void 0:s.status)==null?void 0:T.replace("_"," ").toUpperCase()]}),y&&e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>c(!0),children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Assign Reviewer"]})]})]}),e.jsxs("div",{className:"flex space-x-1 mb-8",children:[e.jsxs("button",{className:`px-6 py-3 font-medium text-sm rounded-t-lg transition-all duration-200 ${i==="details"?"text-white bg-gradient-to-r from-blue-500 to-blue-600 shadow-md":"text-gray-600 bg-gray-100 hover:bg-gray-200"}`,onClick:()=>d("details"),children:["Submission Details",i==="details"&&e.jsx("span",{className:"block w-6 h-1 mx-auto mt-2 bg-blue-300 rounded-full"})]}),e.jsxs("button",{className:`px-6 py-3 font-medium text-sm rounded-t-lg transition-all duration-200 ${i==="reviews"?"text-white bg-gradient-to-r from-blue-500 to-blue-600 shadow-md":"text-gray-600 bg-gray-100 hover:bg-gray-200"}`,onClick:()=>d("reviews"),children:["Review Process",i==="reviews"&&e.jsx("span",{className:"block w-6 h-1 mx-auto mt-2 bg-blue-300 rounded-full"})]})]}),y&&e.jsx(Le,{submissionId:a,isAdmin:y,reviewerAssignments:(s==null?void 0:s.reviewerAssignments)||[],onDeleteAssignment:$}),i==="details"?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mt-3",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[e.jsx(ve,{className:"h-5 w-5 mr-2 text-blue-600"}),"Submission Details"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Abstract"}),e.jsx("div",{className:"text-gray-800",dangerouslySetInnerHTML:{__html:m()}})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(fe,{className:"h-4 w-4 mr-1 text-blue-600"}),"Keywords"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s!=null&&s.keywords?Array.isArray(s.keywords)?s.keywords.map((C,k)=>e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full",children:C},k)):String(s.keywords).split(/[,;]/).map(C=>C.trim()).filter(C=>C.length>0).map((C,k)=>e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full",children:C},k)):e.jsx("p",{className:"text-gray-500 italic",children:"No keywords provided"})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(we,{className:"h-4 w-4 mr-1 text-blue-600"}),"Journal"]}),e.jsx("p",{className:"text-gray-800",children:((ne=s==null?void 0:s.journalId)==null?void 0:ne.title)||"Journal information not available"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(O,{className:"h-4 w-4 mr-1 text-blue-600"}),"Submission Date"]}),e.jsx("p",{className:"text-gray-800",children:g((s==null?void 0:s.submissionDate)||(s==null?void 0:s.createdAt))})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(L,{className:"h-4 w-4 mr-1 text-blue-600"}),"Last Updated"]}),e.jsx("p",{className:"text-gray-800",children:g(s==null?void 0:s.updatedAt)})]})]})]})]})}),e.jsxs("div",{className:"space-y-6",children:[(y||N)&&e.jsx(Re,{author:s==null?void 0:s.submittedBy}),e.jsx(Se,{manuscriptUrl:s==null?void 0:s.fullManuscriptUrl,manuscriptFile:s==null?void 0:s.manuscriptFile})]})]}):e.jsx(Be,{submissionId:a,isAdmin:y})]}),y&&e.jsx(Me,{reviewers:j,loading:n,open:r,onClose:()=>c(!1),onAssign:D})]})}export{cs as default};
