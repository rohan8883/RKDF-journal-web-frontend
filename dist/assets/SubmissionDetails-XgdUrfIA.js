import{c as te,j as e,d as re,B as xe,r as R,_ as w,f as ae}from"./index-CKu6NIiG.js";import{r as h,b as he}from"./router-GXfyPTrP.js";import{u as z,L as S,I as ue,c as V,S as K,d as X,e as G,f as Q,g as b,b as ce,T as je}from"./useCustomQuery-DER8A81U.js";import{B as v}from"./button-BtqIQZ7y.js";import{B as q}from"./badge-pIIdSOa0.js";import{F as W}from"./file-text-Cc4OIgFF.js";import{C as P}from"./clock-B2bd0X3z.js";import{C as k}from"./circle-alert-CTosTP8F.js";import{C as H}from"./circle-check-big-BSfWMD_k.js";import{C as J}from"./circle-x-JHF--Tvy.js";import{U as ne}from"./user-Ccwr1b2I.js";import{E as ge}from"./external-link-Btm-G7pq.js";import{D as Y,a as Z,b as ee,c as se,e as pe}from"./dialog-B9UggYA7.js";import{C as de}from"./chevron-right-C76pcm54.js";import{f as M}from"./format-CWZx4aKk.js";import{S as oe}from"./square-pen-qh323m7S.js";import{C as O}from"./calendar-BIgGF5or.js";import{U as ve}from"./users-Bi2U-SUV.js";import{B as fe}from"./book-LAJ4qmyE.js";import{T as we}from"./tag-wL_L9iFQ.js";import{B as Ne}from"./book-open-HDU3og-I.js";import"./axios-DmypytPv.js";/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=te("ClipboardCheck",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=te("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=te("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);function C({className:t,...a}){return e.jsx("div",{className:re("animate-pulse rounded-md bg-primary/10",t),...a})}const be=()=>e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(C,{className:"h-8 w-3/4"}),e.jsx(C,{className:"h-4 w-1/4"}),e.jsx(C,{className:"h-24 w-full"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(C,{className:"h-12 w-full"}),e.jsx(C,{className:"h-12 w-full"})]})]})}),Ce={submitted:{color:"bg-blue-100 text-blue-800",icon:e.jsx(W,{className:"h-4 w-4"})},pending:{color:"bg-yellow-100 text-yellow-800",icon:e.jsx(P,{className:"h-4 w-4"})},under_review:{color:"bg-blue-100 text-blue-800",icon:e.jsx(k,{className:"h-4 w-4"})},accepted:{color:"bg-green-100 text-green-800",icon:e.jsx(H,{className:"h-4 w-4"})},rejected:{color:"bg-red-100 text-red-800",icon:e.jsx(J,{className:"h-4 w-4"})},revisions_required:{color:"bg-purple-100 text-purple-800",icon:e.jsx(W,{className:"h-4 w-4"})}},Re=t=>{const a={color:"bg-gray-100 text-gray-800",icon:e.jsx(k,{className:"h-4 w-4"})};return t&&Ce[t]||a},Se=({author:t})=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[e.jsx(ne,{className:"h-5 w-5 mr-2 text-blue-600"}),"Author Information"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Name"}),e.jsx("p",{className:"text-gray-800",children:(t==null?void 0:t.fullName)||"Author information not available"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Email"}),e.jsx("p",{className:"text-gray-800",children:(t==null?void 0:t.email)||"Email not available"})]}),(t==null?void 0:t.affiliation)&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Affiliation"}),e.jsx("p",{className:"text-gray-800",children:t==null?void 0:t.affiliation})]})]})]}),Me=({manuscriptUrl:t,manuscriptFile:a})=>{const n=r=>{window.open(r,"_blank")};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[e.jsx(W,{className:"h-5 w-5 mr-2 text-blue-600"}),"Files"]}),e.jsx("div",{className:"space-y-4",children:t?e.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-blue-100 rounded-full p-2",children:e.jsx(W,{className:"h-4 w-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-800",children:"Manuscript"}),e.jsx("p",{className:"text-xs text-gray-500",children:a||"manuscript.pdf"})]})]}),e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>n(`${xe}/${a}`),children:e.jsx(ge,{className:"h-4 w-4"})})]})}):e.jsx("div",{className:"text-center py-4 text-gray-500",children:e.jsx("p",{children:"No files available"})})})]})},ke=({reviewers:t,loading:a,open:n,onClose:r,onAssign:c})=>{const[i,d]=h.useState(null),[x,m]=h.useState(!1),u=async()=>{if(i){m(!0);try{await c(i)}finally{m(!1)}}};return e.jsx(Y,{open:n,onOpenChange:r,children:e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsx(se,{children:"Assign Reviewer"})}),a?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(F,{className:"h-6 w-6 animate-spin"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Select Reviewer"}),e.jsxs("select",{className:"w-full p-2 border rounded-md",value:i||"",onChange:l=>d(l.target.value),children:[e.jsx("option",{value:"",children:"Select a reviewer"}),t.map(l=>e.jsxs("option",{value:l._id,children:[l.fullName," (",l.email,")"]},l._id))]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(v,{variant:"outline",onClick:r,children:"Cancel"}),e.jsxs(v,{disabled:!i||x,onClick:u,children:[x?e.jsx(F,{className:"h-4 w-4 animate-spin mr-2"}):null,"Assign"]})]})]})]})})},B=h.forwardRef(({className:t,...a},n)=>e.jsx("textarea",{className:re("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",t),ref:n,...a}));B.displayName="Textarea";const Ae=({submissionId:t,onSuccess:a,onCancel:n,nextRoundNumber:r})=>{const[c,i]=h.useState(r),[d,x]=h.useState(""),m=z({}),u=async l=>{var s,j;l.preventDefault();try{const N=await m.mutateAsync({api:R.createReviewRound,data:{submissionId:t,roundNumber:c,editorNotes:d.trim()||void 0}});(s=N.data)!=null&&s.success?(w.success("Review round created successfully"),a()):w.error(((j=N.data)==null?void 0:j.message)||"Failed to create review round")}catch{w.error("Something went wrong while creating the review round")}};return e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(S,{htmlFor:"roundNumber",children:"Round Number"}),e.jsx(ue,{id:"roundNumber",type:"number",value:c,onChange:l=>i(Number.parseInt(l.target.value)),min:1,required:!0})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"editorNotes",children:"Editor Notes (Optional)"}),e.jsx(B,{id:"editorNotes",value:d,onChange:l=>x(l.target.value),placeholder:"Add any notes for this review round",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(v,{type:"button",variant:"outline",onClick:n,children:"Cancel"}),e.jsxs(v,{type:"submit",disabled:m.isPending,children:[m.isPending&&e.jsx(F,{className:"h-4 w-4 mr-2 animate-spin"}),"Create Review Round"]})]})]})},_e={in_progress:{color:"bg-yellow-100 text-yellow-800",icon:e.jsx(P,{className:"h-4 w-4"})},completed:{color:"bg-green-100 text-green-800",icon:e.jsx(H,{className:"h-4 w-4"})},cancelled:{color:"bg-red-100 text-red-800",icon:e.jsx(J,{className:"h-4 w-4"})}},Ee=({submissionId:t,isAdmin:a,onSelectRound:n})=>{var l;const[r,c]=h.useState(!1),{data:i,isLoading:d,refetch:x}=V({api:`${(l=R)==null?void 0:l.getReviewRounds}?submissionId=${t}`,options:{enabled:!!t}}),m=(i==null?void 0:i.data)||[],u=()=>{c(!1),x()};return d?e.jsxs("div",{className:"space-y-4",children:[e.jsx(C,{className:"h-10 w-full"}),e.jsx(C,{className:"h-20 w-full"}),e.jsx(C,{className:"h-20 w-full"})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Review Rounds"}),a&&!r&&e.jsxs(v,{size:"sm",onClick:()=>c(!0),children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"New Round"]})]}),r&&e.jsx("div",{className:"mb-6 p-4 border border-gray-200 rounded-lg bg-gray-50",children:e.jsx(Ae,{submissionId:t,onSuccess:u,onCancel:()=>c(!1),nextRoundNumber:m.length+1})}),m.length>0?e.jsx("div",{className:"space-y-3",children:m.map(s=>{const j=_e[s.status]||{color:"bg-gray-100 text-gray-800",icon:e.jsx(k,{className:"h-4 w-4"})};return e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>n(s._id),children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("h3",{className:"font-medium text-gray-800",children:["Round ",s.roundNumber]}),e.jsxs(q,{className:`${j.color} flex items-center gap-1`,children:[j.icon,s.status.replace("_"," ")]})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Started: ",M(new Date(s.startDate),"MMM dd, yyyy"),s.endDate&&` • Ended: ${M(new Date(s.endDate),"MMM dd, yyyy")}`]}),s.editorNotes&&e.jsxs("p",{className:"text-sm text-gray-600 mt-2 italic",children:['"',s.editorNotes,'"']})]}),e.jsx(de,{className:"h-5 w-5 text-gray-400"})]})},s._id)})}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(P,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium mb-1",children:"No review rounds yet"}),e.jsx("p",{className:"text-sm",children:a?"Start the review process by creating a new review round.":"The review process has not started yet."})]})]})},$e=({reviewRoundId:t,submissionId:a,onSuccess:n,onCancel:r})=>{const[c,i]=h.useState(""),[d,x]=h.useState(""),[m,u]=h.useState(""),l=z({}),s=async j=>{var N,y;if(j.preventDefault(),!c){w.error("Please select a recommendation");return}try{const g=await l.mutateAsync({api:R.createReview,data:{reviewRoundId:t,submissionId:a,recommendation:c,comments:d.trim()||void 0,confidentialComments:m.trim()||void 0,submissionDate:new Date().toISOString(),status:"completed"}});(N=g.data)!=null&&N.success?(w.success("Review submitted successfully"),n()):w.error(((y=g.data)==null?void 0:y.message)||"Failed to submit review")}catch{w.error("Something went wrong while submitting the review")}};return e.jsxs("form",{onSubmit:s,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(S,{htmlFor:"recommendation",children:"Recommendation"}),e.jsxs(K,{value:c,onValueChange:i,children:[e.jsx(X,{id:"recommendation",children:e.jsx(G,{placeholder:"Select your recommendation"})}),e.jsxs(Q,{children:[e.jsx(b,{value:"accept",children:"Accept"}),e.jsx(b,{value:"minor_revisions",children:"Minor Revisions"}),e.jsx(b,{value:"major_revisions",children:"Major Revisions"}),e.jsx(b,{value:"reject",children:"Reject"})]})]})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"comments",children:"Comments to Author"}),e.jsx(B,{id:"comments",value:d,onChange:j=>x(j.target.value),placeholder:"Enter your comments for the author",rows:5})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"confidentialComments",children:"Confidential Comments to Editor"}),e.jsx(B,{id:"confidentialComments",value:m,onChange:j=>u(j.target.value),placeholder:"Enter confidential comments for the editor (not visible to the author)",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(v,{type:"button",variant:"outline",onClick:r,children:"Cancel"}),e.jsxs(v,{type:"submit",disabled:l==null?void 0:l.isPending,children:[(l==null?void 0:l.isPending)&&e.jsx(F,{className:"h-4 w-4 mr-2 animate-spin"}),"Submit Review"]})]})]})},De=({review:t,onBack:a,isAdmin:n})=>{const[r,c]=h.useState(!1),[i,d]=h.useState(t.status),[x,m]=h.useState(t.recommendation||""),[u,l]=h.useState(t.comments||""),[s,j]=h.useState(t.confidentialComments||""),N=z({}),y=ce({}),g=()=>{c(!0)},$=async()=>{var f,o;try{const p=await y.mutateAsync({api:`${R.updateReview}/${t._id}`,data:{status:i,recommendation:x,comments:u.trim()||void 0,confidentialComments:s.trim()||void 0}});(f=p.data)!=null&&f.success?(w.success("Review updated successfully"),c(!1),a()):w.error(((o=p.data)==null?void 0:o.message)||"Failed to update review")}catch{w.error("Something went wrong while updating the review")}},D=f=>{const p={pending:{color:"bg-yellow-100 text-yellow-800",icon:e.jsx(P,{className:"h-4 w-4"})},completed:{color:"bg-green-100 text-green-800",icon:e.jsx(H,{className:"h-4 w-4"})},declined:{color:"bg-red-100 text-red-800",icon:e.jsx(J,{className:"h-4 w-4"})},overdue:{color:"bg-orange-100 text-orange-800",icon:e.jsx(k,{className:"h-4 w-4"})}}[f]||{color:"bg-gray-100 text-gray-800",icon:e.jsx(k,{className:"h-4 w-4"})};return e.jsxs(q,{className:`${p.color} flex items-center gap-1 px-3 py-1`,children:[p.icon,f]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(v,{variant:"outline",onClick:a,children:"Back to Reviews"}),n&&e.jsxs(v,{onClick:g,children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Edit Review"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ne,{className:"h-5 w-5 mr-2 text-blue-600"}),e.jsxs("h2",{className:"text-xl font-semibold text-gray-800",children:["Review by ",t.reviewerId.fullName]})]}),D(t.status)]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(O,{className:"h-4 w-4 mr-1 text-blue-600"}),"Assigned Date"]}),e.jsx("p",{className:"text-gray-800",children:M(new Date(t.createdAt),"MMM dd, yyyy")})]}),t.submissionDate&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(O,{className:"h-4 w-4 mr-1 text-blue-600"}),"Submission Date"]}),e.jsx("p",{className:"text-gray-800",children:M(new Date(t.submissionDate),"MMM dd, yyyy")})]}),t.dueDate&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(O,{className:"h-4 w-4 mr-1 text-blue-600"}),"Due Date"]}),e.jsx("p",{className:"text-gray-800",children:M(new Date(t.dueDate),"MMM dd, yyyy")})]})]}),t.recommendation&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Recommendation"}),e.jsx("p",{className:"text-gray-800 font-medium",children:t.recommendation.replace("_"," ")})]}),t.comments&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Comments to Author"}),e.jsx("div",{className:"bg-gray-50 p-3 rounded-md whitespace-pre-line",children:t.comments})]}),n&&t.confidentialComments&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Confidential Comments to Editor"}),e.jsx("div",{className:"bg-gray-50 p-3 rounded-md whitespace-pre-line border-l-4 border-blue-400",children:t.confidentialComments})]})]}),e.jsx(Y,{open:r,onOpenChange:c,children:e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsx(se,{children:"Edit Review"})}),e.jsxs("div",{className:"space-y-4 mt-2",children:[e.jsxs("div",{children:[e.jsx(S,{children:"Status"}),e.jsxs(K,{value:i,onValueChange:d,children:[e.jsx(X,{children:e.jsx(G,{placeholder:"Select status"})}),e.jsxs(Q,{children:[e.jsx(b,{value:"pending",children:"Pending"}),e.jsx(b,{value:"completed",children:"Completed"}),e.jsx(b,{value:"declined",children:"Declined"}),e.jsx(b,{value:"overdue",children:"Overdue"})]})]})]}),e.jsxs("div",{children:[e.jsx(S,{children:"Recommendation"}),e.jsxs(K,{value:x,onValueChange:m,children:[e.jsx(X,{children:e.jsx(G,{placeholder:"Select recommendation"})}),e.jsxs(Q,{children:[e.jsx(b,{value:"accept",children:"Accept"}),e.jsx(b,{value:"minor_revisions",children:"Minor Revisions"}),e.jsx(b,{value:"major_revisions",children:"Major Revisions"}),e.jsx(b,{value:"reject",children:"Reject"})]})]})]}),e.jsxs("div",{children:[e.jsx(S,{children:"Comments to Author"}),e.jsx(B,{value:u,onChange:f=>l(f.target.value),placeholder:"Enter comments for the author",rows:4})]}),e.jsxs("div",{children:[e.jsx(S,{children:"Confidential Comments to Editor"}),e.jsx(B,{value:s,onChange:f=>j(f.target.value),placeholder:"Enter confidential comments for the editor",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(v,{variant:"outline",onClick:()=>c(!1),children:"Cancel"}),e.jsxs(v,{onClick:$,disabled:N.isPending,children:[N.isPending&&e.jsx(F,{className:"h-4 w-4 mr-2 animate-spin"}),"Update"]})]})]})]})})]})},Ie={pending:{color:"bg-yellow-100 text-yellow-800",icon:e.jsx(P,{className:"h-4 w-4"})},completed:{color:"bg-green-100 text-green-800",icon:e.jsx(H,{className:"h-4 w-4"})},declined:{color:"bg-red-100 text-red-800",icon:e.jsx(J,{className:"h-4 w-4"})},overdue:{color:"bg-orange-100 text-orange-800",icon:e.jsx(k,{className:"h-4 w-4"})}},Fe=({roundId:t,submissionId:a,isAdmin:n})=>{var f;const{user:r}=ae(),[c,i]=h.useState(null),[d,x]=h.useState(!1),{data:m,isLoading:u,refetch:l}=V({api:`${(f=R)==null?void 0:f.getReviews}?reviewRoundId=${t}`,options:{enabled:!!t}}),s=(m==null?void 0:m.data)||[],j=(r==null?void 0:r.role)==="Reviewer",N=s.find(o=>o.reviewerId._id===(r==null?void 0:r._id)),y=j&&!N&&!d,g=()=>{x(!1),l()},$=o=>{i(o)},D=()=>{i(null),l()};if(c){const o=s.find(p=>p._id===c);if(o)return e.jsx(De,{review:o,onBack:D,isAdmin:n})}return u?e.jsxs("div",{className:"space-y-4",children:[e.jsx(C,{className:"h-10 w-full"}),e.jsx(C,{className:"h-20 w-full"}),e.jsx(C,{className:"h-20 w-full"})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Reviews"}),y&&e.jsxs(v,{size:"sm",onClick:()=>x(!0),children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Submit Review"]})]}),d&&e.jsx("div",{className:"mb-6 p-4 border border-gray-200 rounded-lg bg-gray-50",children:e.jsx($e,{reviewRoundId:t,submissionId:a,onSuccess:g,onCancel:()=>x(!1)})}),s.length>0?e.jsx("div",{className:"space-y-3",children:s.map(o=>{const p=Ie[o.status]||{color:"bg-gray-100 text-gray-800",icon:e.jsx(k,{className:"h-4 w-4"})};return e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>$(o._id),children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ne,{className:"h-4 w-4 mr-1 text-blue-600"}),e.jsx("h3",{className:"font-medium text-gray-800",children:o.reviewerId.fullName})]}),e.jsxs(q,{className:`${p.color} flex items-center gap-1`,children:[p.icon,o.status]})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Assigned: ",M(new Date(o.createdAt),"MMM dd, yyyy"),o.submissionDate&&` • Submitted: ${M(new Date(o.submissionDate),"MMM dd, yyyy")}`]}),o.recommendation&&e.jsxs("p",{className:"text-sm font-medium mt-2",children:["Recommendation: ",e.jsx("span",{className:"text-blue-600",children:o.recommendation.replace("_"," ")})]})]}),e.jsx(de,{className:"h-5 w-5 text-gray-400"})]})},o._id)})}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ye,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium mb-1",children:"No reviews yet"}),e.jsx("p",{className:"text-sm",children:j?"Submit your review for this submission.":"No reviewers have submitted reviews yet."})]})]})},Be=({roundId:t,submissionId:a,isAdmin:n,onBack:r})=>{var o;const[c,i]=h.useState(!1),[d,x]=h.useState(""),[m,u]=h.useState(""),l=z({}),s=ce({}),{data:j,isLoading:N,refetch:y}=V({api:`${(o=R)==null?void 0:o.getReviewRoundById}/${t}`,options:{enabled:!!t}}),g=j==null?void 0:j.data,$=()=>{g&&(x(g.status),u(g.editorNotes||""),i(!0))},D=async()=>{var p,L,A;try{const T=await s.mutateAsync({api:`${(p=R)==null?void 0:p.updateReviewRound}/${t}`,data:{status:d,editorNotes:m.trim()||void 0,endDate:d==="completed"||d==="cancelled"?new Date().toISOString():void 0}});(L=T.data)!=null&&L.success?(w.success("Review round updated successfully"),i(!1),y()):w.error(((A=T.data)==null?void 0:A.message)||"Failed to update review round")}catch{w.error("Something went wrong while updating the review round")}},f=p=>{const A={in_progress:{color:"bg-yellow-100 text-yellow-800",icon:e.jsx(P,{className:"h-4 w-4"})},completed:{color:"bg-green-100 text-green-800",icon:e.jsx(H,{className:"h-4 w-4"})},cancelled:{color:"bg-red-100 text-red-800",icon:e.jsx(J,{className:"h-4 w-4"})}}[p]||{color:"bg-gray-100 text-gray-800",icon:e.jsx(k,{className:"h-4 w-4"})};return e.jsxs(q,{className:`${A.color} flex items-center gap-1 px-3 py-1`,children:[A.icon,p.replace("_"," ")]})};return N?e.jsxs("div",{className:"space-y-4",children:[e.jsx(C,{className:"h-10 w-full"}),e.jsx(C,{className:"h-20 w-full"}),e.jsx(C,{className:"h-20 w-full"})]}):g?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(v,{variant:"outline",onClick:r,children:"Back to Review Rounds"}),n&&e.jsxs(v,{onClick:$,children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Edit Round"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-800 mb-2 md:mb-0",children:["Review Round ",g.roundNumber]}),f(g.status)]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(O,{className:"h-4 w-4 mr-1 text-blue-600"}),"Start Date"]}),e.jsx("p",{className:"text-gray-800",children:M(new Date(g.startDate),"MMM dd, yyyy")})]}),g.endDate&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(O,{className:"h-4 w-4 mr-1 text-blue-600"}),"End Date"]}),e.jsx("p",{className:"text-gray-800",children:M(new Date(g.endDate),"MMM dd, yyyy")})]})]}),g.editorNotes&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Editor Notes"}),e.jsx("p",{className:"text-gray-800 bg-gray-50 p-3 rounded-md",children:g.editorNotes})]})]}),e.jsx(Fe,{roundId:t,submissionId:a,isAdmin:n}),e.jsx(Y,{open:c,onOpenChange:i,children:e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsx(se,{children:"Edit Review Round"})}),e.jsxs("div",{className:"space-y-4 mt-2",children:[e.jsxs("div",{children:[e.jsx(S,{children:"Status"}),e.jsxs(K,{value:d,onValueChange:x,children:[e.jsx(X,{children:e.jsx(G,{placeholder:"Select status"})}),e.jsxs(Q,{children:[e.jsx(b,{value:"in_progress",children:"In Progress"}),e.jsx(b,{value:"completed",children:"Completed"}),e.jsx(b,{value:"cancelled",children:"Cancelled"})]})]})]}),e.jsxs("div",{children:[e.jsx(S,{children:"Editor Notes"}),e.jsx(B,{value:m,onChange:p=>u(p.target.value),placeholder:"Add any notes for this review round",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(v,{variant:"outline",onClick:()=>i(!1),children:"Cancel"}),e.jsxs(v,{onClick:D,disabled:l.isPending,children:[l.isPending&&e.jsx(F,{className:"h-4 w-4 mr-2 animate-spin"}),"Update"]})]})]})]})})]}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(k,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium",children:"Review round not found"}),e.jsx(v,{variant:"outline",className:"mt-4",onClick:r,children:"Back to Review Rounds"})]})},Pe=({submissionId:t,isAdmin:a})=>{const[n,r]=h.useState(null),c=d=>{r(d)},i=()=>{r(null)};return e.jsx("div",{className:"mt-6",children:n?e.jsx(Be,{roundId:n,submissionId:t,isAdmin:a,onBack:i}):e.jsx(Ee,{submissionId:t,isAdmin:a,onSelectRound:c})})};function Le({isAdmin:t,reviewerAssignments:a=[],onDeleteAssignment:n}){const[r,c]=h.useState(!1),[i,d]=h.useState(!1),[x,m]=h.useState(null),{user:u}=ae(),l=async()=>{if(!(!x||!n)){c(!0);try{await n(x),d(!1)}catch{w.error("Failed to remove reviewer")}finally{c(!1)}}};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Review Assignments"}),a.length===0?e.jsx("p",{className:"text-gray-500",children:"No reviewers assigned yet"}):e.jsx("div",{className:"space-y-4",children:a.map(s=>e.jsx("div",{className:"border rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:s.reviewer.fullName}),e.jsx("p",{className:"text-sm text-gray-500",children:s.reviewer.email})]}),(t||s.reviewer._id===(u==null?void 0:u._id))&&e.jsx("div",{className:" ",children:t&&e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>{m(s._id),d(!0)},children:e.jsx(je,{className:"h-4 w-4 text-red-500"})})})]})},s._id))}),e.jsx(Y,{open:i,onOpenChange:d,children:e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsx(se,{children:"Remove Reviewer"})}),e.jsx("p",{children:"Are you sure you want to remove this reviewer?"}),e.jsxs(pe,{children:[e.jsx(v,{variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsxs(v,{variant:"destructive",onClick:l,disabled:r,children:[r&&e.jsx(F,{className:"h-4 w-4 animate-spin mr-2"}),"Remove"]})]})]})})]})}function rs(){var o,p,L,A,T,le,ie;const t=z({}),{submissionId:a}=he(),{user:n}=ae(),[r,c]=h.useState(!1),[i,d]=h.useState("details"),{data:x,isLoading:m}=V({api:`${(o=R)==null?void 0:o.getSubmissionsById}/${a}`,options:{enabled:!!a}}),{data:u,isLoading:l}=V({api:`${(p=R)==null?void 0:p.getAvailableReviewers}?submissionId=${a}`,options:{enabled:!!a&&(n==null?void 0:n.role)==="Admin"}}),s=x==null?void 0:x.data,j=((L=u==null?void 0:u.data)==null?void 0:L.docs)||[],N=(n==null?void 0:n.role)==="Reviewer",y=(n==null?void 0:n.role)==="Admin",g=_=>{if(!_)return"N/A";try{return M(new Date(_),"MMM dd, yyyy")}catch{return"Invalid date"}},$=async _=>{var E,U;try{const I=await t.mutateAsync({api:R.assignReviewer,data:{submissionId:a,reviewerId:_}});(E=I.data)!=null&&E.success?(w.success("Reviewer assigned successfully"),window.location.reload()):w.error(((U=I.data)==null?void 0:U.message)||"Failed to assign reviewer")}catch{w.error("Something went wrong while assigning reviewer")}},D=async _=>{var E,U;try{const I=await t.mutateAsync({api:R.deleteReviewerAssignment,data:{submissionId:a,reviewerId:_}});(E=I.data)!=null&&E.success?(w.success("Reviewer removed successfully"),window.location.reload()):w.error(((U=I.data)==null?void 0:U.message)||"Failed to remove reviewer")}catch{w.error("Something went wrong while removing reviewer")}};if(m)return e.jsx(be,{});const f=Re(s==null?void 0:s.status);return e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg shadow-md",children:[e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2 md:mb-0",children:s==null?void 0:s.title}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(q,{className:`${f==null?void 0:f.color} flex items-center gap-1 px-3 py-1 text-sm font-medium`,children:[f==null?void 0:f.icon,(A=s==null?void 0:s.status)==null?void 0:A.replace("_"," ").toUpperCase()]}),y&&e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>c(!0),children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Assign Reviewer"]})]})]}),e.jsxs("div",{className:"flex space-x-1 mb-8",children:[e.jsxs("button",{className:`px-6 py-3 font-medium text-sm rounded-t-lg transition-all duration-200 ${i==="details"?"text-white bg-gradient-to-r from-blue-500 to-blue-600 shadow-md":"text-gray-600 bg-gray-100 hover:bg-gray-200"}`,onClick:()=>d("details"),children:["Submission Details",i==="details"&&e.jsx("span",{className:"block w-6 h-1 mx-auto mt-2 bg-blue-300 rounded-full"})]}),e.jsxs("button",{className:`px-6 py-3 font-medium text-sm rounded-t-lg transition-all duration-200 ${i==="reviews"?"text-white bg-gradient-to-r from-blue-500 to-blue-600 shadow-md":"text-gray-600 bg-gray-100 hover:bg-gray-200"}`,onClick:()=>d("reviews"),children:["Review Process",i==="reviews"&&e.jsx("span",{className:"block w-6 h-1 mx-auto mt-2 bg-blue-300 rounded-full"})]})]}),y&&e.jsx(Le,{submissionId:a,isAdmin:y,reviewerAssignments:(s==null?void 0:s.reviewerAssignments)||[],onDeleteAssignment:D}),i==="details"?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mt-3",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[e.jsx(fe,{className:"h-5 w-5 mr-2 text-blue-600"}),"Submission Details"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Abstract"}),e.jsx("p",{className:"text-gray-800 whitespace-pre-line",children:s==null?void 0:s.abstract})]}),((T=s==null?void 0:s.keywords)==null?void 0:T.length)>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(we,{className:"h-4 w-4 mr-1 text-blue-600"}),"Keywords"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(le=s==null?void 0:s.keywords)==null?void 0:le.map((_,E)=>e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full",children:_},E))})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(Ne,{className:"h-4 w-4 mr-1 text-blue-600"}),"Journal"]}),e.jsx("p",{className:"text-gray-800",children:((ie=s==null?void 0:s.journalId)==null?void 0:ie.title)||"Journal information not available"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(O,{className:"h-4 w-4 mr-1 text-blue-600"}),"Submission Date"]}),e.jsx("p",{className:"text-gray-800",children:g((s==null?void 0:s.submissionDate)||(s==null?void 0:s.createdAt))})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(P,{className:"h-4 w-4 mr-1 text-blue-600"}),"Last Updated"]}),e.jsx("p",{className:"text-gray-800",children:g(s==null?void 0:s.updatedAt)})]})]})]})]})}),e.jsxs("div",{className:"space-y-6",children:[(y||N)&&e.jsx(Se,{author:s==null?void 0:s.submittedBy}),e.jsx(Me,{manuscriptUrl:s==null?void 0:s.fullManuscriptUrl,manuscriptFile:s==null?void 0:s.manuscriptFile})]})]}):e.jsx(Pe,{submissionId:a,isAdmin:y})]}),y&&e.jsx(ke,{reviewers:j,loading:l,open:r,onClose:()=>c(!1),onAssign:$})]})}export{rs as default};
