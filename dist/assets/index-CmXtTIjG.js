import{j as e,r as B,_ as x,S as oe,C as me}from"./index-BIllfr20.js";import{P as pe}from"./index-T8ld-CMs.js";import{r as g,u as xe}from"./router-GXfyPTrP.js";import{B as k}from"./button-BjwHA_Ot.js";import{c as he,d as ue,C as fe,a as je}from"./card-DGBako9R.js";import{T as ge,a as Ne,b as H,c as v,d as ye,e as w,P as we}from"./index-CjbS4w0t.js";import{d as ve,o as Se,F as Fe,R as le,j as be,B as Ce,e as Te,f as _,k as Pe,T as ce}from"./file-upload-CcKMJMAL.js";import{R as Me}from"./RHFTextArea-BWN2LrzE.js";import{u as Ae,b as ke,c as L}from"./useCustomQuery-kkihtKjO.js";import{D as Be,T as ze,S as Ie}from"./index-Cs5i9eEx.js";import{B as $e}from"./book-Bpfj_trI.js";import{T as qe}from"./tag-DOl-dKHL.js";import{B as Oe}from"./book-open-CxJ5VZxw.js";import{A as _e}from"./archive-C82h-jzl.js";import{U as ie}from"./upload-DMMZCkiE.js";import{F as X}from"./file-text-DSAM9nKx.js";import{S as Ee}from"./separator-DaEi8xlo.js";import{B as de}from"./badge-BHTVA8k8.js";import{D as Re,a as Ve,b as Ue,c as J}from"./dropdown-menu-dwdnybUQ.js";import{S as He}from"./search-CPiK2q8r.js";import{C as Je}from"./circle-plus-BCZZxFNP.js";import{S as ne}from"./square-pen-y_GftER1.js";import"./axios-DmypytPv.js";import"./chevron-right-CWFcGyHO.js";import"./index-CAeIp94X.js";import"./check-CmxJf1py.js";const Le=Te().shape({title:_().required("Title is required"),abstract:_().required("Abstract is required"),keywords:_(),journalId:_().required("Journal is required"),manuscriptFile:Pe().required("Manuscript file is required").test("fileType","Only PDF, DOC or DOCX files are accepted",o=>{if(!o)return!1;const c=Array.isArray(o)?o[0]:o;return c&&["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(c.type)}).test("fileSize","File size must be less than 10MB",o=>{if(!o)return!1;const c=Array.isArray(o)?o[0]:o;return c&&c.size<=10*1024*1024})});function Xe({open:o,setOpen:c,title:z,id:p,edit:h,setEdit:N,refetch:I}){var F,b,C;const[$,u]=g.useState(""),E=Ae({}),q=ke({}),{data:s,isFetching:S}=L({api:`${B.getSubmissionsById}/${p}`,options:{enabled:h}}),t=L({api:`${B.getAllJournal}?page=1&limit=100`,options:{enabled:!0}}),d=ve({defaultValues:{title:"",abstract:"",keywords:"",journalId:"",manuscriptFile:void 0},resolver:Se(Le)}),O=r=>{if(r.target.files&&r.target.files[0]){const l=r.target.files[0];if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(l.type)){x.error("Only PDF, DOC or DOCX files are allowed");return}if(l.size>10*1024*1024){x.error("File size should not exceed 10MB");return}d.setValue("manuscriptFile",l),u(l.name),x.success("Manuscript file selected successfully")}},R=()=>{d.setValue("manuscriptFile",""),u("")},V=async r=>{var l,m,f,j;try{const n=new FormData;n.append("title",r.title),n.append("abstract",r.abstract),r.keywords&&n.append("keywords",r.keywords),n.append("journalId",r.journalId);const y=Array.isArray(r.manuscriptFile)?r.manuscriptFile[0]:r.manuscriptFile;if(n.append("manuscriptFile",y),h&&p){const i=await q.mutateAsync({api:`${B.updateSubmissions}/${p}`,data:n,headers:{"Content-Type":"multipart/form-data"}});(l=i.data)!=null&&l.success?x.success((m=i==null?void 0:i.data)==null?void 0:m.message):x.error("Submission not updated successfully")}else{const i=await E.mutateAsync({api:B.createSubmissions,data:n,headers:{"Content-Type":"multipart/form-data"}});(f=i.data)!=null&&f.success?x.success((j=i==null?void 0:i.data)==null?void 0:j.message):x.error("Submission not created successfully")}c(!1),N&&N(!1),I&&I()}catch{x.error("Failed to submit the form")}};g.useEffect(()=>{var r,l,m,f,j,n,y,i,T;h&&s?(d.reset({title:(r=s==null?void 0:s.data)==null?void 0:r.title,abstract:(l=s==null?void 0:s.data)==null?void 0:l.abstract,keywords:(f=(m=s==null?void 0:s.data)==null?void 0:m.keywords)==null?void 0:f.join(", "),journalId:((n=(j=s==null?void 0:s.data)==null?void 0:j.journalId)==null?void 0:n._id)||((y=s==null?void 0:s.data)==null?void 0:y.journalId),manuscriptFile:void 0}),(i=s==null?void 0:s.data)!=null&&i.manuscriptFile&&u(((T=s==null?void 0:s.data)==null?void 0:T.manuscriptFile.split("/").pop())||"Current manuscript file")):(d.reset({title:"",abstract:"",keywords:"",journalId:"",manuscriptFile:void 0}),u(""))},[h,s,d.reset]);const U=()=>{const r=d.formState.errors,l=Object.entries(r).map(([,m])=>m==null?void 0:m.message).filter(Boolean);l.length>0&&x.error(l.join(", "))};return e.jsx(Be,{open:o,setOpen:c,title:z,setEdit:N,edit:h,isLoading:S,children:e.jsx(Fe,{methods:d,onSubmit:d.handleSubmit(V,U),children:e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"space-y-4 max-h-[75vh] overflow-y-auto pr-2",children:[e.jsxs("div",{className:"bg-white p-3 rounded-lg shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-800 mb-3 flex items-center",children:[e.jsx($e,{className:"h-5 w-5 mr-2 text-blue-600"}),"Basic Information"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative",children:e.jsx(le,{name:"title",label:"Submission Title",placeholder:"Enter a descriptive title for your submission",className:"pr-2 pl-2"})}),e.jsx("div",{className:"relative w-full",children:e.jsx(Me,{name:"abstract",label:"Abstract",placeholder:"Provide a concise summary of your submission",rows:4,className:"w-full border rounded-md p-1 shadow-sm"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"h-4 w-4 text-blue-600"}),e.jsx(le,{name:"keywords",label:"Keywords",placeholder:"E.g., research, medicine, technology (comma separated)",className:"pr-2 pl-2"})]})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-800 mb-3 flex items-center",children:[e.jsx(Oe,{className:"h-5 w-5 mr-2 text-blue-600"}),"Journal Information"]}),e.jsx("div",{className:"space-y-4",children:e.jsx(be,{name:"journalId",label:"Select Journal",data:(C=(b=(F=t==null?void 0:t.data)==null?void 0:F.data)==null?void 0:b.docs)==null?void 0:C.map(r=>({label:r.title,value:r._id})),className:"pr-2 pl-2"})})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-800 mb-3 flex items-center",children:[e.jsx(_e,{className:"h-5 w-5 mr-2 text-blue-600"}),"Manuscript File"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"border-2 border-dashed border-blue-200 rounded-lg p-4 bg-blue-50 hover:bg-blue-100 transition-colors",children:e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-2",children:[e.jsx(ie,{className:"h-10 w-10 text-blue-500"}),e.jsx("p",{className:"text-sm text-gray-600 text-center",children:"Upload your manuscript file (PDF, DOC, DOCX - max 10MB)"}),e.jsx("input",{type:"file",id:"manuscriptUpload",accept:".pdf,.doc,.docx,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document",onChange:O,className:"hidden"}),e.jsxs("label",{htmlFor:"manuscriptUpload",className:"px-4 py-2 bg-blue-600 text-white rounded-md cursor-pointer hover:bg-blue-700 transition-colors",children:[e.jsx(ie,{className:"h-4 w-4 inline mr-2"}),"Select Manuscript File"]})]})}),$&&e.jsx("div",{className:"bg-gray-100 p-3 rounded-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(X,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"text-gray-700 font-medium",children:$})]}),e.jsx("button",{type:"button",onClick:R,className:"text-red-500 hover:text-red-700",children:e.jsx(ze,{className:"h-4 w-4"})})]})}),e.jsx("input",{type:"hidden",...d.register("manuscriptFile")})]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs(Ce,{isLoading:d.formState.isSubmitting,type:"submit",className:"h-12 w-full rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-medium flex items-center justify-center",disabled:d.formState.isSubmitting,children:[e.jsx(Ie,{className:"h-5 w-5 mr-2"}),h?"Update Submission":"Submit Manuscript"]})})]})})})}function De(){var F,b,C,r,l,m,f,j,n,y,i,T,D,K,G,Q,W,Y,Z,ee,ae,te,se,re;const o=xe(),[c,z]=g.useState(1),[p,h]=g.useState(10),[N,I]=g.useState(""),[$,u]=g.useState(!1),[E,q]=g.useState(""),[s,S]=g.useState(!1),t=L({api:`${B.getAllSubmissions}?page=${c}&limit=${p}&q=${N}`,key:"getAllSubmissions",value:[c,p,N],options:{enabled:!0}}),d=a=>{u(!0),S(!0),q(a)},O=a=>{o(`/journal/submissions/${a}`)},R=a=>{I(a.target.value)},V=a=>{a.preventDefault(),z(1),t.refetch()},U=({submission:a,handleViewDetails:P})=>{var M,A;return e.jsx(fe,{className:"mb-4",children:e.jsxs(je,{className:"pt-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:a==null?void 0:a.title}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(M=a==null?void 0:a.journal)==null?void 0:M.title," â€¢ Submitted by ",(A=a==null?void 0:a.author)==null?void 0:A.fullName]})]}),e.jsx(de,{variant:"outline"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:a==null?void 0:a.abstract}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{size:"sm",onClick:()=>d(a==null?void 0:a._id),className:"flex items-center gap-1",children:[e.jsx(ne,{size:14})," Edit"]}),e.jsxs(k,{size:"sm",variant:"destructive",className:"flex items-center gap-1",children:[e.jsx(ce,{size:14})," Delete"]})]}),e.jsx("div",{className:"flex ",children:e.jsxs(k,{size:"sm",variant:"outline",onClick:()=>P(a==null?void 0:a._id),children:[e.jsx(X,{size:14,className:"mr-2"})," View Details"]})})]})]})})};return e.jsxs("main",{className:"container mx-auto px-4 py-6",children:[e.jsx(Xe,{open:$,setOpen:u,title:s?"Edit Submission":"Add Submission",id:E,edit:s,setEdit:S,refetch:t.refetch}),e.jsx("div",{className:"bg-white rounded-lg shadow",children:e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6",children:[e.jsx(he,{className:"text-xl font-bold",children:"Submission Management"}),e.jsxs("div",{className:"flex flex-col sm:flex-row w-full md:w-auto gap-3",children:[e.jsxs("form",{onSubmit:V,className:"relative w-full sm:w-64",children:[e.jsx("input",{type:"text",placeholder:"Search submissions...",value:N,onChange:R,className:"w-full h-10 pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"}),e.jsx(He,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"})]}),e.jsxs(k,{className:"flex items-center gap-2 whitespace-nowrap",onClick:()=>{S(!1),q(""),u(!0)},children:[e.jsx(Je,{size:18}),"Add Submission"]})]})]}),e.jsxs(ue,{className:"mb-4",children:["Total Submissions: ",((b=(F=t==null?void 0:t.data)==null?void 0:F.data)==null?void 0:b.totalDocs)||0]}),t!=null&&t.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(oe,{})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs(ge,{children:[e.jsx(Ne,{children:e.jsxs(H,{children:[e.jsx(v,{className:"w-12",children:"#"}),e.jsx(v,{children:"Title"}),e.jsx(v,{children:"Journal"}),e.jsx(v,{children:"Submitted By"}),e.jsx(v,{children:"Status"}),e.jsx(v,{className:"text-right",children:"Actions"})]})}),e.jsx(ye,{children:((l=(r=(C=t==null?void 0:t.data)==null?void 0:C.data)==null?void 0:r.docs)==null?void 0:l.length)===0?e.jsx(H,{children:e.jsx(w,{colSpan:7,className:"text-center py-8",children:"No submissions found"})}):(j=(f=(m=t==null?void 0:t.data)==null?void 0:m.data)==null?void 0:f.docs)==null?void 0:j.map((a,P)=>{var M,A;return e.jsxs(H,{children:[e.jsx(w,{children:c*p-p+P+1}),e.jsx(w,{className:"font-medium",children:a==null?void 0:a.title}),e.jsx(w,{children:(M=a==null?void 0:a.journal)==null?void 0:M.title}),e.jsx(w,{children:(A=a==null?void 0:a.author)==null?void 0:A.fullName}),e.jsx(w,{children:e.jsx(de,{variant:"outline",children:"Pending"})}),e.jsx(w,{className:"text-right",children:e.jsxs(Re,{children:[e.jsx(Ve,{asChild:!0,children:e.jsxs(k,{variant:"outline",size:"sm",className:"h-8 ml-auto flex items-center gap-1",children:["Actions ",e.jsx(me,{size:14})]})}),e.jsxs(Ue,{align:"end",children:[e.jsxs(J,{onClick:()=>d(a==null?void 0:a._id),children:[e.jsx(ne,{size:14,className:"mr-2"})," Edit"]}),e.jsxs(J,{onClick:()=>O(a==null?void 0:a._id),children:[e.jsx(X,{size:14,className:"mr-2"})," View Details"]}),e.jsxs(J,{className:"text-red-600",children:[e.jsx(ce,{size:14,className:"mr-2"})," Delete"]})]})]})})]},a==null?void 0:a._id)})})]})}),e.jsx("div",{className:"md:hidden",children:((i=(y=(n=t==null?void 0:t.data)==null?void 0:n.data)==null?void 0:y.docs)==null?void 0:i.length)===0?e.jsx("div",{className:"text-center py-8",children:"No submissions found"}):(K=(D=(T=t==null?void 0:t.data)==null?void 0:T.data)==null?void 0:D.docs)==null?void 0:K.map((a,P)=>e.jsx(U,{submission:a,index:P,handleViewDetails:O},a==null?void 0:a._id))}),e.jsx(Ee,{className:"my-4"}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",(c-1)*p+1," to ",Math.min(c*p,((Q=(G=t==null?void 0:t.data)==null?void 0:G.data)==null?void 0:Q.totalDocs)||0)," of ",((Y=(W=t==null?void 0:t.data)==null?void 0:W.data)==null?void 0:Y.totalDocs)||0," entries"]}),e.jsx(we,{page:c,perPage:p,totalPage:(ee=(Z=t==null?void 0:t.data)==null?void 0:Z.data)==null?void 0:ee.totalDocs,hasNextPage:(te=(ae=t==null?void 0:t.data)==null?void 0:ae.data)==null?void 0:te.hasNextPage,hasPrevPage:(re=(se=t==null?void 0:t.data)==null?void 0:se.data)==null?void 0:re.hasPrevPage,setPage:z,setPerPage:h})]})]})]})})]})}function ya(){return e.jsx(pe,{title:"Submission List",children:e.jsx("div",{children:e.jsx(De,{})})})}export{ya as default};
