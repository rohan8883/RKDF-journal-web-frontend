import{j as e,r as P,_ as m,B as W,S as X}from"./index-28nypth3.js";import{P as Z}from"./index-DonUvE_z.js";import{r as x}from"./router-DMIetGpf.js";import{h as D}from"./moment-BjLXg0w5.js";import{C as ee,b as se,d as ae,a as te}from"./card-CvN-M-qi.js";import{T as ie,a as re,b as G,c as l,d as de,e as o,P as ce}from"./index-T0kutfHW.js";import{u as ne,k as K,l as O,a as le,o as oe,F as me,R as u,B as he,c as xe,b as g,m as pe}from"./useCustomQuery-DJCcqIQ9.js";import{R as ue,S as Q}from"./separator-BE2tWqEJ.js";import{D as ge}from"./index-BI5uV9xV.js";import{g as fe}from"./services-KQnp_8oA.js";import{S as be}from"./index-CHp555pk.js";import{Y as ve}from"./switch-cchuJY35.js";import"./axios-DmypytPv.js";const Se=xe().shape({title:g().required("Title is required"),description:g().required("Description is required"),issn:g().required("ISSN is required"),publisher:g().required("Publisher is required"),foundedYear:pe().typeError("Founded year must be a number").required("Founded year is required"),website:g().url("Must be a valid URL").required("Website is required"),coverImage:g()});function ye({open:p,setOpen:f,title:Y,id:c,edit:h,setEdit:n,refetch:b}){const q=ne({}),v=K({}),{data:r,isFetching:w}=O({api:`${P.getJournalById}/${c}`,key:"getJournalById",options:{enabled:h}}),d=le({defaultValues:{title:"",description:"",issn:"",publisher:"",foundedYear:void 0,website:"",coverImage:""},resolver:oe(Se)}),S=async a=>{var j,J,y,N;try{if(h&&a){const i=await v.mutateAsync({api:`${P.updateJournal}/${c}`,data:a});(j=i.data)!=null&&j.success?m.success((J=i==null?void 0:i.data)==null?void 0:J.message):m.error("Journal not updated successfully")}else{const i=await q.mutateAsync({api:P.createJournal,data:a});(y=i.data)!=null&&y.success?m.success((N=i==null?void 0:i.data)==null?void 0:N.message):m.error("Journal not created successfully"),d.reset()}f(!1),n==null||n(!1),b==null||b()}catch{}};return x.useEffect(()=>{h&&r?d.reset({title:r.data.title,description:r.data.description,issn:r.data.issn,publisher:r.data.publisher,foundedYear:r.data.foundedYear,website:r.data.website,coverImage:r.data.coverImage||""}):d.reset({title:"",description:"",issn:"",publisher:"",foundedYear:void 0,website:"",coverImage:""})},[h,r]),e.jsx(ge,{open:p,setOpen:f,title:Y,setEdit:n,edit:h,isLoading:w,children:e.jsx(me,{methods:d,onSubmit:d.handleSubmit(S),children:e.jsxs("div",{className:"grid grid-cols-1 gap-x-2 gap-y-4",children:[e.jsx("div",{children:e.jsx(u,{name:"title",placeholder:"Enter journal title"})}),e.jsx("div",{children:e.jsx(ue,{name:"description",placeholder:"Enter journal description"})}),e.jsx("div",{children:e.jsx(u,{name:"issn",placeholder:"Enter ISSN number"})}),e.jsx("div",{children:e.jsx(u,{name:"publisher",placeholder:"Enter publisher name"})}),e.jsx("div",{children:e.jsx(u,{name:"foundedYear",placeholder:"Enter founded year",type:"number"})}),e.jsx("div",{children:e.jsx(u,{name:"website",placeholder:"Enter website URL"})}),e.jsx("div",{children:e.jsx(u,{name:"coverImage",placeholder:"Enter cover image URL (optional)"})}),e.jsx(Q,{}),e.jsx("div",{children:e.jsx(he,{isLoading:d.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Submit"})})]})})})}function Ne(){var y,N,i,F,A,C,I,T,E,R,k;const[p,f]=x.useState(1),Y=K({}),[c,h]=x.useState(10),[n,b]=x.useState(""),[q,v]=x.useState(!1),[r,w]=x.useState(""),[d,S]=x.useState(!1),a=O({api:`${P.getAllJournal}?page=${p}&limit=${c}&q=${n}`,key:"getAllJournals",value:[p,c,n],options:{enabled:!0}}),j=s=>{w(s),S(!0),v(!0)},J=async s=>{var $,B,L,M,H,_,U,z,V;try{const t=await Y.mutateAsync({api:`${($=P)==null?void 0:$.updateJournalStatus}/${s}`,data:{}});(B=t==null?void 0:t.data)!=null&&B.success?(a.refetch(),((M=(L=t==null?void 0:t.data)==null?void 0:L.data)==null?void 0:M.status)===1?m.success((H=t.data)==null?void 0:H.message):((U=(_=t==null?void 0:t.data)==null?void 0:_.data)==null?void 0:U.status)===0&&m.error((z=t.data)==null?void 0:z.message)):m.error((V=t.data)==null?void 0:V.message)}catch(t){m.error(fe(t))}};return e.jsxs("main",{className:"flex-1",children:[e.jsx(ye,{open:q,setOpen:v,title:d?"Edit Journal":"Add Journal",id:r,edit:d,setEdit:S,refetch:a.refetch}),e.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[e.jsxs("div",{className:"flex w-full justify-between gap-2",children:[e.jsx("div",{children:e.jsx(be,{search:n,setSearch:b,setPage:f,refetch:a.refetch,isFetching:a.isLoading})}),e.jsx("div",{children:e.jsx(W,{className:"flex items-center gap-2",onClick:()=>{w(""),S(!1),v(!0)},children:"Add New"})})]}),e.jsxs(ee,{children:[e.jsx(se,{className:"px-7",children:e.jsxs(ae,{children:["Journal List (",((N=(y=a.data)==null?void 0:y.data)==null?void 0:N.totalDocs)||0,")"]})}),e.jsx(te,{children:a.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(X,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(ie,{children:[e.jsx(re,{children:e.jsxs(G,{children:[e.jsx(l,{className:"",children:"#"}),e.jsx(l,{className:"",children:"Title"}),e.jsx(l,{className:"",children:"Publisher"}),e.jsx(l,{className:"",children:"ISSN"}),e.jsx(l,{className:"",children:"Founded Year"}),e.jsx(l,{className:"",children:"Created at"}),e.jsx(l,{className:"",children:"Status"}),e.jsx(l,{children:"Action"})]})}),e.jsx(de,{children:(A=(F=(i=a==null?void 0:a.data)==null?void 0:i.data)==null?void 0:F.docs)==null?void 0:A.map((s,$)=>e.jsxs(G,{children:[e.jsx(o,{children:p*c-c+$+1}),e.jsx(o,{children:s==null?void 0:s.title}),e.jsx(o,{children:s==null?void 0:s.publisher}),e.jsx(o,{children:s==null?void 0:s.issn}),e.jsx(o,{children:s==null?void 0:s.foundedYear}),e.jsx(o,{children:D(s==null?void 0:s.createdAt).format("DD-MM-YYYY")}),e.jsx(o,{children:e.jsxs(ve,{checked:(s==null?void 0:s.status)===1,onChange:()=>J(s._id),className:`${(s==null?void 0:s.status)===1?"bg-primary":"bg-gray-200"} relative inline-flex items-center h-6 rounded-full w-11`,children:[e.jsx("span",{className:"sr-only",children:"Toggle status"}),e.jsx("span",{className:`${(s==null?void 0:s.status)===1?"translate-x-6":"translate-x-1"} inline-block w-4 h-4 transform bg-white rounded-full`})]})}),e.jsx(o,{children:e.jsx(W,{onClick:()=>j(s==null?void 0:s._id),size:"sm",children:"Edit"})})]},s==null?void 0:s._id))})]}),e.jsx(Q,{className:"mb-2 mt-4"}),e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(ce,{page:p,perPage:c,totalPage:(I=(C=a==null?void 0:a.data)==null?void 0:C.data)==null?void 0:I.totalDocs,hasNextPage:(E=(T=a==null?void 0:a.data)==null?void 0:T.data)==null?void 0:E.hasNextPage,hasPrevPage:(k=(R=a==null?void 0:a.data)==null?void 0:R.data)==null?void 0:k.hasPrevPage,setPage:f,setPerPage:h})})]})})]})]})]})}function Re(){return e.jsx(Z,{title:"Journals Page",children:e.jsx(Ne,{})})}export{Re as default};
