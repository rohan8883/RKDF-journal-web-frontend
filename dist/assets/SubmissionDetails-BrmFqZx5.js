import{c as W,j as e,d as le,B as me,r as M,_ as v,f as ie}from"./index-CDf_FfrT.js";import{r as g,b as xe}from"./router-GXfyPTrP.js";import{u as O,L as S,I as he,c as U,S as H,d as J,e as K,f as X,g as y,b as re}from"./useCustomQuery-D_zByj3Z.js";import{B as f}from"./button-BmATf1Bi.js";import{B as V}from"./badge-Cq50dHsH.js";import{F as G}from"./file-text-Ba4n1plx.js";import{C as I}from"./clock-rUrM07PG.js";import{C as A}from"./circle-alert-4L3d5YTo.js";import{C as z}from"./circle-check-big-rqVEyzLF.js";import{C as q}from"./circle-x-Cc7Q6YMh.js";import{U as Y}from"./user-BZsNGUrn.js";import{E as ue}from"./external-link-C01o0cjP.js";import{D as Z,a as ee,b as se,c as te}from"./dialog-dLVdVixx.js";import{C as ce}from"./chevron-right-bE6D0kJH.js";import{f as k}from"./format-CWZx4aKk.js";import{S as de}from"./square-pen-Bv2lUeMv.js";import{C as P}from"./calendar-CmiNYZ_h.js";import{U as je}from"./users-CQROc-oE.js";import{B as ge}from"./book-BDS-h6i8.js";import{T as pe}from"./tag-C7L173Zj.js";import{B as fe}from"./book-open-BmdvmUSn.js";import"./axios-DmypytPv.js";/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=W("ClipboardCheck",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=W("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=W("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);function b({className:t,...a}){return e.jsx("div",{className:le("animate-pulse rounded-md bg-primary/10",t),...a})}const ve=()=>e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{className:"h-8 w-3/4"}),e.jsx(b,{className:"h-4 w-1/4"}),e.jsx(b,{className:"h-24 w-full"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(b,{className:"h-12 w-full"}),e.jsx(b,{className:"h-12 w-full"})]})]})}),we={submitted:{color:"bg-blue-100 text-blue-800",icon:e.jsx(G,{className:"h-4 w-4"})},pending:{color:"bg-yellow-100 text-yellow-800",icon:e.jsx(I,{className:"h-4 w-4"})},under_review:{color:"bg-blue-100 text-blue-800",icon:e.jsx(A,{className:"h-4 w-4"})},accepted:{color:"bg-green-100 text-green-800",icon:e.jsx(z,{className:"h-4 w-4"})},rejected:{color:"bg-red-100 text-red-800",icon:e.jsx(q,{className:"h-4 w-4"})},revisions_required:{color:"bg-purple-100 text-purple-800",icon:e.jsx(G,{className:"h-4 w-4"})}},ye=t=>{const a={color:"bg-gray-100 text-gray-800",icon:e.jsx(A,{className:"h-4 w-4"})};return t&&we[t]||a},be=({author:t})=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[e.jsx(Y,{className:"h-5 w-5 mr-2 text-blue-600"}),"Author Information"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Name"}),e.jsx("p",{className:"text-gray-800",children:(t==null?void 0:t.fullName)||"Author information not available"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Email"}),e.jsx("p",{className:"text-gray-800",children:(t==null?void 0:t.email)||"Email not available"})]}),(t==null?void 0:t.affiliation)&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Affiliation"}),e.jsx("p",{className:"text-gray-800",children:t==null?void 0:t.affiliation})]})]})]}),Ce=({manuscriptUrl:t,manuscriptFile:a})=>{const l=r=>{window.open(r,"_blank")};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[e.jsx(G,{className:"h-5 w-5 mr-2 text-blue-600"}),"Files"]}),e.jsx("div",{className:"space-y-4",children:t?e.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-blue-100 rounded-full p-2",children:e.jsx(G,{className:"h-4 w-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-800",children:"Manuscript"}),e.jsx("p",{className:"text-xs text-gray-500",children:a||"manuscript.pdf"})]})]}),e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>l(`${me}/${a}`),children:e.jsx(ue,{className:"h-4 w-4"})})]})}):e.jsx("div",{className:"text-center py-4 text-gray-500",children:e.jsx("p",{children:"No files available"})})})]})},Re=({reviewers:t,loading:a,open:l,onClose:r,onAssign:c})=>{const[i,o]=g.useState(null),[x,m]=g.useState(!1),p=async()=>{if(i){m(!0);try{await c(i)}finally{m(!1)}}};return e.jsx(Z,{open:l,onOpenChange:r,children:e.jsxs(ee,{children:[e.jsx(se,{children:e.jsx(te,{children:"Assign Reviewer"})}),a?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(L,{className:"h-6 w-6 animate-spin"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Select Reviewer"}),e.jsxs("select",{className:"w-full p-2 border rounded-md",value:i||"",onChange:n=>o(n.target.value),children:[e.jsx("option",{value:"",children:"Select a reviewer"}),t.map(n=>e.jsxs("option",{value:n._id,children:[n.fullName," (",n.email,")"]},n._id))]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(f,{variant:"outline",onClick:r,children:"Cancel"}),e.jsxs(f,{disabled:!i||x,onClick:p,children:[x?e.jsx(L,{className:"h-4 w-4 animate-spin mr-2"}):null,"Assign"]})]})]})]})})},$=g.forwardRef(({className:t,...a},l)=>e.jsx("textarea",{className:le("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",t),ref:l,...a}));$.displayName="Textarea";const Se=({submissionId:t,onSuccess:a,onCancel:l,nextRoundNumber:r})=>{const[c,i]=g.useState(r),[o,x]=g.useState(""),m=O({}),p=async n=>{var s,h;n.preventDefault();try{const w=await m.mutateAsync({api:M.createReviewRound,data:{submissionId:t,roundNumber:c,editorNotes:o.trim()||void 0}});(s=w.data)!=null&&s.success?(v.success("Review round created successfully"),a()):v.error(((h=w.data)==null?void 0:h.message)||"Failed to create review round")}catch{v.error("Something went wrong while creating the review round")}};return e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(S,{htmlFor:"roundNumber",children:"Round Number"}),e.jsx(he,{id:"roundNumber",type:"number",value:c,onChange:n=>i(Number.parseInt(n.target.value)),min:1,required:!0})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"editorNotes",children:"Editor Notes (Optional)"}),e.jsx($,{id:"editorNotes",value:o,onChange:n=>x(n.target.value),placeholder:"Add any notes for this review round",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(f,{type:"button",variant:"outline",onClick:l,children:"Cancel"}),e.jsxs(f,{type:"submit",disabled:m.isPending,children:[m.isPending&&e.jsx(L,{className:"h-4 w-4 mr-2 animate-spin"}),"Create Review Round"]})]})]})},Me={in_progress:{color:"bg-yellow-100 text-yellow-800",icon:e.jsx(I,{className:"h-4 w-4"})},completed:{color:"bg-green-100 text-green-800",icon:e.jsx(z,{className:"h-4 w-4"})},cancelled:{color:"bg-red-100 text-red-800",icon:e.jsx(q,{className:"h-4 w-4"})}},ke=({submissionId:t,isAdmin:a,onSelectRound:l})=>{var n;const[r,c]=g.useState(!1),{data:i,isLoading:o,refetch:x}=U({api:`${(n=M)==null?void 0:n.getReviewRounds}?submissionId=${t}`,options:{enabled:!!t}}),m=(i==null?void 0:i.data)||[],p=()=>{c(!1),x()};return o?e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{className:"h-10 w-full"}),e.jsx(b,{className:"h-20 w-full"}),e.jsx(b,{className:"h-20 w-full"})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Review Rounds"}),a&&!r&&e.jsxs(f,{size:"sm",onClick:()=>c(!0),children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"New Round"]})]}),r&&e.jsx("div",{className:"mb-6 p-4 border border-gray-200 rounded-lg bg-gray-50",children:e.jsx(Se,{submissionId:t,onSuccess:p,onCancel:()=>c(!1),nextRoundNumber:m.length+1})}),m.length>0?e.jsx("div",{className:"space-y-3",children:m.map(s=>{const h=Me[s.status]||{color:"bg-gray-100 text-gray-800",icon:e.jsx(A,{className:"h-4 w-4"})};return e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>l(s._id),children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("h3",{className:"font-medium text-gray-800",children:["Round ",s.roundNumber]}),e.jsxs(V,{className:`${h.color} flex items-center gap-1`,children:[h.icon,s.status.replace("_"," ")]})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Started: ",k(new Date(s.startDate),"MMM dd, yyyy"),s.endDate&&` â€¢ Ended: ${k(new Date(s.endDate),"MMM dd, yyyy")}`]}),s.editorNotes&&e.jsxs("p",{className:"text-sm text-gray-600 mt-2 italic",children:['"',s.editorNotes,'"']})]}),e.jsx(ce,{className:"h-5 w-5 text-gray-400"})]})},s._id)})}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(I,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium mb-1",children:"No review rounds yet"}),e.jsx("p",{className:"text-sm",children:a?"Start the review process by creating a new review round.":"The review process has not started yet."})]})]})},Ae=({reviewRoundId:t,submissionId:a,onSuccess:l,onCancel:r})=>{const[c,i]=g.useState(""),[o,x]=g.useState(""),[m,p]=g.useState(""),n=O({}),s=async h=>{var w,C;if(h.preventDefault(),!c){v.error("Please select a recommendation");return}try{const u=await n.mutateAsync({api:M.createReview,data:{reviewRoundId:t,submissionId:a,recommendation:c,comments:o.trim()||void 0,confidentialComments:m.trim()||void 0,submissionDate:new Date().toISOString(),status:"completed"}});(w=u.data)!=null&&w.success?(v.success("Review submitted successfully"),l()):v.error(((C=u.data)==null?void 0:C.message)||"Failed to submit review")}catch{v.error("Something went wrong while submitting the review")}};return e.jsxs("form",{onSubmit:s,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(S,{htmlFor:"recommendation",children:"Recommendation"}),e.jsxs(H,{value:c,onValueChange:i,children:[e.jsx(J,{id:"recommendation",children:e.jsx(K,{placeholder:"Select your recommendation"})}),e.jsxs(X,{children:[e.jsx(y,{value:"accept",children:"Accept"}),e.jsx(y,{value:"minor_revisions",children:"Minor Revisions"}),e.jsx(y,{value:"major_revisions",children:"Major Revisions"}),e.jsx(y,{value:"reject",children:"Reject"})]})]})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"comments",children:"Comments to Author"}),e.jsx($,{id:"comments",value:o,onChange:h=>x(h.target.value),placeholder:"Enter your comments for the author",rows:5})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"confidentialComments",children:"Confidential Comments to Editor"}),e.jsx($,{id:"confidentialComments",value:m,onChange:h=>p(h.target.value),placeholder:"Enter confidential comments for the editor (not visible to the author)",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(f,{type:"button",variant:"outline",onClick:r,children:"Cancel"}),e.jsxs(f,{type:"submit",disabled:n==null?void 0:n.isPending,children:[(n==null?void 0:n.isPending)&&e.jsx(L,{className:"h-4 w-4 mr-2 animate-spin"}),"Submit Review"]})]})]})},Ee=({review:t,onBack:a,isAdmin:l})=>{const[r,c]=g.useState(!1),[i,o]=g.useState(t.status),[x,m]=g.useState(t.recommendation||""),[p,n]=g.useState(t.comments||""),[s,h]=g.useState(t.confidentialComments||""),w=O({}),C=re({}),u=()=>{c(!0)},_=async()=>{var N,d;try{const j=await C.mutateAsync({api:`${M.updateReview}/${t._id}`,data:{status:i,recommendation:x,comments:p.trim()||void 0,confidentialComments:s.trim()||void 0}});(N=j.data)!=null&&N.success?(v.success("Review updated successfully"),c(!1),a()):v.error(((d=j.data)==null?void 0:d.message)||"Failed to update review")}catch{v.error("Something went wrong while updating the review")}},R=N=>{const j={pending:{color:"bg-yellow-100 text-yellow-800",icon:e.jsx(I,{className:"h-4 w-4"})},completed:{color:"bg-green-100 text-green-800",icon:e.jsx(z,{className:"h-4 w-4"})},declined:{color:"bg-red-100 text-red-800",icon:e.jsx(q,{className:"h-4 w-4"})},overdue:{color:"bg-orange-100 text-orange-800",icon:e.jsx(A,{className:"h-4 w-4"})}}[N]||{color:"bg-gray-100 text-gray-800",icon:e.jsx(A,{className:"h-4 w-4"})};return e.jsxs(V,{className:`${j.color} flex items-center gap-1 px-3 py-1`,children:[j.icon,N]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(f,{variant:"outline",onClick:a,children:"Back to Reviews"}),l&&e.jsxs(f,{onClick:u,children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Edit Review"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Y,{className:"h-5 w-5 mr-2 text-blue-600"}),e.jsxs("h2",{className:"text-xl font-semibold text-gray-800",children:["Review by ",t.reviewerId.fullName]})]}),R(t.status)]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(P,{className:"h-4 w-4 mr-1 text-blue-600"}),"Assigned Date"]}),e.jsx("p",{className:"text-gray-800",children:k(new Date(t.createdAt),"MMM dd, yyyy")})]}),t.submissionDate&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(P,{className:"h-4 w-4 mr-1 text-blue-600"}),"Submission Date"]}),e.jsx("p",{className:"text-gray-800",children:k(new Date(t.submissionDate),"MMM dd, yyyy")})]}),t.dueDate&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(P,{className:"h-4 w-4 mr-1 text-blue-600"}),"Due Date"]}),e.jsx("p",{className:"text-gray-800",children:k(new Date(t.dueDate),"MMM dd, yyyy")})]})]}),t.recommendation&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Recommendation"}),e.jsx("p",{className:"text-gray-800 font-medium",children:t.recommendation.replace("_"," ")})]}),t.comments&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Comments to Author"}),e.jsx("div",{className:"bg-gray-50 p-3 rounded-md whitespace-pre-line",children:t.comments})]}),l&&t.confidentialComments&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Confidential Comments to Editor"}),e.jsx("div",{className:"bg-gray-50 p-3 rounded-md whitespace-pre-line border-l-4 border-blue-400",children:t.confidentialComments})]})]}),e.jsx(Z,{open:r,onOpenChange:c,children:e.jsxs(ee,{children:[e.jsx(se,{children:e.jsx(te,{children:"Edit Review"})}),e.jsxs("div",{className:"space-y-4 mt-2",children:[e.jsxs("div",{children:[e.jsx(S,{children:"Status"}),e.jsxs(H,{value:i,onValueChange:o,children:[e.jsx(J,{children:e.jsx(K,{placeholder:"Select status"})}),e.jsxs(X,{children:[e.jsx(y,{value:"pending",children:"Pending"}),e.jsx(y,{value:"completed",children:"Completed"}),e.jsx(y,{value:"declined",children:"Declined"}),e.jsx(y,{value:"overdue",children:"Overdue"})]})]})]}),e.jsxs("div",{children:[e.jsx(S,{children:"Recommendation"}),e.jsxs(H,{value:x,onValueChange:m,children:[e.jsx(J,{children:e.jsx(K,{placeholder:"Select recommendation"})}),e.jsxs(X,{children:[e.jsx(y,{value:"accept",children:"Accept"}),e.jsx(y,{value:"minor_revisions",children:"Minor Revisions"}),e.jsx(y,{value:"major_revisions",children:"Major Revisions"}),e.jsx(y,{value:"reject",children:"Reject"})]})]})]}),e.jsxs("div",{children:[e.jsx(S,{children:"Comments to Author"}),e.jsx($,{value:p,onChange:N=>n(N.target.value),placeholder:"Enter comments for the author",rows:4})]}),e.jsxs("div",{children:[e.jsx(S,{children:"Confidential Comments to Editor"}),e.jsx($,{value:s,onChange:N=>h(N.target.value),placeholder:"Enter confidential comments for the editor",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(f,{variant:"outline",onClick:()=>c(!1),children:"Cancel"}),e.jsxs(f,{onClick:_,disabled:w.isPending,children:[w.isPending&&e.jsx(L,{className:"h-4 w-4 mr-2 animate-spin"}),"Update"]})]})]})]})})]})},_e={pending:{color:"bg-yellow-100 text-yellow-800",icon:e.jsx(I,{className:"h-4 w-4"})},completed:{color:"bg-green-100 text-green-800",icon:e.jsx(z,{className:"h-4 w-4"})},declined:{color:"bg-red-100 text-red-800",icon:e.jsx(q,{className:"h-4 w-4"})},overdue:{color:"bg-orange-100 text-orange-800",icon:e.jsx(A,{className:"h-4 w-4"})}},$e=({roundId:t,submissionId:a,isAdmin:l})=>{var N;const{user:r}=ie(),[c,i]=g.useState(null),[o,x]=g.useState(!1),{data:m,isLoading:p,refetch:n}=U({api:`${(N=M)==null?void 0:N.getReviews}?reviewRoundId=${t}`,options:{enabled:!!t}}),s=(m==null?void 0:m.data)||[],h=(r==null?void 0:r.role)==="Reviewer",w=s.find(d=>d.reviewerId._id===(r==null?void 0:r._id)),C=h&&!w&&!o,u=()=>{x(!1),n()},_=d=>{i(d)},R=()=>{i(null),n()};if(c){const d=s.find(j=>j._id===c);if(d)return e.jsx(Ee,{review:d,onBack:R,isAdmin:l})}return p?e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{className:"h-10 w-full"}),e.jsx(b,{className:"h-20 w-full"}),e.jsx(b,{className:"h-20 w-full"})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Reviews"}),C&&e.jsxs(f,{size:"sm",onClick:()=>x(!0),children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Submit Review"]})]}),o&&e.jsx("div",{className:"mb-6 p-4 border border-gray-200 rounded-lg bg-gray-50",children:e.jsx(Ae,{reviewRoundId:t,submissionId:a,onSuccess:u,onCancel:()=>x(!1)})}),s.length>0?e.jsx("div",{className:"space-y-3",children:s.map(d=>{const j=_e[d.status]||{color:"bg-gray-100 text-gray-800",icon:e.jsx(A,{className:"h-4 w-4"})};return e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>_(d._id),children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Y,{className:"h-4 w-4 mr-1 text-blue-600"}),e.jsx("h3",{className:"font-medium text-gray-800",children:d.reviewerId.fullName})]}),e.jsxs(V,{className:`${j.color} flex items-center gap-1`,children:[j.icon,d.status]})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Assigned: ",k(new Date(d.createdAt),"MMM dd, yyyy"),d.submissionDate&&` â€¢ Submitted: ${k(new Date(d.submissionDate),"MMM dd, yyyy")}`]}),d.recommendation&&e.jsxs("p",{className:"text-sm font-medium mt-2",children:["Recommendation: ",e.jsx("span",{className:"text-blue-600",children:d.recommendation.replace("_"," ")})]})]}),e.jsx(ce,{className:"h-5 w-5 text-gray-400"})]})},d._id)})}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Ne,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium mb-1",children:"No reviews yet"}),e.jsx("p",{className:"text-sm",children:h?"Submit your review for this submission.":"No reviewers have submitted reviews yet."})]})]})},Ie=({roundId:t,submissionId:a,isAdmin:l,onBack:r})=>{var d;const[c,i]=g.useState(!1),[o,x]=g.useState(""),[m,p]=g.useState(""),n=O({}),s=re({}),{data:h,isLoading:w,refetch:C}=U({api:`${(d=M)==null?void 0:d.getReviewRoundById}/${t}`,options:{enabled:!!t}}),u=h==null?void 0:h.data,_=()=>{u&&(x(u.status),p(u.editorNotes||""),i(!0))},R=async()=>{var j,B,E;try{const F=await s.mutateAsync({api:`${(j=M)==null?void 0:j.updateReviewRound}/${t}`,data:{status:o,editorNotes:m.trim()||void 0,endDate:o==="completed"||o==="cancelled"?new Date().toISOString():void 0}});(B=F.data)!=null&&B.success?(v.success("Review round updated successfully"),i(!1),C()):v.error(((E=F.data)==null?void 0:E.message)||"Failed to update review round")}catch{v.error("Something went wrong while updating the review round")}},N=j=>{const E={in_progress:{color:"bg-yellow-100 text-yellow-800",icon:e.jsx(I,{className:"h-4 w-4"})},completed:{color:"bg-green-100 text-green-800",icon:e.jsx(z,{className:"h-4 w-4"})},cancelled:{color:"bg-red-100 text-red-800",icon:e.jsx(q,{className:"h-4 w-4"})}}[j]||{color:"bg-gray-100 text-gray-800",icon:e.jsx(A,{className:"h-4 w-4"})};return e.jsxs(V,{className:`${E.color} flex items-center gap-1 px-3 py-1`,children:[E.icon,j.replace("_"," ")]})};return w?e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{className:"h-10 w-full"}),e.jsx(b,{className:"h-20 w-full"}),e.jsx(b,{className:"h-20 w-full"})]}):u?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(f,{variant:"outline",onClick:r,children:"Back to Review Rounds"}),l&&e.jsxs(f,{onClick:_,children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Edit Round"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-800 mb-2 md:mb-0",children:["Review Round ",u.roundNumber]}),N(u.status)]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(P,{className:"h-4 w-4 mr-1 text-blue-600"}),"Start Date"]}),e.jsx("p",{className:"text-gray-800",children:k(new Date(u.startDate),"MMM dd, yyyy")})]}),u.endDate&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(P,{className:"h-4 w-4 mr-1 text-blue-600"}),"End Date"]}),e.jsx("p",{className:"text-gray-800",children:k(new Date(u.endDate),"MMM dd, yyyy")})]})]}),u.editorNotes&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Editor Notes"}),e.jsx("p",{className:"text-gray-800 bg-gray-50 p-3 rounded-md",children:u.editorNotes})]})]}),e.jsx($e,{roundId:t,submissionId:a,isAdmin:l}),e.jsx(Z,{open:c,onOpenChange:i,children:e.jsxs(ee,{children:[e.jsx(se,{children:e.jsx(te,{children:"Edit Review Round"})}),e.jsxs("div",{className:"space-y-4 mt-2",children:[e.jsxs("div",{children:[e.jsx(S,{children:"Status"}),e.jsxs(H,{value:o,onValueChange:x,children:[e.jsx(J,{children:e.jsx(K,{placeholder:"Select status"})}),e.jsxs(X,{children:[e.jsx(y,{value:"in_progress",children:"In Progress"}),e.jsx(y,{value:"completed",children:"Completed"}),e.jsx(y,{value:"cancelled",children:"Cancelled"})]})]})]}),e.jsxs("div",{children:[e.jsx(S,{children:"Editor Notes"}),e.jsx($,{value:m,onChange:j=>p(j.target.value),placeholder:"Add any notes for this review round",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(f,{variant:"outline",onClick:()=>i(!1),children:"Cancel"}),e.jsxs(f,{onClick:R,disabled:n.isPending,children:[n.isPending&&e.jsx(L,{className:"h-4 w-4 mr-2 animate-spin"}),"Update"]})]})]})]})})]}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(A,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium",children:"Review round not found"}),e.jsx(f,{variant:"outline",className:"mt-4",onClick:r,children:"Back to Review Rounds"})]})},Be=({submissionId:t,isAdmin:a})=>{const[l,r]=g.useState(null),c=o=>{r(o)},i=()=>{r(null)};return e.jsx("div",{className:"mt-6",children:l?e.jsx(Ie,{roundId:l,submissionId:t,isAdmin:a,onBack:i}):e.jsx(ke,{submissionId:t,isAdmin:a,onSelectRound:c})})};function as(){var N,d,j,B,E,F,ae;const t=O({}),{submissionId:a}=xe(),{user:l}=ie(),[r,c]=g.useState(!1),[i,o]=g.useState("details"),{data:x,isLoading:m}=U({api:`${(N=M)==null?void 0:N.getSubmissionsById}/${a}`,options:{enabled:!!a}}),{data:p,isLoading:n}=U({api:`${(d=M)==null?void 0:d.getAvailableReviewers}?submissionId=${a}`,options:{enabled:!!a&&(l==null?void 0:l.role)==="Admin"}}),s=x==null?void 0:x.data,h=((j=p==null?void 0:p.data)==null?void 0:j.docs)||[],w=(l==null?void 0:l.role)==="Reviewer",C=(l==null?void 0:l.role)==="Admin",u=D=>{if(!D)return"N/A";try{return k(new Date(D),"MMM dd, yyyy")}catch{return"Invalid date"}},_=async D=>{var T,ne;try{const Q=await t.mutateAsync({api:M.assignReviewer,data:{submissionId:a,reviewerId:D}});(T=Q.data)!=null&&T.success?(v.success("Reviewer assigned successfully"),window.location.reload()):v.error(((ne=Q.data)==null?void 0:ne.message)||"Failed to assign reviewer")}catch{v.error("Something went wrong while assigning reviewer")}};if(m)return e.jsx(ve,{});const R=ye(s==null?void 0:s.status);return e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg shadow-md",children:[e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2 md:mb-0",children:s==null?void 0:s.title}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(V,{className:`${R==null?void 0:R.color} flex items-center gap-1 px-3 py-1 text-sm font-medium`,children:[R==null?void 0:R.icon,(B=s==null?void 0:s.status)==null?void 0:B.replace("_"," ").toUpperCase()]}),C&&e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>c(!0),children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Assign Reviewer"]})]})]}),e.jsxs("div",{className:"flex space-x-1 mb-8",children:[e.jsxs("button",{className:`px-6 py-3 font-medium text-sm rounded-t-lg transition-all duration-200 ${i==="details"?"text-white bg-gradient-to-r from-blue-500 to-blue-600 shadow-md":"text-gray-600 bg-gray-100 hover:bg-gray-200"}`,onClick:()=>o("details"),children:["Submission Details",i==="details"&&e.jsx("span",{className:"block w-6 h-1 mx-auto mt-2 bg-blue-300 rounded-full"})]}),e.jsxs("button",{className:`px-6 py-3 font-medium text-sm rounded-t-lg transition-all duration-200 ${i==="reviews"?"text-white bg-gradient-to-r from-blue-500 to-blue-600 shadow-md":"text-gray-600 bg-gray-100 hover:bg-gray-200"}`,onClick:()=>o("reviews"),children:["Review Process",i==="reviews"&&e.jsx("span",{className:"block w-6 h-1 mx-auto mt-2 bg-blue-300 rounded-full"})]})]}),i==="details"?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[e.jsx(ge,{className:"h-5 w-5 mr-2 text-blue-600"}),"Submission Details"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Abstract"}),e.jsx("p",{className:"text-gray-800 whitespace-pre-line",children:s==null?void 0:s.abstract})]}),((E=s==null?void 0:s.keywords)==null?void 0:E.length)>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(pe,{className:"h-4 w-4 mr-1 text-blue-600"}),"Keywords"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(F=s==null?void 0:s.keywords)==null?void 0:F.map((D,T)=>e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full",children:D},T))})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(fe,{className:"h-4 w-4 mr-1 text-blue-600"}),"Journal"]}),e.jsx("p",{className:"text-gray-800",children:((ae=s==null?void 0:s.journalId)==null?void 0:ae.title)||"Journal information not available"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(P,{className:"h-4 w-4 mr-1 text-blue-600"}),"Submission Date"]}),e.jsx("p",{className:"text-gray-800",children:u((s==null?void 0:s.submissionDate)||(s==null?void 0:s.createdAt))})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(I,{className:"h-4 w-4 mr-1 text-blue-600"}),"Last Updated"]}),e.jsx("p",{className:"text-gray-800",children:u(s==null?void 0:s.updatedAt)})]})]})]})]})}),e.jsxs("div",{className:"space-y-6",children:[(C||w)&&e.jsx(be,{author:s==null?void 0:s.submittedBy}),e.jsx(Ce,{manuscriptUrl:s==null?void 0:s.fullManuscriptUrl,manuscriptFile:s==null?void 0:s.manuscriptFile})]})]}):e.jsx(Be,{submissionId:a,isAdmin:C})]}),C&&e.jsx(Re,{reviewers:h,loading:n,open:r,onClose:()=>c(!1),onAssign:_})]})}export{as as default};
