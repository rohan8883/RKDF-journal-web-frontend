import{j as r,_ as F,l as I}from"./index-DB-U-9Cm.js";import{g as S,d as P,r as E}from"./router-DMIetGpf.js";import{u as T,o as k,F as z,R as j,i as B,k as C,B as L,c as U,a as f,j as O}from"./FileUpload-_tdyE3Rx.js";import{P as V}from"./index-DnNvtFnL.js";import{u as H}from"./useCustomQuery-DlPzsp6X.js";import{R as _}from"./RHFTextArea-4e_miSQI.js";import{C as $}from"./index-C3YBl3HR.js";import"./axios-DmypytPv.js";import"./select-DAEbas5a.js";var A={exports:{}};(()=>{var v={d:(s,d)=>{for(var m in d)v.o(d,m)&&!v.o(s,m)&&Object.defineProperty(s,m,{enumerable:!0,get:d[m]})},o:(s,d)=>Object.prototype.hasOwnProperty.call(s,d),r:s=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})}},h={};function n(s,d){for(var m=0;m<d.length;m++){var e=d[m];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(s,e.key,e)}}v.r(h),v.d(h,{default:()=>M});var w=function(){function s(){(function(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")})(this,s)}var d,m;return d=s,m=[{key:"changeHeightWidth",value:function(e,a,t,i,o,u){return t>i&&(e=Math.round(e*i/t),t=i),e>a&&(t=Math.round(t*a/e),e=a),o&&t<o&&(e=Math.round(e*o/t),t=o),u&&e<u&&(t=Math.round(t*u/e),e=u),{height:e,width:t}}},{key:"resizeAndRotateImage",value:function(e,a,t,i,o){var u=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"jpeg",g=arguments.length>6&&arguments[6]!==void 0?arguments[6]:100,l=arguments.length>7&&arguments[7]!==void 0?arguments[7]:0,R=g/100,p=document.createElement("canvas"),x=e.width,y=e.height,b=this.changeHeightWidth(y,t,x,a,i,o);!l||l!==90&&l!==270?(p.width=b.width,p.height=b.height):(p.width=b.height,p.height=b.width),x=b.width,y=b.height;var c=p.getContext("2d");return c.fillStyle="rgba(0, 0, 0, 0)",c.fillRect(0,0,x,y),c.imageSmoothingEnabled&&c.imageSmoothingQuality&&(c.imageSmoothingQuality="high"),l&&(c.rotate(l*Math.PI/180),l===90?c.translate(0,-p.width):l===180?c.translate(-p.width,-p.height):l===270?c.translate(-p.height,0):l!==0&&l!==360||c.translate(0,0)),c.drawImage(e,0,0,x,y),p.toDataURL("image/".concat(u),R)}},{key:"b64toByteArrays",value:function(e,a){for(var t=atob(e.toString().replace(/^data:image\/(png|jpeg|jpg|webp);base64,/,"")),i=[],o=0;o<t.length;o+=512){for(var u=t.slice(o,o+512),g=new Array(u.length),l=0;l<u.length;l++)g[l]=u.charCodeAt(l);var R=new Uint8Array(g);i.push(R)}return i}},{key:"b64toBlob",value:function(e,a){var t=this.b64toByteArrays(e,a);return new Blob(t,{type:a,lastModified:new Date})}},{key:"b64toFile",value:function(e,a,t){var i=this.b64toByteArrays(e,t);return new File(i,a,{type:t,lastModified:new Date})}},{key:"createResizedImage",value:function(e,a,t,i,o,u,g){var l=arguments.length>7&&arguments[7]!==void 0?arguments[7]:"base64",R=arguments.length>8&&arguments[8]!==void 0?arguments[8]:null,p=arguments.length>9&&arguments[9]!==void 0?arguments[9]:null,x=new FileReader;if(!e)throw Error("File Not Found!");if(e.type&&!e.type.includes("image"))throw Error("File Is NOT Image!");x.readAsDataURL(e),x.onload=function(){var y=new Image;y.src=x.result,y.onload=function(){var b=s.resizeAndRotateImage(y,a,t,R,p,i,o,u),c="image/".concat(i);switch(l){case"blob":var D=s.b64toBlob(b,c);g(D);break;case"base64":g(b);break;case"file":var N=e.name.toString().replace(/(png|jpeg|jpg|webp)$/i,"").concat(i.toString()),q=s.b64toFile(b,N,c);g(q);break;default:g(b)}}},x.onerror=function(y){throw Error(y)}}}],m&&n(d,m),s}();const M={imageFileResizer:function(s,d,m,e,a,t,i,o,u,g){return w.createResizedImage(s,d,m,e,a,t,i,o,u,g)}};A.exports=h})();var G=A.exports;const Q=S(G),W=v=>{const h=v.split(","),n=h[0].indexOf("base64")>=0?atob(h[1]):decodeURI(h[1]),w=h[0].split(":")[1].split(";")[0],M=new Uint8Array(n==null?void 0:n.length);for(let s=0;s<(n==null?void 0:n.length);s++)M[s]=n==null?void 0:n.charCodeAt(s);return new Blob([M],{type:w})},J=async v=>new Promise(n=>{Q.imageFileResizer(v,500,500,"JPEG",60,0,w=>{n(w)},"base64")}).then(n=>W(n)),K=U().shape({memberName:f().required("Member Name is required"),address:f().required("Address is required"),mobile:f().required("Mobile is required"),amount:f().required("Amount is required"),loanType:f().required("Loan Type is required"),interestRate:f().required("Interest Rate is required"),durationMonths:f().required("Duration Months is required"),startDate:f().required("Loan Date is required"),email:f().notRequired().email().label("Email"),gender:f().required().label("Gender"),imageUrl:O().nullable(),planMapping:f()});function ie(){const v=P(),h=H({}),[n,w]=E.useState(null),[M,s]=E.useState(null),d=T({defaultValues:{memberName:"",address:"",mobile:"",amount:"",interestRate:"",durationMonths:"",loanType:"",gender:"",startDate:"",email:"",imageUrl:null,planMapping:""},resolver:k(K)}),m=async a=>{const t=new FormData;t.append("memberName",a.memberName),t.append("address",a.address),t.append("mobile",a.mobile),t.append("startDate",a.startDate),t.append("amount",a.amount),t.append("loanType",a.loanType),t.append("interestRate",a.interestRate),t.append("durationMonths",a.durationMonths),t.append("email",(a==null?void 0:a.email)??""),t.append("gender",a.gender),t.append("imageUrl",M),$("Are you sure?","Do you want to request a new Loan?",async()=>{try{const i=await h.mutateAsync({api:I.createMember,data:t});i.data.success?(F.success(i.data.message),v("/loan/loan-list")):F.error(i.data.message)}catch{F.error("Something went wrong")}})},e=async()=>{var o;if(((o=n==null?void 0:n[0])==null?void 0:o.size)>20*1024*1024)return F.error("File size is too large");const a=n==null?void 0:n[0];if(!a)return;const t=await J(a),i=new File([t],a==null?void 0:a.name,{type:a==null?void 0:a.type});s(i)};return E.useEffect(()=>{n&&e()},[n]),r.jsxs(V,{title:"Add Member",children:[r.jsx("div",{className:"flex items-center justify-between mt-4",children:r.jsx("h1",{className:"text-base font-semibold text-muted-foreground",children:"ADD MEMBER"})}),r.jsx("div",{className:"border-t border-secondary mt-3"}),r.jsxs(z,{methods:d,onSubmit:d.handleSubmit(m),children:[r.jsx("div",{className:"mt-4",children:r.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[r.jsx("div",{children:r.jsx(j,{name:"memberName",label:"Member Name",placeholder:"Enter Member Name"})}),r.jsx("div",{children:r.jsx(j,{name:"email",label:"Email",placeholder:"Enter Email"})}),r.jsx("div",{children:r.jsx(j,{type:"number",name:"mobile",label:"Mobile",placeholder:"Enter Mobile",inputValidation:["mobile","number"]})}),r.jsx("div",{children:r.jsx(j,{type:"number",name:"amount",label:"Amount",placeholder:"Enter Amount",inputValidation:["number"]})}),r.jsx("div",{children:r.jsx(j,{type:"number",name:"interestRate",label:"Interest Rate",placeholder:"Enter Interest Rate",inputValidation:["number"]})}),r.jsx("div",{children:r.jsx(j,{type:"number",name:"durationMonths",label:"Duration Months",placeholder:"Enter Duration Months",inputValidation:["number"]})}),r.jsx("div",{children:r.jsx(j,{type:"date",name:"startDate",label:"Date of Loan",placeholder:"Enter Loan Date"})}),r.jsx("div",{children:r.jsx(j,{name:"loanType",label:"Purpose of Loan",placeholder:"Enter Loan Type"})}),r.jsx("div",{children:r.jsx(B,{label:"Gender",name:"gender",data:[{label:"Male",value:"male"},{label:"Female",value:"female"},{label:"Other",value:"other"}]})}),r.jsx("div",{className:"col-span-2",children:r.jsx(C,{onChangeValue:w,files:n,maxFiles:1,maxSize:20*1024*1024,accept:"image/*",multiple:!1})}),r.jsx("div",{className:"col-span-2",children:r.jsx(_,{name:"address",label:"Address",placeholder:"Enter Address"})})]})}),r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"border-t border-secondary mt-5"}),r.jsx("div",{className:"mt-8 flex justify-start",children:r.jsx(L,{type:"submit",className:"bg-primary text-white",isLoading:h.isPending,children:"Submit"})})]})]})]})}export{ie as default};
