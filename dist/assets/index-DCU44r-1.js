import{j as e,r as O,_ as m,B as S,S as pe,C as xe}from"./index-qpQYrg8D.js";import{P as he}from"./index-jqKdOx7X.js";import{r as x,d as ue}from"./router-DMIetGpf.js";import{c as fe,d as je,C as ge,a as Ne}from"./card-ReX3hggF.js";import{T as ye,a as ve,b as Y,c as b,d as we,e as v,P as Se}from"./index-Bdg4XSpZ.js";import{u as be,o as Fe,F as Ce,R as ce,k as Te,B as Ae,c as Le,a as J,l as ie,T as ne}from"./file-upload-DUUER_JG.js";import{R as Pe}from"./RHFTextArea-BH_ks411.js";import{D as Me,T as de,F as ze,S as ke}from"./index-BFmHnlK3.js";import{u as Be,a as Oe,b as Z}from"./useCustomQuery-Bmkk5bpv.js";import{B as Ie}from"./book-D65Wrols.js";import{T as $e}from"./tag-CqI3dSl9.js";import{B as Ve}from"./book-open-jEPWYbzQ.js";import{A as qe}from"./archive-U7zZoQKm.js";import{U as K}from"./upload-BPT9osYe.js";import{F as I}from"./file-text-CkO7R4sx.js";import{F as _e}from"./file-symlink-BSq8h50h.js";import{S as Ee}from"./separator-DzM_CpjD.js";import{B as oe}from"./badge-BbaaeNzJ.js";import{D as Ue,a as De,b as Re,c as G,S as me}from"./dropdown-menu-CfhyfzvJ.js";import{S as Xe}from"./search-D7z0G3sp.js";import{C as He}from"./circle-plus-BXDiFOSI.js";import"./axios-DmypytPv.js";import"./check-roh18dN7.js";const Je=Le().shape({title:J().required("Title is required"),abstract:J().required("Abstract is required"),keywords:J(),journalId:J().required("Journal is required"),manuscriptFile:ie().required("Manuscript file is required").test("fileType","Only PDF, DOC or DOCX files are accepted",r=>{if(!r)return!1;const l=Array.isArray(r)?r[0]:r;return l&&["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(l.type)}).test("fileSize","File size must be less than 10MB",r=>{if(!r)return!1;const l=Array.isArray(r)?r[0]:r;return l&&l.size<=10*1024*1024}),coverLetter:ie().test("fileType","Only PDF, DOC or DOCX files are accepted",r=>{if(!r)return!0;const l=Array.isArray(r)?r[0]:r;return l&&["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(l.type)}).test("fileSize","File size must be less than 5MB",r=>{if(!r)return!0;const l=Array.isArray(r)?r[0]:r;return l&&l.size<=5*1024*1024})});function Ke({open:r,setOpen:l,title:$,id:p,edit:h,setEdit:g,refetch:V}){var C,T,A;const[q,u]=x.useState(""),[_,N]=x.useState(""),E=Be({}),F=Oe({}),{data:t,isFetching:U}=Z({api:`${O.getSubmissionsById}/${p}`,options:{enabled:h}}),w=Z({api:`${O.getAllJournal}?page=1&limit=100`,options:{enabled:!0}}),n=be({defaultValues:{title:"",abstract:"",keywords:"",journalId:"",manuscriptFile:void 0,coverLetter:void 0},resolver:Fe(Je)}),Q=a=>{if(a.target.files&&a.target.files[0]){const c=a.target.files[0];if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(c.type)){m.error("Only PDF, DOC or DOCX files are allowed");return}if(c.size>10*1024*1024){m.error("File size should not exceed 10MB");return}n.setValue("manuscriptFile",c),u(c.name),m.success("Manuscript file selected successfully")}},W=a=>{if(a.target.files&&a.target.files[0]){const c=a.target.files[0];if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(c.type)){m.error("Only PDF, DOC or DOCX files are allowed");return}if(c.size>5*1024*1024){m.error("File size should not exceed 5MB");return}n.setValue("coverLetter",c),N(c.name),m.success("Cover letter file selected successfully")}},D=()=>{n.setValue("manuscriptFile",""),u("")},R=()=>{n.setValue("coverLetter",void 0),N("")},X=async a=>{var c,o,f,j;try{const d=new FormData;d.append("title",a.title),d.append("abstract",a.abstract),a.keywords&&d.append("keywords",a.keywords),d.append("journalId",a.journalId);const y=Array.isArray(a.manuscriptFile)?a.manuscriptFile[0]:a.manuscriptFile;if(d.append("manuscriptFile",y),a.coverLetter){const i=Array.isArray(a.coverLetter)?a.coverLetter[0]:a.coverLetter;d.append("coverLetter",i)}if(h&&p){const i=await F.mutateAsync({api:`${O.updateSubmissions}/${p}`,data:d,headers:{"Content-Type":"multipart/form-data"}});(c=i.data)!=null&&c.success?m.success((o=i==null?void 0:i.data)==null?void 0:o.message):m.error("Submission not updated successfully")}else{const i=await E.mutateAsync({api:O.createSubmissions,data:d,headers:{"Content-Type":"multipart/form-data"}});(f=i.data)!=null&&f.success?m.success((j=i==null?void 0:i.data)==null?void 0:j.message):m.error("Submission not created successfully")}l(!1),g&&g(!1),V&&V()}catch{m.error("Failed to submit the form")}};x.useEffect(()=>{var a,c,o,f,j,d,y,i,L,P,M;h&&t?(n.reset({title:(a=t==null?void 0:t.data)==null?void 0:a.title,abstract:(c=t==null?void 0:t.data)==null?void 0:c.abstract,keywords:(f=(o=t==null?void 0:t.data)==null?void 0:o.keywords)==null?void 0:f.join(", "),journalId:((d=(j=t==null?void 0:t.data)==null?void 0:j.journalId)==null?void 0:d._id)||((y=t==null?void 0:t.data)==null?void 0:y.journalId),manuscriptFile:void 0,coverLetter:void 0}),(i=t==null?void 0:t.data)!=null&&i.manuscriptFile&&u(((L=t==null?void 0:t.data)==null?void 0:L.manuscriptFile.split("/").pop())||"Current manuscript file"),(P=t==null?void 0:t.data)!=null&&P.coverLetter&&N(((M=t==null?void 0:t.data)==null?void 0:M.coverLetter.split("/").pop())||"Current cover letter")):(n.reset({title:"",abstract:"",keywords:"",journalId:"",manuscriptFile:void 0,coverLetter:void 0}),u(""),N(""))},[h,t,n.reset]);const H=()=>{const a=n.formState.errors,c=Object.entries(a).map(([,o])=>o==null?void 0:o.message).filter(Boolean);c.length>0&&m.error(c.join(", "))};return e.jsx(Me,{open:r,setOpen:l,title:$,setEdit:g,edit:h,isLoading:U,children:e.jsx(Ce,{methods:n,onSubmit:n.handleSubmit(X,H),children:e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"space-y-4 max-h-[75vh] overflow-y-auto pr-2",children:[e.jsxs("div",{className:"bg-white p-3 rounded-lg shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-800 mb-3 flex items-center",children:[e.jsx(Ie,{className:"h-5 w-5 mr-2 text-blue-600"}),"Basic Information"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative",children:e.jsx(ce,{name:"title",label:"Submission Title",placeholder:"Enter a descriptive title for your submission",className:"pr-2 pl-2"})}),e.jsx("div",{className:"relative w-full",children:e.jsx(Pe,{name:"abstract",label:"Abstract",placeholder:"Provide a concise summary of your submission",rows:4,className:"w-full border rounded-md p-1 shadow-sm"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"h-4 w-4 text-blue-600"}),e.jsx(ce,{name:"keywords",label:"Keywords",placeholder:"E.g., research, medicine, technology (comma separated)",className:"pr-2 pl-2"})]})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-800 mb-3 flex items-center",children:[e.jsx(Ve,{className:"h-5 w-5 mr-2 text-blue-600"}),"Journal Information"]}),e.jsx("div",{className:"space-y-4",children:e.jsx(Te,{name:"journalId",label:"Select Journal",data:(A=(T=(C=w==null?void 0:w.data)==null?void 0:C.data)==null?void 0:T.docs)==null?void 0:A.map(a=>({label:a.title,value:a._id})),className:"pr-2 pl-2"})})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-800 mb-3 flex items-center",children:[e.jsx(qe,{className:"h-5 w-5 mr-2 text-blue-600"}),"Manuscript File"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"border-2 border-dashed border-blue-200 rounded-lg p-4 bg-blue-50 hover:bg-blue-100 transition-colors",children:e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-2",children:[e.jsx(K,{className:"h-10 w-10 text-blue-500"}),e.jsx("p",{className:"text-sm text-gray-600 text-center",children:"Upload your manuscript file (PDF, DOC, DOCX - max 10MB)"}),e.jsx("input",{type:"file",id:"manuscriptUpload",accept:".pdf,.doc,.docx,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document",onChange:Q,className:"hidden"}),e.jsxs("label",{htmlFor:"manuscriptUpload",className:"px-4 py-2 bg-blue-600 text-white rounded-md cursor-pointer hover:bg-blue-700 transition-colors",children:[e.jsx(K,{className:"h-4 w-4 inline mr-2"}),"Select Manuscript File"]})]})}),q&&e.jsx("div",{className:"bg-gray-100 p-3 rounded-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"text-gray-700 font-medium",children:q})]}),e.jsx("button",{type:"button",onClick:D,className:"text-red-500 hover:text-red-700",children:e.jsx(de,{className:"h-4 w-4"})})]})}),e.jsx("input",{type:"hidden",...n.register("manuscriptFile")})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-800 mb-3 flex items-center",children:[e.jsx(_e,{className:"h-5 w-5 mr-2 text-blue-600"}),"Cover Letter (Optional)"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"border-2 border-dashed border-blue-200 rounded-lg p-4 bg-blue-50 hover:bg-blue-100 transition-colors",children:e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-2",children:[e.jsx(K,{className:"h-10 w-10 text-blue-500"}),e.jsx("p",{className:"text-sm text-gray-600 text-center",children:"Upload a cover letter for your submission (PDF, DOC, DOCX - max 5MB)"}),e.jsx("input",{type:"file",id:"coverLetterUpload",accept:".pdf,.doc,.docx,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document",onChange:W,className:"hidden"}),e.jsxs("label",{htmlFor:"coverLetterUpload",className:"px-4 py-2 bg-blue-600 text-white rounded-md cursor-pointer hover:bg-blue-700 transition-colors",children:[e.jsx(K,{className:"h-4 w-4 inline mr-2"}),"Select Cover Letter"]})]})}),_&&e.jsx("div",{className:"bg-gray-100 p-3 rounded-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ze,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"text-gray-700 font-medium",children:_})]}),e.jsx("button",{type:"button",onClick:R,className:"text-red-500 hover:text-red-700",children:e.jsx(de,{className:"h-4 w-4"})})]})}),e.jsx("input",{type:"hidden",...n.register("coverLetter")})]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs(Ae,{isLoading:n.formState.isSubmitting,type:"submit",className:"h-12 w-full rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-medium flex items-center justify-center",disabled:n.formState.isSubmitting,children:[e.jsx(ke,{className:"h-5 w-5 mr-2"}),h?"Update Submission":"Submit Manuscript"]})})]})})})}function Ge(){var D,R,X,H,C,T,A,a,c,o,f,j,d,y,i,L,P,M,ee,te,se,ae,re,le;const r=ue(),[l,$]=x.useState(1),[p,h]=x.useState(10),[g,V]=x.useState(""),[q,u]=x.useState(!1),[_,N]=x.useState(""),[E,F]=x.useState(!1),t=Z({api:`${O.getAllSubmissions}?page=${l}&limit=${p}&q=${g}`,key:"getAllSubmissions",value:[l,p,g],options:{enabled:!0}}),U=s=>{u(!0),F(!0),N(s)},w=s=>{r(`/journal/submissions/${s}`)},n=s=>{V(s.target.value)},Q=s=>{s.preventDefault(),$(1),t.refetch()},W=({submission:s,handleViewDetails:z})=>{var k,B;return e.jsx(ge,{className:"mb-4",children:e.jsxs(Ne,{className:"pt-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:s==null?void 0:s.title}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(k=s==null?void 0:s.journal)==null?void 0:k.title," â€¢ Submitted by ",(B=s==null?void 0:s.author)==null?void 0:B.fullName]})]}),e.jsx(oe,{variant:"outline"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:s==null?void 0:s.abstract}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(S,{size:"sm",onClick:()=>U(s==null?void 0:s._id),className:"flex items-center gap-1",children:[e.jsx(me,{size:14})," Edit"]}),e.jsxs(S,{size:"sm",variant:"destructive",className:"flex items-center gap-1",children:[e.jsx(ne,{size:14})," Delete"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(S,{size:"sm",variant:"outline",children:[e.jsx(I,{size:14,className:"mr-2"})," View Files"]}),e.jsxs(S,{size:"sm",variant:"outline",onClick:()=>z(s==null?void 0:s._id),children:[e.jsx(I,{size:14,className:"mr-2"})," View Details"]})]})]})]})})};return e.jsxs("main",{className:"container mx-auto px-4 py-6",children:[e.jsx(Ke,{open:q,setOpen:u,title:E?"Edit Submission":"Add Submission",id:_,edit:E,setEdit:F,refetch:t.refetch}),e.jsx("div",{className:"bg-white rounded-lg shadow",children:e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6",children:[e.jsx(fe,{className:"text-xl font-bold",children:"Submission Management"}),e.jsxs("div",{className:"flex flex-col sm:flex-row w-full md:w-auto gap-3",children:[e.jsxs("form",{onSubmit:Q,className:"relative w-full sm:w-64",children:[e.jsx("input",{type:"text",placeholder:"Search submissions...",value:g,onChange:n,className:"w-full h-10 pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"}),e.jsx(Xe,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"})]}),e.jsxs(S,{className:"flex items-center gap-2 whitespace-nowrap",onClick:()=>{F(!1),N(""),u(!0)},children:[e.jsx(He,{size:18}),"Add Submission"]})]})]}),e.jsxs(je,{className:"mb-4",children:["Total Submissions: ",((R=(D=t==null?void 0:t.data)==null?void 0:D.data)==null?void 0:R.totalDocs)||0]}),t!=null&&t.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(pe,{})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs(ye,{children:[e.jsx(ve,{children:e.jsxs(Y,{children:[e.jsx(b,{className:"w-12",children:"#"}),e.jsx(b,{children:"Title"}),e.jsx(b,{children:"Journal"}),e.jsx(b,{children:"Submitted By"}),e.jsx(b,{children:"Status"}),e.jsx(b,{className:"text-right",children:"Actions"})]})}),e.jsx(we,{children:((C=(H=(X=t==null?void 0:t.data)==null?void 0:X.data)==null?void 0:H.docs)==null?void 0:C.length)===0?e.jsx(Y,{children:e.jsx(v,{colSpan:7,className:"text-center py-8",children:"No submissions found"})}):(a=(A=(T=t==null?void 0:t.data)==null?void 0:T.data)==null?void 0:A.docs)==null?void 0:a.map((s,z)=>{var k,B;return e.jsxs(Y,{children:[e.jsx(v,{children:l*p-p+z+1}),e.jsx(v,{className:"font-medium",children:s==null?void 0:s.title}),e.jsx(v,{children:(k=s==null?void 0:s.journal)==null?void 0:k.title}),e.jsx(v,{children:(B=s==null?void 0:s.author)==null?void 0:B.fullName}),e.jsx(v,{children:e.jsx(oe,{variant:"outline",children:"Pending"})}),e.jsx(v,{className:"text-right",children:e.jsxs(Ue,{children:[e.jsx(De,{asChild:!0,children:e.jsxs(S,{variant:"outline",size:"sm",className:"h-8 ml-auto flex items-center gap-1",children:["Actions ",e.jsx(xe,{size:14})]})}),e.jsxs(Re,{align:"end",children:[e.jsxs(G,{onClick:()=>U(s==null?void 0:s._id),children:[e.jsx(me,{size:14,className:"mr-2"})," Edit"]}),e.jsxs(G,{className:"text-red-600",children:[e.jsx(ne,{size:14,className:"mr-2"})," Delete"]}),e.jsxs(G,{children:[e.jsx(I,{size:14,className:"mr-2"})," View Files"]}),e.jsxs(G,{onClick:()=>w(s==null?void 0:s._id),children:[e.jsx(I,{size:14,className:"mr-2"})," View Details"]})]})]})})]},s==null?void 0:s._id)})})]})}),e.jsx("div",{className:"md:hidden",children:((f=(o=(c=t==null?void 0:t.data)==null?void 0:c.data)==null?void 0:o.docs)==null?void 0:f.length)===0?e.jsx("div",{className:"text-center py-8",children:"No submissions found"}):(y=(d=(j=t==null?void 0:t.data)==null?void 0:j.data)==null?void 0:d.docs)==null?void 0:y.map((s,z)=>e.jsx(W,{submission:s,index:z,handleViewDetails:w},s==null?void 0:s._id))}),e.jsx(Ee,{className:"my-4"}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",(l-1)*p+1," to ",Math.min(l*p,((L=(i=t==null?void 0:t.data)==null?void 0:i.data)==null?void 0:L.totalDocs)||0)," of ",((M=(P=t==null?void 0:t.data)==null?void 0:P.data)==null?void 0:M.totalDocs)||0," entries"]}),e.jsx(Se,{page:l,perPage:p,totalPage:(te=(ee=t==null?void 0:t.data)==null?void 0:ee.data)==null?void 0:te.totalDocs,hasNextPage:(ae=(se=t==null?void 0:t.data)==null?void 0:se.data)==null?void 0:ae.hasNextPage,hasPrevPage:(le=(re=t==null?void 0:t.data)==null?void 0:re.data)==null?void 0:le.hasPrevPage,setPage:$,setPerPage:h})]})]})]})})]})}function Nt(){return e.jsx(he,{title:"Submission List",children:e.jsx("div",{children:e.jsx(Ge,{})})})}export{Nt as default};
