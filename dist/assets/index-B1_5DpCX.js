import{j as e,r as P,_ as l,S as X}from"./index-CKu6NIiG.js";import{P as Z}from"./index-C-nDxbD5.js";import{r as x}from"./router-GXfyPTrP.js";import{B as W}from"./button-BtqIQZ7y.js";import{C as D,b as ee,d as se,a as ae}from"./card-iexY_BUt.js";import{T as te,a as ie,b as G,c as m,d as re,e as h,P as de}from"./index-B-aXdpul.js";import{d as ce,o as ne,F as le,R as u,B as oe,e as me,f,i as he}from"./file-upload-DNLm3yYb.js";import{R as xe}from"./RHFTextArea-Dx42pAc1.js";import{u as pe,b as K,c as O}from"./useCustomQuery-DER8A81U.js";import{S as Q}from"./separator-DHP5LbXO.js";import{D as ue}from"./index-DNlsismv.js";import{g as fe}from"./services-KQnp_8oA.js";import{S as ge}from"./index-CkFiw-NE.js";import{Y as be}from"./switch-BVvtaPj5.js";import"./axios-DmypytPv.js";import"./chevron-right-C76pcm54.js";import"./index-CAeIp94X.js";const ve=me().shape({title:f().required("Title is required"),description:f().required("Description is required"),issn:f().required("ISSN is required"),publisher:f().required("Publisher is required"),foundedYear:he().typeError("Founded year must be a number").required("Founded year is required"),website:f().url("Must be a valid URL").required("Website is required"),coverImage:f()});function Se({open:p,setOpen:g,title:q,id:c,edit:o,setEdit:n,refetch:b}){const F=pe({}),v=K({}),{data:r,isFetching:w}=O({api:`${P.getJournalById}/${c}`,key:"getJournalById",options:{enabled:o}}),d=ce({defaultValues:{title:"",description:"",issn:"",publisher:"",foundedYear:void 0,website:"",coverImage:""},resolver:ne(ve)}),S=async a=>{var j,J,y,N;try{if(o&&a){const i=await v.mutateAsync({api:`${P.updateJournal}/${c}`,data:a});(j=i.data)!=null&&j.success?l.success((J=i==null?void 0:i.data)==null?void 0:J.message):l.error("Journal not updated successfully")}else{const i=await F.mutateAsync({api:P.createJournal,data:a});(y=i.data)!=null&&y.success?l.success((N=i==null?void 0:i.data)==null?void 0:N.message):l.error("Journal not created successfully"),d.reset()}g(!1),n==null||n(!1),b==null||b()}catch{}};return x.useEffect(()=>{o&&r?d.reset({title:r.data.title,description:r.data.description,issn:r.data.issn,publisher:r.data.publisher,foundedYear:r.data.foundedYear,website:r.data.website,coverImage:r.data.coverImage||""}):d.reset({title:"",description:"",issn:"",publisher:"",foundedYear:void 0,website:"",coverImage:""})},[o,r]),e.jsx(ue,{open:p,setOpen:g,title:q,setEdit:n,edit:o,isLoading:w,children:e.jsx(le,{methods:d,onSubmit:d.handleSubmit(S),children:e.jsxs("div",{className:"grid grid-cols-1 gap-x-2 gap-y-4",children:[e.jsx("div",{children:e.jsx(u,{name:"title",placeholder:"Enter journal title"})}),e.jsx("div",{children:e.jsx(xe,{name:"description",placeholder:"Enter journal description"})}),e.jsx("div",{children:e.jsx(u,{name:"issn",placeholder:"Enter ISSN number"})}),e.jsx("div",{children:e.jsx(u,{name:"publisher",placeholder:"Enter publisher name"})}),e.jsx("div",{children:e.jsx(u,{name:"foundedYear",placeholder:"Enter founded year",type:"number"})}),e.jsx("div",{children:e.jsx(u,{name:"website",placeholder:"Enter website URL"})}),e.jsx("div",{children:e.jsx(u,{name:"coverImage",placeholder:"Enter cover image URL (optional)"})}),e.jsx(Q,{}),e.jsx("div",{children:e.jsx(oe,{isLoading:d.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Submit"})})]})})})}function ye(){var y,N,i,I,T,A,C,E,R,Y,B;const[p,g]=x.useState(1),q=K({}),[c,o]=x.useState(10),[n,b]=x.useState(""),[F,v]=x.useState(!1),[r,w]=x.useState(""),[d,S]=x.useState(!1),a=O({api:`${P.getAllJournal}?page=${p}&limit=${c}&q=${n}`,key:"getAllJournals",value:[p,c,n],options:{enabled:!0}}),j=s=>{w(s),S(!0),v(!0)},J=async s=>{var $,L,k,M,H,_,U,z,V;try{const t=await q.mutateAsync({api:`${($=P)==null?void 0:$.updateJournalStatus}/${s}`,data:{}});(L=t==null?void 0:t.data)!=null&&L.success?(a.refetch(),((M=(k=t==null?void 0:t.data)==null?void 0:k.data)==null?void 0:M.status)===1?l.success((H=t.data)==null?void 0:H.message):((U=(_=t==null?void 0:t.data)==null?void 0:_.data)==null?void 0:U.status)===0&&l.error((z=t.data)==null?void 0:z.message)):l.error((V=t.data)==null?void 0:V.message)}catch(t){l.error(fe(t))}};return e.jsxs("main",{className:"flex-1",children:[e.jsx(Se,{open:F,setOpen:v,title:d?"Edit Journal":"Add Journal",id:r,edit:d,setEdit:S,refetch:a.refetch}),e.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[e.jsxs("div",{className:"flex w-full justify-between gap-2",children:[e.jsx("div",{children:e.jsx(ge,{search:n,setSearch:b,setPage:g,refetch:a.refetch,isFetching:a.isLoading})}),e.jsx("div",{children:e.jsx(W,{className:"flex items-center gap-2",onClick:()=>{w(""),S(!1),v(!0)},children:"Add New"})})]}),e.jsxs(D,{children:[e.jsx(ee,{className:"px-7",children:e.jsxs(se,{children:["Journal List (",((N=(y=a.data)==null?void 0:y.data)==null?void 0:N.totalDocs)||0,")"]})}),e.jsx(ae,{children:a.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(X,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(te,{children:[e.jsx(ie,{children:e.jsxs(G,{children:[e.jsx(m,{className:"",children:"#"}),e.jsx(m,{className:"",children:"Title"}),e.jsx(m,{className:"",children:"Publisher"}),e.jsx(m,{className:"",children:"ISSN"}),e.jsx(m,{className:"",children:"Founded Year"}),e.jsx(m,{className:"",children:"Status"}),e.jsx(m,{children:"Action"})]})}),e.jsx(re,{children:(T=(I=(i=a==null?void 0:a.data)==null?void 0:i.data)==null?void 0:I.docs)==null?void 0:T.map((s,$)=>e.jsxs(G,{children:[e.jsx(h,{children:p*c-c+$+1}),e.jsx(h,{children:s==null?void 0:s.title}),e.jsx(h,{children:s==null?void 0:s.publisher}),e.jsx(h,{children:s==null?void 0:s.issn}),e.jsx(h,{children:s==null?void 0:s.foundedYear}),e.jsx(h,{children:e.jsxs(be,{checked:(s==null?void 0:s.status)===1,onChange:()=>J(s._id),className:`${(s==null?void 0:s.status)===1?"bg-primary":"bg-gray-200"} relative inline-flex items-center h-6 rounded-full w-11`,children:[e.jsx("span",{className:"sr-only",children:"Toggle status"}),e.jsx("span",{className:`${(s==null?void 0:s.status)===1?"translate-x-6":"translate-x-1"} inline-block w-4 h-4 transform bg-white rounded-full`})]})}),e.jsx(h,{children:e.jsx(W,{onClick:()=>j(s==null?void 0:s._id),size:"sm",children:"Edit"})})]},s==null?void 0:s._id))})]}),e.jsx(Q,{className:"mb-2 mt-4"}),e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(de,{page:p,perPage:c,totalPage:(C=(A=a==null?void 0:a.data)==null?void 0:A.data)==null?void 0:C.totalDocs,hasNextPage:(R=(E=a==null?void 0:a.data)==null?void 0:E.data)==null?void 0:R.hasNextPage,hasPrevPage:(B=(Y=a==null?void 0:a.data)==null?void 0:Y.data)==null?void 0:B.hasPrevPage,setPage:g,setPerPage:o})})]})})]})]})]})}function ke(){return e.jsx(Z,{title:"Journals Page",children:e.jsx(ye,{})})}export{ke as default};
