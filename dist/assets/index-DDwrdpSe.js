import{j as e,l as $,_ as N,B as J,S as W,I as X,e as Z}from"./index-DB-U-9Cm.js";import{P as ee}from"./index-DnNvtFnL.js";import{r as S}from"./router-DMIetGpf.js";import{h as ae}from"./moment-BjLXg0w5.js";import{C as se,a as le,d as te,c as ie}from"./card-Bw6yfvlv.js";import{T as re,a as de,b as K,c as w,d as ne,e as b}from"./table-CbXT1Hu0.js";import{b as oe,C as ce,u as me,o as xe,F as he,i as pe,R as A,B as je,c as fe,a as U,j as ge}from"./FileUpload-_tdyE3Rx.js";import{R as ue}from"./RHFTextArea-4e_miSQI.js";import{I as be,u as Ne,a as O,b as T}from"./useCustomQuery-DlPzsp6X.js";import{S as Q}from"./separator-Dx7ufEei.js";import{D as ye,Y as we,P as Se}from"./switch-B-7HfEI0.js";import{g as ve}from"./services-KQnp_8oA.js";import{S as Ue}from"./index-mYgWSCXV.js";import"./axios-DmypytPv.js";import"./select-DAEbas5a.js";import"./chevron-right-U5U3F3OJ.js";function $e({name:c,label:x,isDynamic:C,...o}){const{control:n,setValue:y}=oe();return e.jsx(ce,{name:c,control:n,render:({field:{ref:P},fieldState:{error:h}})=>e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"text-gray-700 dark:text-gray-200",htmlFor:x,children:[x," ",h&&e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx(be,{type:"file",onChange:p=>{y(c,p.target.files?p.target.files[0]:null)},ref:P,className:`mt-1 ${h?"border-red-400":null}`,...o}),h&&e.jsx("span",{className:"text-red-400 text-xs",children:h.message})]})})}const Pe=fe().shape({roleId:U().required("Role name is required"),fullName:U().required("Role name is required"),address:U().required("address is required"),email:U().required("address is required"),mobile:U().required("mobile is required"),password:U(),imageUrl:ge()});function Fe({open:c,setOpen:x,title:C,id:o,edit:n,setEdit:y,refetch:P}){var E,I,F;const h=Ne({}),p=O({}),{data:l,isFetching:q}=T({api:`${$.getUserById}/${o}`,options:{enabled:n}}),v=T({api:`${$.getAllRole}?page=1&limit=10`,options:{enabled:!0}}),m=me({defaultValues:{fullName:"",address:"",email:"",mobile:"",password:"",imageUrl:null},resolver:xe(Pe)}),s=async t=>{var j,f,g,u;try{const r=new FormData;if(r.append("roleId",t.roleId),r.append("fullName",t.fullName),r.append("address",t.address),r.append("email",t.email),r.append("mobile",t.mobile),t.imageUrl&&r.append("imageUrl",t.imageUrl),t.password&&r.append("password",t.password),n&&t){const d=await p.mutateAsync({api:`${$.updateUserwithImage}/${o}`,data:r});(j=d.data)!=null&&j.success?N.success((f=d==null?void 0:d.data)==null?void 0:f.message):N.error("User not updated successfully")}else{const d=await h.mutateAsync({api:$.createUserswithImage,data:r});(g=d.data)!=null&&g.success?N.success((u=d==null?void 0:d.data)==null?void 0:u.message):N.error("User not created successfully"),m.reset({fullName:"",address:"",email:"",mobile:"",password:""})}x(!1),y(!1),P()}catch{}};return S.useEffect(()=>{var t,j,f,g,u;n&&l?m.reset({roleId:(t=l==null?void 0:l.userDetails)==null?void 0:t.roleId,fullName:(j=l==null?void 0:l.userDetails)==null?void 0:j.fullName,address:(f=l==null?void 0:l.userDetails)==null?void 0:f.address,email:(g=l==null?void 0:l.userDetails)==null?void 0:g.email,mobile:(u=l==null?void 0:l.userDetails)==null?void 0:u.mobile}):m.reset({fullName:"",email:"",address:"",password:"",mobile:""})},[n,l]),e.jsx(ye,{open:c,setOpen:x,title:C,setEdit:y,edit:n,isLoading:q,children:e.jsx(he,{methods:m,onSubmit:m.handleSubmit(s),children:e.jsxs("div",{className:"grid grid-cols-1 gap-x-2 gap-y-4",children:[!n&&e.jsx("div",{children:e.jsx(pe,{name:"roleId",data:(F=(I=(E=v==null?void 0:v.data)==null?void 0:E.data)==null?void 0:I.docs)==null?void 0:F.map(t=>({label:t.roleName,value:t._id}))})}),e.jsx("div",{children:e.jsx(A,{name:"fullName",placeholder:"Enter your user name"})}),e.jsx("div",{children:e.jsx(ue,{name:"address",placeholder:"Enter your address"})}),e.jsx("div",{children:e.jsx(A,{name:"email",placeholder:"Enter your email"})}),e.jsx("div",{children:e.jsx(A,{name:"mobile",placeholder:"Enter your mobile"})}),!n&&e.jsx("div",{children:e.jsx(A,{name:"password",placeholder:"Enter your password"})}),e.jsx("div",{children:e.jsx($e,{name:"imageUrl",placeholder:"Upload "})}),e.jsx(Q,{}),e.jsx("div",{children:e.jsx(je,{isLoading:m.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Submit"})})]})})})}function Ce(){var F,t,j,f,g,u,r,d,B,M,D;const[c,x]=S.useState(1),C=O({}),[o,n]=S.useState(10),[y,P]=S.useState(""),[h,p]=S.useState(!1),[l,q]=S.useState(""),[v,m]=S.useState(!1),s=T({api:`${$.getAllUser}?page=${c}&limit=${o}&q=${y}`,key:"getAllUser",value:[c,o],options:{enabled:!0}}),E=async a=>{var R,H,k,_,Y,L,V,z,G;try{const i=await C.mutateAsync({api:`${(R=$)==null?void 0:R.updateUserStatus}/${a}`,data:{id:a}});(H=i==null?void 0:i.data)!=null&&H.success?(s.refetch(),((_=(k=i==null?void 0:i.data)==null?void 0:k.data)==null?void 0:_.status)==1&&N.success((Y=i.data)==null?void 0:Y.message),((V=(L=i==null?void 0:i.data)==null?void 0:L.data)==null?void 0:V.status)==0&&N.error((z=i.data)==null?void 0:z.message)):N.error((G=i.data)==null?void 0:G.message)}catch(i){N.error(ve(i))}},I=a=>{p(!0),m(!0),q(a)};return e.jsxs("main",{className:"flex-1",children:[e.jsx(Fe,{open:h,setOpen:p,title:v?"Edit User":"Add User",id:l,edit:v,setEdit:m,refetch:s.refetch}),e.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[e.jsxs("div",{className:"flex w-full justify-between gap-2",children:[e.jsx("div",{children:e.jsx(Ue,{search:y,setSearch:P,setPage:x,refetch:s.refetch,isFetching:s.isLoading})}),e.jsx("div",{children:e.jsx(J,{className:"flex items-center gap-2",onClick:()=>p(!0),children:"Add New"})})]}),e.jsxs(se,{children:[e.jsx(le,{className:"px-7",children:e.jsxs(te,{children:["User List (",(t=(F=s.data)==null?void 0:F.data)==null?void 0:t.totalDocs,")"]})}),e.jsx(ie,{children:s.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(W,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(re,{children:[e.jsx(de,{children:e.jsxs(K,{children:[e.jsx(w,{className:"",children:"#"}),e.jsx(w,{className:"",children:"Image"}),e.jsx(w,{className:"",children:"User Name"}),e.jsx(w,{className:"",children:"Mobile"}),e.jsx(w,{className:"",children:"Email"}),e.jsx(w,{className:"",children:"Created at"}),e.jsx(w,{className:"",children:"Status"})]})}),e.jsx(ne,{children:(g=(f=(j=s==null?void 0:s.data)==null?void 0:j.data)==null?void 0:f.docs)==null?void 0:g.map((a,R)=>e.jsxs(K,{children:[e.jsx(b,{children:c*o-o+R+1}),e.jsx(b,{children:e.jsx(X,{src:`${Z}/${a==null?void 0:a.imageUrl}`,alt:a==null?void 0:a.fullName,width:50,height:50})}),e.jsx(b,{children:a==null?void 0:a.fullName}),e.jsx(b,{children:a==null?void 0:a.mobile}),e.jsx(b,{children:a==null?void 0:a.email}),e.jsx(b,{children:ae(a==null?void 0:a.createdAt).format("DD-MM-YYYY")}),e.jsx(b,{children:e.jsxs(we,{checked:(a==null?void 0:a.status)==1,onChange:()=>E(a._id),className:`${a!=null&&a.status?"bg-primary":"bg-gray-200"} relative inline-flex items-center h-6 rounded-full w-11`,children:[e.jsx("span",{className:"sr-only",children:"Enable notifications"}),e.jsx("span",{className:`${a!=null&&a.status?"translate-x-6":"translate-x-1"} inline-block w-4 h-4 transform bg-white rounded-full`})]})}),e.jsx(b,{children:e.jsx(J,{onClick:()=>I(a==null?void 0:a._id),children:"Edit"})})]},a==null?void 0:a._id))})]}),e.jsx(Q,{className:"mb-2 mt-4"}),e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(Se,{page:c,perPage:o,totalPage:(r=(u=s==null?void 0:s.data)==null?void 0:u.data)==null?void 0:r.totalDocs,hasNextPage:(B=(d=s==null?void 0:s.data)==null?void 0:d.data)==null?void 0:B.hasNextPage,hasPrevPage:(D=(M=s==null?void 0:s.data)==null?void 0:M.data)==null?void 0:D.hasPrevPage,setPage:x,setPerPage:n})})]})})]})]})]})}function Ge(){return e.jsx(ee,{title:"Role",children:e.jsx("div",{children:e.jsx(Ce,{})})})}export{Ge as default};
