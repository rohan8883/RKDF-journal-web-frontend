import{j as e,a as N,_ as c,u as F}from"./index-28nypth3.js";import{r as v}from"./router-DMIetGpf.js";import{P as E}from"./index-DonUvE_z.js";import{d as I,C,I as A,e as R,f as j,g as y,u as P,a as T,o as S,F as w,R as $,B as L,c as k,b}from"./useCustomQuery-DJCcqIQ9.js";import{g as O}from"./services-KQnp_8oA.js";import{u as q}from"./useTimer-BI9eVIxE.js";import"./axios-DmypytPv.js";function D({name:r}){const{control:l}=I();return e.jsx(C,{name:r,control:l,render:({field:{ref:a,...n},fieldState:{error:m}})=>e.jsx(A,{maxLength:4,ref:a,inputMode:"numeric",className:`mt-1 ${m?"border-red-400":null}`,...n,children:e.jsxs(R,{children:[e.jsx(j,{index:0}),e.jsx(y,{className:"ml-2 mr-2"}),e.jsx(j,{index:1}),e.jsx(y,{className:"ml-2 mr-2"}),e.jsx(j,{index:2}),e.jsx(y,{className:"ml-2 mr-2"}),e.jsx(j,{index:3})]})})})}const M=k({mobile:b().required()});function B({next:r,data:l}){const a=P({}),n=T({defaultValues:{mobile:l.mobile},resolver:S(M)}),m=async i=>{var o,u,d,x;try{const s=await a.mutateAsync({api:N.sendOtpLogin,data:i});(o=s==null?void 0:s.data)!=null&&o.success?(r({...i,mobile:i==null?void 0:i.mobile,token:(u=s==null?void 0:s.data)==null?void 0:u.token}),c.success((d=s==null?void 0:s.data)==null?void 0:d.message)):c.error((x=s==null?void 0:s.data)==null?void 0:x.message)}catch(s){c.error(O(s))}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-6 lg:px-0 mx-auto max-w-sm mb-4",children:[e.jsx("div",{className:"flex justify-center"}),e.jsx("h1",{className:"text-3xl font-bold text-center mt-4 text-green-400",children:"Send OTP"}),e.jsx("p",{className:"text-center mt-2 text-muted-foreground text-xs",children:"Enter your mobile to send OTP to your mobile number"})]}),e.jsx(w,{methods:n,onSubmit:n.handleSubmit(m),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"space-y-2",children:e.jsx($,{type:"number",className:"rounded-xl py-6 px-5 w-full bg-background",name:"mobile",inputValidation:["number","mobile"],placeholder:"Enter your mobile number"})}),e.jsx("div",{children:e.jsx(L,{type:"submit",isLoading:n.formState.isSubmitting,className:"w-full rounded-xl py-5 px-4 mt-2 shadow-none",variant:"outline",children:"Send OTP"})})]})})]})}const G=k({mobile:b().required(),otp:b().required(),token:b()});function _({data:r,setData:l,prev:a}){const{login:n}=F(),{minutes:m,seconds:i,togglerTimer:o,runTimer:u}=q(.5),d=P({}),x=T({defaultValues:{mobile:r.mobile,otp:r.otp,token:r.token},resolver:S(G)}),s=async p=>{var h,f;try{const t=await d.mutateAsync({api:N.verifyOtpLogin,data:{mobile:p.mobile,otp:p.otp}});if((h=t==null?void 0:t.data)!=null&&h.success){const g=await n(t);g&&c.success(g==null?void 0:g.message)}else c.error((f=t==null?void 0:t.data)==null?void 0:f.message)}catch(t){c.error(O(t))}};v.useEffect(()=>(o(),()=>{o()}),[]);const V=async()=>{var p,h,f;try{const t=await d.mutateAsync({api:N.loginWithOtp,data:{mobile:r.mobile}});(p=t==null?void 0:t.data)!=null&&p.success?(c.success((h=t==null?void 0:t.data)==null?void 0:h.message),l({...r,otp:""}),x.setValue("otp",""),o()):c.error((f=t==null?void 0:t.data)==null?void 0:f.message)}catch(t){c.error(O(t))}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-6 lg:px-0 mx-auto max-w-sm mb-4",children:[e.jsx("div",{className:"flex justify-center"}),e.jsx("h1",{className:"text-3xl font-bold text-center mt-4 text-green-400",children:"Verify OTP"}),e.jsxs("h1",{className:"text-center mt-2 text-muted-foreground text-xs",children:["Verify your OTP to reset your password",e.jsxs("p",{className:"text-center text-muted-foreground text-xs text-green-400",children:[r.mobile,"  ",e.jsx("button",{onClick:()=>a(r),className:"text-center mt-2  text-sm text-green-400 cursor-pointer hover:text-green-500 underline",children:"Edit"})]})]})]}),e.jsx(w,{methods:x,onSubmit:x.handleSubmit(s),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"space-y-2 flex justify-center items-center",children:e.jsx(D,{name:"otp"})}),e.jsx("div",{className:"px-6",children:e.jsx(L,{type:"submit",isLoading:x.formState.isSubmitting,className:"w-full rounded-xl py-5 px-4 mt-2 shadow-none",variant:"outline",children:"Verify OTP"})}),e.jsxs("div",{className:"text-center text-muted-foreground text-xs",children:[e.jsx("span",{children:"Didn't receive the OTP? "}),u?e.jsxs("span",{className:"text-center mt-2  text-sm text-green-400 cursor-pointer hover:text-green-500 underline",children:[m,":",i]}):e.jsx("button",{className:"text-center mt-2  text-sm text-green-400 cursor-pointer hover:text-green-500 underline",onClick:V,children:"Resend OTP"})]})]})})]})}function X(){const[r,l]=v.useState(0),[a,n]=v.useState({mobile:"",otp:"",token:""}),m=(o,u=!1)=>{n({...a,...o}),!u&&l(r+1)},i=o=>{n({...a,...o}),l(r-1)};return e.jsx(E,{title:"OTP LOGIN",children:e.jsx("div",{className:"flex flex-col w-full justify-center h-screen px-6 lg:px-0 mx-auto max-w-sm",children:{0:e.jsx(B,{next:m,data:a}),1:e.jsx(_,{next:m,prev:i,data:a,setData:n})}[r]||null})})}export{X as default};
