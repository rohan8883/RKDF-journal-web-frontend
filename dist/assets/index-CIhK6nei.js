import{j as e,r as z,_ as x,B as v,S as oe,C as me}from"./index-F4tHwxXJ.js";import{P as pe}from"./index-B6_BmV4Z.js";import{r as g,d as xe}from"./router-DMIetGpf.js";import{c as he,d as ue,C as fe,a as je}from"./card-A-082u39.js";import{T as ge,a as Ne,b as L,c as S,d as we,e as y,P as ye}from"./index-Bmc7Ds5M.js";import{u as ve,o as Se,F as Fe,R as le,k as be,B as Ce,c as Te,a as E,l as Pe,T as ce}from"./file-upload-FlvDYF5z.js";import{R as Me}from"./RHFTextArea-CCqhkqaU.js";import{D as Ae,T as ke,S as ze}from"./index-DMj0855B.js";import{u as Be,a as Ie,b as X}from"./useCustomQuery-CaKRkAjg.js";import{B as $e}from"./book-qXRH-IG9.js";import{T as qe}from"./tag-C9vk0PDw.js";import{B as Oe}from"./book-open-C09mVfSx.js";import{A as _e}from"./archive-CkW_wqCP.js";import{U as ie}from"./upload-CALe0PA2.js";import{F as B}from"./file-text-CZtHMso-.js";import{S as Ee}from"./separator-4sCpi2kH.js";import{B as de}from"./badge-DFJJMvFs.js";import{D as Ve,a as Re,b as Ue,c as V,S as ne}from"./dropdown-menu-Dg5aLj9g.js";import{S as He}from"./search-DPen85KJ.js";import{C as Je}from"./circle-plus-BzMjxGp4.js";import"./axios-DmypytPv.js";import"./check-FFEHQhxy.js";const Le=Te().shape({title:E().required("Title is required"),abstract:E().required("Abstract is required"),keywords:E(),journalId:E().required("Journal is required"),manuscriptFile:Pe().required("Manuscript file is required").test("fileType","Only PDF, DOC or DOCX files are accepted",o=>{if(!o)return!1;const c=Array.isArray(o)?o[0]:o;return c&&["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(c.type)}).test("fileSize","File size must be less than 10MB",o=>{if(!o)return!1;const c=Array.isArray(o)?o[0]:o;return c&&c.size<=10*1024*1024})});function Xe({open:o,setOpen:c,title:I,id:p,edit:h,setEdit:N,refetch:$}){var b,C,T;const[q,u]=g.useState(""),R=Be({}),O=Ie({}),{data:s,isFetching:F}=X({api:`${z.getSubmissionsById}/${p}`,options:{enabled:h}}),t=X({api:`${z.getAllJournal}?page=1&limit=100`,options:{enabled:!0}}),d=ve({defaultValues:{title:"",abstract:"",keywords:"",journalId:"",manuscriptFile:void 0},resolver:Se(Le)}),_=r=>{if(r.target.files&&r.target.files[0]){const l=r.target.files[0];if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(l.type)){x.error("Only PDF, DOC or DOCX files are allowed");return}if(l.size>10*1024*1024){x.error("File size should not exceed 10MB");return}d.setValue("manuscriptFile",l),u(l.name),x.success("Manuscript file selected successfully")}},U=()=>{d.setValue("manuscriptFile",""),u("")},H=async r=>{var l,m,f,j;try{const n=new FormData;n.append("title",r.title),n.append("abstract",r.abstract),r.keywords&&n.append("keywords",r.keywords),n.append("journalId",r.journalId);const w=Array.isArray(r.manuscriptFile)?r.manuscriptFile[0]:r.manuscriptFile;if(n.append("manuscriptFile",w),h&&p){const i=await O.mutateAsync({api:`${z.updateSubmissions}/${p}`,data:n,headers:{"Content-Type":"multipart/form-data"}});(l=i.data)!=null&&l.success?x.success((m=i==null?void 0:i.data)==null?void 0:m.message):x.error("Submission not updated successfully")}else{const i=await R.mutateAsync({api:z.createSubmissions,data:n,headers:{"Content-Type":"multipart/form-data"}});(f=i.data)!=null&&f.success?x.success((j=i==null?void 0:i.data)==null?void 0:j.message):x.error("Submission not created successfully")}c(!1),N&&N(!1),$&&$()}catch{x.error("Failed to submit the form")}};g.useEffect(()=>{var r,l,m,f,j,n,w,i,P;h&&s?(d.reset({title:(r=s==null?void 0:s.data)==null?void 0:r.title,abstract:(l=s==null?void 0:s.data)==null?void 0:l.abstract,keywords:(f=(m=s==null?void 0:s.data)==null?void 0:m.keywords)==null?void 0:f.join(", "),journalId:((n=(j=s==null?void 0:s.data)==null?void 0:j.journalId)==null?void 0:n._id)||((w=s==null?void 0:s.data)==null?void 0:w.journalId),manuscriptFile:void 0}),(i=s==null?void 0:s.data)!=null&&i.manuscriptFile&&u(((P=s==null?void 0:s.data)==null?void 0:P.manuscriptFile.split("/").pop())||"Current manuscript file")):(d.reset({title:"",abstract:"",keywords:"",journalId:"",manuscriptFile:void 0}),u(""))},[h,s,d.reset]);const J=()=>{const r=d.formState.errors,l=Object.entries(r).map(([,m])=>m==null?void 0:m.message).filter(Boolean);l.length>0&&x.error(l.join(", "))};return e.jsx(Ae,{open:o,setOpen:c,title:I,setEdit:N,edit:h,isLoading:F,children:e.jsx(Fe,{methods:d,onSubmit:d.handleSubmit(H,J),children:e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"space-y-4 max-h-[75vh] overflow-y-auto pr-2",children:[e.jsxs("div",{className:"bg-white p-3 rounded-lg shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-800 mb-3 flex items-center",children:[e.jsx($e,{className:"h-5 w-5 mr-2 text-blue-600"}),"Basic Information"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative",children:e.jsx(le,{name:"title",label:"Submission Title",placeholder:"Enter a descriptive title for your submission",className:"pr-2 pl-2"})}),e.jsx("div",{className:"relative w-full",children:e.jsx(Me,{name:"abstract",label:"Abstract",placeholder:"Provide a concise summary of your submission",rows:4,className:"w-full border rounded-md p-1 shadow-sm"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"h-4 w-4 text-blue-600"}),e.jsx(le,{name:"keywords",label:"Keywords",placeholder:"E.g., research, medicine, technology (comma separated)",className:"pr-2 pl-2"})]})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-800 mb-3 flex items-center",children:[e.jsx(Oe,{className:"h-5 w-5 mr-2 text-blue-600"}),"Journal Information"]}),e.jsx("div",{className:"space-y-4",children:e.jsx(be,{name:"journalId",label:"Select Journal",data:(T=(C=(b=t==null?void 0:t.data)==null?void 0:b.data)==null?void 0:C.docs)==null?void 0:T.map(r=>({label:r.title,value:r._id})),className:"pr-2 pl-2"})})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-800 mb-3 flex items-center",children:[e.jsx(_e,{className:"h-5 w-5 mr-2 text-blue-600"}),"Manuscript File"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"border-2 border-dashed border-blue-200 rounded-lg p-4 bg-blue-50 hover:bg-blue-100 transition-colors",children:e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-2",children:[e.jsx(ie,{className:"h-10 w-10 text-blue-500"}),e.jsx("p",{className:"text-sm text-gray-600 text-center",children:"Upload your manuscript file (PDF, DOC, DOCX - max 10MB)"}),e.jsx("input",{type:"file",id:"manuscriptUpload",accept:".pdf,.doc,.docx,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document",onChange:_,className:"hidden"}),e.jsxs("label",{htmlFor:"manuscriptUpload",className:"px-4 py-2 bg-blue-600 text-white rounded-md cursor-pointer hover:bg-blue-700 transition-colors",children:[e.jsx(ie,{className:"h-4 w-4 inline mr-2"}),"Select Manuscript File"]})]})}),q&&e.jsx("div",{className:"bg-gray-100 p-3 rounded-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(B,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"text-gray-700 font-medium",children:q})]}),e.jsx("button",{type:"button",onClick:U,className:"text-red-500 hover:text-red-700",children:e.jsx(ke,{className:"h-4 w-4"})})]})}),e.jsx("input",{type:"hidden",...d.register("manuscriptFile")})]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs(Ce,{isLoading:d.formState.isSubmitting,type:"submit",className:"h-12 w-full rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-medium flex items-center justify-center",disabled:d.formState.isSubmitting,children:[e.jsx(ze,{className:"h-5 w-5 mr-2"}),h?"Update Submission":"Submit Manuscript"]})})]})})})}function De(){var b,C,T,r,l,m,f,j,n,w,i,P,D,K,G,Q,W,Y,Z,ee,ae,te,se,re;const o=xe(),[c,I]=g.useState(1),[p,h]=g.useState(10),[N,$]=g.useState(""),[q,u]=g.useState(!1),[R,O]=g.useState(""),[s,F]=g.useState(!1),t=X({api:`${z.getAllSubmissions}?page=${c}&limit=${p}&q=${N}`,key:"getAllSubmissions",value:[c,p,N],options:{enabled:!0}}),d=a=>{u(!0),F(!0),O(a)},_=a=>{o(`/journal/submissions/${a}`)},U=a=>{$(a.target.value)},H=a=>{a.preventDefault(),I(1),t.refetch()},J=({submission:a,handleViewDetails:M})=>{var A,k;return e.jsx(fe,{className:"mb-4",children:e.jsxs(je,{className:"pt-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:a==null?void 0:a.title}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(A=a==null?void 0:a.journal)==null?void 0:A.title," â€¢ Submitted by ",(k=a==null?void 0:a.author)==null?void 0:k.fullName]})]}),e.jsx(de,{variant:"outline"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:a==null?void 0:a.abstract}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(v,{size:"sm",onClick:()=>d(a==null?void 0:a._id),className:"flex items-center gap-1",children:[e.jsx(ne,{size:14})," Edit"]}),e.jsxs(v,{size:"sm",variant:"destructive",className:"flex items-center gap-1",children:[e.jsx(ce,{size:14})," Delete"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(v,{size:"sm",variant:"outline",children:[e.jsx(B,{size:14,className:"mr-2"})," View Files"]}),e.jsxs(v,{size:"sm",variant:"outline",onClick:()=>M(a==null?void 0:a._id),children:[e.jsx(B,{size:14,className:"mr-2"})," View Details"]})]})]})]})})};return e.jsxs("main",{className:"container mx-auto px-4 py-6",children:[e.jsx(Xe,{open:q,setOpen:u,title:s?"Edit Submission":"Add Submission",id:R,edit:s,setEdit:F,refetch:t.refetch}),e.jsx("div",{className:"bg-white rounded-lg shadow",children:e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6",children:[e.jsx(he,{className:"text-xl font-bold",children:"Submission Management"}),e.jsxs("div",{className:"flex flex-col sm:flex-row w-full md:w-auto gap-3",children:[e.jsxs("form",{onSubmit:H,className:"relative w-full sm:w-64",children:[e.jsx("input",{type:"text",placeholder:"Search submissions...",value:N,onChange:U,className:"w-full h-10 pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"}),e.jsx(He,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"})]}),e.jsxs(v,{className:"flex items-center gap-2 whitespace-nowrap",onClick:()=>{F(!1),O(""),u(!0)},children:[e.jsx(Je,{size:18}),"Add Submission"]})]})]}),e.jsxs(ue,{className:"mb-4",children:["Total Submissions: ",((C=(b=t==null?void 0:t.data)==null?void 0:b.data)==null?void 0:C.totalDocs)||0]}),t!=null&&t.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(oe,{})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs(ge,{children:[e.jsx(Ne,{children:e.jsxs(L,{children:[e.jsx(S,{className:"w-12",children:"#"}),e.jsx(S,{children:"Title"}),e.jsx(S,{children:"Journal"}),e.jsx(S,{children:"Submitted By"}),e.jsx(S,{children:"Status"}),e.jsx(S,{className:"text-right",children:"Actions"})]})}),e.jsx(we,{children:((l=(r=(T=t==null?void 0:t.data)==null?void 0:T.data)==null?void 0:r.docs)==null?void 0:l.length)===0?e.jsx(L,{children:e.jsx(y,{colSpan:7,className:"text-center py-8",children:"No submissions found"})}):(j=(f=(m=t==null?void 0:t.data)==null?void 0:m.data)==null?void 0:f.docs)==null?void 0:j.map((a,M)=>{var A,k;return e.jsxs(L,{children:[e.jsx(y,{children:c*p-p+M+1}),e.jsx(y,{className:"font-medium",children:a==null?void 0:a.title}),e.jsx(y,{children:(A=a==null?void 0:a.journal)==null?void 0:A.title}),e.jsx(y,{children:(k=a==null?void 0:a.author)==null?void 0:k.fullName}),e.jsx(y,{children:e.jsx(de,{variant:"outline",children:"Pending"})}),e.jsx(y,{className:"text-right",children:e.jsxs(Ve,{children:[e.jsx(Re,{asChild:!0,children:e.jsxs(v,{variant:"outline",size:"sm",className:"h-8 ml-auto flex items-center gap-1",children:["Actions ",e.jsx(me,{size:14})]})}),e.jsxs(Ue,{align:"end",children:[e.jsxs(V,{onClick:()=>d(a==null?void 0:a._id),children:[e.jsx(ne,{size:14,className:"mr-2"})," Edit"]}),e.jsxs(V,{className:"text-red-600",children:[e.jsx(ce,{size:14,className:"mr-2"})," Delete"]}),e.jsxs(V,{children:[e.jsx(B,{size:14,className:"mr-2"})," View Files"]}),e.jsxs(V,{onClick:()=>_(a==null?void 0:a._id),children:[e.jsx(B,{size:14,className:"mr-2"})," View Details"]})]})]})})]},a==null?void 0:a._id)})})]})}),e.jsx("div",{className:"md:hidden",children:((i=(w=(n=t==null?void 0:t.data)==null?void 0:n.data)==null?void 0:w.docs)==null?void 0:i.length)===0?e.jsx("div",{className:"text-center py-8",children:"No submissions found"}):(K=(D=(P=t==null?void 0:t.data)==null?void 0:P.data)==null?void 0:D.docs)==null?void 0:K.map((a,M)=>e.jsx(J,{submission:a,index:M,handleViewDetails:_},a==null?void 0:a._id))}),e.jsx(Ee,{className:"my-4"}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",(c-1)*p+1," to ",Math.min(c*p,((Q=(G=t==null?void 0:t.data)==null?void 0:G.data)==null?void 0:Q.totalDocs)||0)," of ",((Y=(W=t==null?void 0:t.data)==null?void 0:W.data)==null?void 0:Y.totalDocs)||0," entries"]}),e.jsx(ye,{page:c,perPage:p,totalPage:(ee=(Z=t==null?void 0:t.data)==null?void 0:Z.data)==null?void 0:ee.totalDocs,hasNextPage:(te=(ae=t==null?void 0:t.data)==null?void 0:ae.data)==null?void 0:te.hasNextPage,hasPrevPage:(re=(se=t==null?void 0:t.data)==null?void 0:se.data)==null?void 0:re.hasPrevPage,setPage:I,setPerPage:h})]})]})]})})]})}function fa(){return e.jsx(pe,{title:"Submission List",children:e.jsx("div",{children:e.jsx(De,{})})})}export{fa as default};
