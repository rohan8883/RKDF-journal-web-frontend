import{j as e,r as M,_ as T,B as z,S as ne,C as ce}from"./index-qpQYrg8D.js";import{P as de}from"./index-jqKdOx7X.js";import{r as N}from"./router-DMIetGpf.js";import{c as ie,d as oe,C as me,a as xe}from"./card-ReX3hggF.js";import{T as pe,a as he,b as k,c as v,d as ue,e as j,P as je}from"./index-Bdg4XSpZ.js";import{b as fe,C as ge,h as be,u as ve,o as Ne,F as ye,k as Ie,R as B,B as we,c as Se,a as S,l as Ce,T as ae}from"./file-upload-DUUER_JG.js";import{R as Pe}from"./RHFTextArea-BH_ks411.js";import{S as re}from"./separator-DzM_CpjD.js";import{D as Te}from"./index-DjVvuNL5.js";import{u as Me,a as Fe,b as D}from"./useCustomQuery-Bmkk5bpv.js";import{B as Ae}from"./badge-BbaaeNzJ.js";import{D as $e,a as qe,b as Ee,c as te,S as le}from"./dropdown-menu-CfhyfzvJ.js";import{S as ze}from"./search-D7z0G3sp.js";import{C as Be}from"./circle-plus-BXDiFOSI.js";import{f as se}from"./format-CWZx4aKk.js";import"./axios-DmypytPv.js";import"./check-roh18dN7.js";function ke({name:c,label:m,isDynamic:i,...f}){const{control:d,setValue:g}=fe();return e.jsx(ge,{name:c,control:d,render:({field:{ref:y},fieldState:{error:o}})=>e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"text-gray-700 dark:text-gray-200",htmlFor:m,children:[m," ",o&&e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx(be,{type:"file",onChange:I=>{g(c,I.target.files?I.target.files[0]:null)},ref:y,className:`mt-1 ${o?"border-red-400":null}`,...f}),o&&e.jsx("span",{className:"text-red-400 text-xs",children:o.message})]})})}const De=Se().shape({journalId:S().required("Journal is required"),volume:S().required("Volume is required"),issueNumber:S().required("Issue number is required"),title:S().required("Title is required"),publicationDate:S().required("Publication date is required"),description:S(),coverImage:Ce()});function Re({open:c,setOpen:m,title:i,id:f,edit:d,setEdit:g,refetch:y}){var $,q,E;const o=Me({}),I=Fe({}),{data:l,isFetching:F}=D({api:`${M.getIssueById}/${f}`,options:{enabled:d}}),b=D({api:`${M.getAllJournal}?page=1&limit=100`,options:{enabled:!0}}),t=ve({defaultValues:{journalId:"",volume:"",issueNumber:"",title:"",publicationDate:"",description:"",coverImage:null},resolver:Ne(De)}),A=async s=>{var x,p,h,u;try{const n=new FormData;if(n.append("journalId",s.journalId),n.append("volume",s.volume),n.append("issueNumber",s.issueNumber),n.append("title",s.title),n.append("publicationDate",s.publicationDate),s.description&&n.append("description",s.description),s.coverImage){const r=Array.isArray(s.coverImage)?s.coverImage[0]:s.coverImage;n.append("coverImage",r)}if(d&&f){const r=await I.mutateAsync({api:`${M.updateIssue}/${f}`,data:n,headers:{"Content-Type":"multipart/form-data"}});(x=r.data)!=null&&x.success?T.success((p=r==null?void 0:r.data)==null?void 0:p.message):T.error("Issue not updated successfully")}else{const r=await o.mutateAsync({api:M.createIssue,data:n,headers:{"Content-Type":"multipart/form-data"}});(h=r.data)!=null&&h.success?T.success((u=r==null?void 0:r.data)==null?void 0:u.message):T.error("Issue not created successfully")}m(!1),g&&g(!1),y&&y()}catch{T.error("Failed to submit the form")}};return N.useEffect(()=>{var s,x,p,h,u,n,r,C,P;d&&l?t.reset({journalId:((x=(s=l==null?void 0:l.data)==null?void 0:s.journalId)==null?void 0:x._id)||((p=l==null?void 0:l.data)==null?void 0:p.journalId),volume:(h=l==null?void 0:l.data)==null?void 0:h.volume,issueNumber:(u=l==null?void 0:l.data)==null?void 0:u.issueNumber,title:(n=l==null?void 0:l.data)==null?void 0:n.title,publicationDate:(C=(r=l==null?void 0:l.data)==null?void 0:r.publicationDate)==null?void 0:C.split("T")[0],description:(P=l==null?void 0:l.data)==null?void 0:P.description,coverImage:null}):t.reset({journalId:"",volume:"",issueNumber:"",title:"",publicationDate:"",description:"",coverImage:null})},[d,l,t.reset]),e.jsx(Te,{open:c,setOpen:m,title:i,setEdit:g,edit:d,isLoading:F,children:e.jsx(ye,{methods:t,onSubmit:t.handleSubmit(A),children:e.jsxs("div",{className:"grid grid-cols-1 gap-x-2 gap-y-4",children:[e.jsx("div",{children:e.jsx(Ie,{name:"journalId",label:"Journal",data:(E=(q=($=b==null?void 0:b.data)==null?void 0:$.data)==null?void 0:q.docs)==null?void 0:E.map(s=>({label:s.title,value:s._id}))})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(B,{name:"volume",label:"Volume",placeholder:"Enter volume"}),e.jsx(B,{name:"issueNumber",label:"Issue Number",placeholder:"Enter issue number"})]}),e.jsx("div",{children:e.jsx(B,{name:"title",label:"Title",placeholder:"Enter title"})}),e.jsx("div",{children:e.jsx(B,{name:"publicationDate",label:"Publication Date",placeholder:"YYYY-MM-DD",type:"date"})}),e.jsx("div",{children:e.jsx(Pe,{name:"description",label:"Description",placeholder:"Enter description"})}),e.jsx("div",{children:e.jsx(ke,{name:"coverImage",label:"Cover Image",accept:"image/*"})}),e.jsx(re,{}),e.jsx("div",{children:e.jsx(we,{isLoading:t.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Submit"})})]})})})}function _e(){var s,x,p,h,u,n,r,C,P,R,_,V,H,L,J,Y,G,K,O,Q,U,W,X,Z;const[c,m]=N.useState(1),[i,f]=N.useState(10),[d,g]=N.useState(""),[y,o]=N.useState(!1),[I,l]=N.useState(""),[F,b]=N.useState(!1),t=D({api:`${M.getAllIssue}?page=${c}&limit=${i}&q=${d}`,key:"getAllIssues",value:[c,i,d],options:{enabled:!0}}),A=a=>{o(!0),b(!0),l(a)},$=a=>{g(a.target.value)},q=a=>{a.preventDefault(),m(1),t.refetch()},E=({issue:a})=>{var w;return e.jsx(me,{className:"mb-4",children:e.jsxs(xe,{className:"pt-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:a==null?void 0:a.title}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(w=a==null?void 0:a.journal)==null?void 0:w.title," â€¢ Vol. ",a==null?void 0:a.volume,", No. ",a==null?void 0:a.issueNumber]})]}),e.jsx(Ae,{variant:"outline",children:se(new Date(a==null?void 0:a.publicationDate),"MMM d, yyyy")})]}),(a==null?void 0:a.description)&&e.jsx("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:a.description}),e.jsx("div",{className:"flex justify-between items-center mt-2",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(z,{size:"sm",onClick:()=>A(a==null?void 0:a._id),className:"flex items-center gap-1",children:[e.jsx(le,{size:14})," Edit"]}),e.jsxs(z,{size:"sm",variant:"destructive",className:"flex items-center gap-1",children:[e.jsx(ae,{size:14})," Delete"]})]})})]})})};return e.jsxs("main",{className:"container mx-auto px-4 py-6",children:[e.jsx(Re,{open:y,setOpen:o,title:F?"Edit Issue":"Add Issue",id:I,edit:F,setEdit:b,refetch:t.refetch}),e.jsx("div",{className:"bg-white rounded-lg shadow",children:e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6",children:[e.jsx(ie,{className:"text-xl font-bold",children:"Issue Management"}),e.jsxs("div",{className:"flex flex-col sm:flex-row w-full md:w-auto gap-3",children:[e.jsxs("form",{onSubmit:q,className:"relative w-full sm:w-64",children:[e.jsx("input",{type:"text",placeholder:"Search issues...",value:d,onChange:$,className:"w-full h-10 pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"}),e.jsx(ze,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"})]}),e.jsxs(z,{className:"flex items-center gap-2 whitespace-nowrap",onClick:()=>{b(!1),l(""),o(!0)},children:[e.jsx(Be,{size:18}),"Add Issue"]})]})]}),e.jsxs(oe,{className:"mb-4",children:["Total Issues: ",((x=(s=t.data)==null?void 0:s.data)==null?void 0:x.totalDocs)||0]}),t.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(ne,{})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs(pe,{children:[e.jsx(he,{children:e.jsxs(k,{children:[e.jsx(v,{className:"w-12",children:"#"}),e.jsx(v,{children:"Journal"}),e.jsx(v,{children:"Title"}),e.jsx(v,{children:"Volume"}),e.jsx(v,{children:"Issue"}),e.jsx(v,{children:"Publication Date"}),e.jsx(v,{className:"text-right",children:"Actions"})]})}),e.jsx(ue,{children:((u=(h=(p=t==null?void 0:t.data)==null?void 0:p.data)==null?void 0:h.docs)==null?void 0:u.length)===0?e.jsx(k,{children:e.jsx(j,{colSpan:7,className:"text-center py-8",children:"No issues found"})}):(C=(r=(n=t==null?void 0:t.data)==null?void 0:n.data)==null?void 0:r.docs)==null?void 0:C.map((a,w)=>{var ee;return e.jsxs(k,{children:[e.jsx(j,{children:c*i-i+w+1}),e.jsx(j,{className:"font-medium",children:(ee=a==null?void 0:a.journal)==null?void 0:ee.title}),e.jsx(j,{children:a==null?void 0:a.title}),e.jsxs(j,{children:["Vol. ",a==null?void 0:a.volume]}),e.jsxs(j,{children:["No. ",a==null?void 0:a.issueNumber]}),e.jsx(j,{children:se(new Date(a==null?void 0:a.publicationDate),"MMM d, yyyy")}),e.jsx(j,{className:"text-right",children:e.jsxs($e,{children:[e.jsx(qe,{asChild:!0,children:e.jsxs(z,{variant:"outline",size:"sm",className:"h-8 ml-auto flex items-center gap-1",children:["Actions ",e.jsx(ce,{size:14})]})}),e.jsxs(Ee,{align:"end",children:[e.jsxs(te,{onClick:()=>A(a==null?void 0:a._id),children:[e.jsx(le,{size:14,className:"mr-2"})," Edit"]}),e.jsxs(te,{className:"text-red-600",children:[e.jsx(ae,{size:14,className:"mr-2"})," Delete"]})]})]})})]},a==null?void 0:a._id)})})]})}),e.jsx("div",{className:"md:hidden",children:((_=(R=(P=t==null?void 0:t.data)==null?void 0:P.data)==null?void 0:R.docs)==null?void 0:_.length)===0?e.jsx("div",{className:"text-center py-8",children:"No issues found"}):(L=(H=(V=t==null?void 0:t.data)==null?void 0:V.data)==null?void 0:H.docs)==null?void 0:L.map((a,w)=>e.jsx(E,{issue:a,index:w},a==null?void 0:a._id))}),e.jsx(re,{className:"my-4"}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",(c-1)*i+1," to ",Math.min(c*i,((Y=(J=t==null?void 0:t.data)==null?void 0:J.data)==null?void 0:Y.totalDocs)||0)," of ",((K=(G=t==null?void 0:t.data)==null?void 0:G.data)==null?void 0:K.totalDocs)||0," entries"]}),e.jsx(je,{page:c,perPage:i,totalPage:(Q=(O=t==null?void 0:t.data)==null?void 0:O.data)==null?void 0:Q.totalDocs,hasNextPage:(W=(U=t==null?void 0:t.data)==null?void 0:U.data)==null?void 0:W.hasNextPage,hasPrevPage:(Z=(X=t==null?void 0:t.data)==null?void 0:X.data)==null?void 0:Z.hasPrevPage,setPage:m,setPerPage:f})]})]})]})})]})}function sa(){return e.jsx(de,{title:"Issue List",children:e.jsx("div",{children:e.jsx(_e,{})})})}export{sa as default};
