import{j as e,X as de,r as O,_ as v,S as oe,C as me}from"./index-CDf_FfrT.js";import{P as pe}from"./index-DNvDs65V.js";import{r as j,u as xe}from"./router-GXfyPTrP.js";import{B as E}from"./button-BmATf1Bi.js";import{c as ue,d as he,C as fe,a as je}from"./card-BIU2y7oS.js";import{T as ge,a as Ne,b as U,c as k,d as ye,e as T,P as we}from"./index-V6XNGBig.js";import{C as ve,d as Se,o as be,F as Fe,R as Ce,j as Te,B as ke,e as Ae,f as _,k as Pe,T as le}from"./file-upload-CydC68qV.js";import{R as Me}from"./RHFTextArea-CvNhpCdH.js";import{u as Be,b as ze,c as H}from"./useCustomQuery-D_zByj3Z.js";import{D as Ie,T as $e,S as Ee}from"./index-F8DsbJmF.js";import{B as Oe}from"./book-BDS-h6i8.js";import{B as qe}from"./book-open-BmdvmUSn.js";import{A as _e}from"./archive-DnCq-LJP.js";import{U as ce}from"./upload-kQ6c6CRQ.js";import{F as K}from"./file-text-Ba4n1plx.js";import{S as Ve}from"./separator-DDXiVCpj.js";import{B as ne}from"./badge-Cq50dHsH.js";import{D as Re,a as Je,b as Ue,c as D}from"./dropdown-menu-BzIXi4GL.js";import{S as De}from"./search-DC45ATN3.js";import{C as He}from"./circle-plus-skHhTY8t.js";import{S as ie}from"./square-pen-Bv2lUeMv.js";import"./axios-DmypytPv.js";import"./chevron-right-bE6D0kJH.js";import"./index-CAeIp94X.js";import"./check-BaBhJQf0.js";const Ke=({control:m,name:i,label:F,placeholder:h})=>{const[n,x]=j.useState([]),[g,y]=j.useState(""),N=(c,s)=>{if((c.key==="Enter"||c.key===",")&&g.trim()){c.preventDefault();const r=g.trim().replace(/,/g,"");if(r&&!n.includes(r)){const t=[...n,r];x(t),s(t.join(", "))}y("")}if(c.key==="Backspace"&&!g&&n.length>0){const r=n.slice(0,-1);x(r),s(r.join(", "))}},A=(c,s)=>{const r=n.filter(t=>t!==c);x(r),s(r.join(", "))};return j.useEffect(()=>()=>{x([]),y("")},[]),e.jsx(ve,{name:i,control:m,render:({field:c,fieldState:s})=>(j.useEffect(()=>{if(c.value&&typeof c.value=="string"){const r=c.value.split(",").map(t=>t.trim()).filter(t=>t);x(r)}},[c.value]),e.jsxs("div",{className:"w-full",children:[F&&e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:F}),e.jsxs("div",{className:`flex flex-wrap items-center gap-2 p-2 border rounded-md focus-within:ring-2 focus-within:ring-blue-500 focus-within:border-blue-500 ${s.error?"border-red-500":"border-gray-300"} bg-white`,children:[n.map((r,t)=>e.jsxs("div",{className:"flex items-center bg-blue-100 text-blue-800 text-sm px-2 py-1 rounded-md",children:[e.jsx("span",{children:r}),e.jsx("button",{type:"button",onClick:()=>A(r,c.onChange),className:"ml-1 text-blue-600 hover:text-blue-800 focus:outline-none",children:e.jsx(de,{className:"h-3 w-3"})})]},t)),e.jsx("input",{type:"text",value:g,onChange:r=>y(r.target.value),onKeyDown:r=>N(r,c.onChange),onBlur:()=>{if(c.onBlur(),g.trim()){const r=g.trim();if(!n.includes(r)){const t=[...n,r];x(t),c.onChange(t.join(", "))}y("")}},placeholder:n.length===0?h||"Add keywords...":"",className:"flex-1 outline-none text-sm min-w-[120px]"})]}),s.error&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.error.message})]}))})},Le=Ke,Xe=Ae().shape({title:_().required("Title is required"),abstract:_().required("Abstract is required"),keywords:_(),journalId:_().required("Journal is required"),manuscriptFile:Pe().required("Manuscript file is required").test("fileType","Only PDF, DOC or DOCX files are accepted",m=>{if(!m)return!1;const i=Array.isArray(m)?m[0]:m;return i&&["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(i.type)}).test("fileSize","File size must be less than 10MB",m=>{if(!m)return!1;const i=Array.isArray(m)?m[0]:m;return i&&i.size<=10*1024*1024})});function Ge({open:m,setOpen:i,title:F,id:h,edit:n,setEdit:x,refetch:g}){var P,M,B;const[y,N]=j.useState(""),A=Be({}),c=ze({}),{data:s,isFetching:r}=H({api:`${O.getSubmissionsById}/${h}`,options:{enabled:n}}),t=H({api:`${O.getAllJournal}?page=1&limit=100`,options:{enabled:!0}}),p=Se({defaultValues:{title:"",abstract:"",keywords:"",journalId:"",manuscriptFile:void 0},resolver:be(Xe)}),q=l=>{if(l.target.files&&l.target.files[0]){const o=l.target.files[0];if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(o.type)){v.error("Only PDF, DOC or DOCX files are allowed");return}if(o.size>10*1024*1024){v.error("File size should not exceed 10MB");return}p.setValue("manuscriptFile",o),N(o.name),v.success("Manuscript file selected successfully")}},V=()=>{p.setValue("manuscriptFile",""),N("")},R=async l=>{var o,f,S,b;try{const u=new FormData;if(u.append("title",l.title),u.append("abstract",l.abstract),l.keywords){const d=l.keywords.split(",").map(w=>w.trim()).filter(w=>w);u.append("keywords",JSON.stringify(d))}u.append("journalId",l.journalId);const C=Array.isArray(l.manuscriptFile)?l.manuscriptFile[0]:l.manuscriptFile;if(u.append("manuscriptFile",C),n&&h){const d=await c.mutateAsync({api:`${O.updateSubmissions}/${h}`,data:u,headers:{"Content-Type":"multipart/form-data"}});(o=d.data)!=null&&o.success?v.success((f=d==null?void 0:d.data)==null?void 0:f.message):v.error("Submission not updated successfully")}else{const d=await A.mutateAsync({api:O.createSubmissions,data:u});(S=d.data)!=null&&S.success?v.success((b=d==null?void 0:d.data)==null?void 0:b.message):v.error("Submission not created successfully")}i(!1),x&&x(!1),g&&g()}catch{v.error("Failed to submit the form")}};j.useEffect(()=>{var l,o,f,S,b,u,C,d,w;n&&s?(p.reset({title:(l=s==null?void 0:s.data)==null?void 0:l.title,abstract:(o=s==null?void 0:s.data)==null?void 0:o.abstract,keywords:(S=(f=s==null?void 0:s.data)==null?void 0:f.keywords)==null?void 0:S.join(", "),journalId:((u=(b=s==null?void 0:s.data)==null?void 0:b.journalId)==null?void 0:u._id)||((C=s==null?void 0:s.data)==null?void 0:C.journalId),manuscriptFile:void 0}),(d=s==null?void 0:s.data)!=null&&d.manuscriptFile&&N(((w=s==null?void 0:s.data)==null?void 0:w.manuscriptFile.split("/").pop())||"Current manuscript file")):(p.reset({title:"",abstract:"",keywords:"",journalId:"",manuscriptFile:void 0}),N(""))},[n,s,p.reset]);const J=()=>{const l=p.formState.errors,o=Object.entries(l).map(([,f])=>f==null?void 0:f.message).filter(Boolean);o.length>0&&v.error(o.join(", "))};return e.jsx(Ie,{open:m,setOpen:i,title:F,setEdit:x,edit:n,isLoading:r,children:e.jsx(Fe,{methods:p,onSubmit:p.handleSubmit(R,J),children:e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"space-y-4 max-h-[75vh] overflow-y-auto pr-2",children:[e.jsxs("div",{className:"bg-white p-3 rounded-lg shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-800 mb-3 flex items-center",children:[e.jsx(Oe,{className:"h-5 w-5 mr-2 text-blue-600"}),"Basic Information"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative",children:e.jsx(Ce,{name:"title",label:"Submission Title",placeholder:"Enter a descriptive title for your submission",className:"pr-2 pl-2"})}),e.jsx("div",{className:"relative w-full",children:e.jsx(Me,{name:"abstract",label:"Abstract",placeholder:"Provide a concise summary of your submission",rows:4,className:"w-full border rounded-md p-1 shadow-sm"})}),e.jsx("div",{className:"flex flex-col w-full",children:e.jsx(Le,{control:p.control,name:"keywords",label:"Keywords",placeholder:"Type and press Enter to add keywords"})})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-800 mb-3 flex items-center",children:[e.jsx(qe,{className:"h-5 w-5 mr-2 text-blue-600"}),"Journal Information"]}),e.jsx("div",{className:"space-y-4",children:e.jsx(Te,{name:"journalId",label:"Select Journal",data:(B=(M=(P=t==null?void 0:t.data)==null?void 0:P.data)==null?void 0:M.docs)==null?void 0:B.map(l=>({label:l.title,value:l._id})),className:"pr-2 pl-2"})})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-800 mb-3 flex items-center",children:[e.jsx(_e,{className:"h-5 w-5 mr-2 text-blue-600"}),"Manuscript File"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"border-2 border-dashed border-blue-200 rounded-lg p-4 bg-blue-50 hover:bg-blue-100 transition-colors",children:e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-2",children:[e.jsx(ce,{className:"h-10 w-10 text-blue-500"}),e.jsx("p",{className:"text-sm text-gray-600 text-center",children:"Upload your manuscript file (PDF, DOC, DOCX - max 10MB)"}),e.jsx("input",{type:"file",id:"manuscriptUpload",accept:".pdf,.doc,.docx,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document",onChange:q,className:"hidden"}),e.jsxs("label",{htmlFor:"manuscriptUpload",className:"px-4 py-2 bg-blue-600 text-white rounded-md cursor-pointer hover:bg-blue-700 transition-colors",children:[e.jsx(ce,{className:"h-4 w-4 inline mr-2"}),"Select Manuscript File"]})]})}),y&&e.jsx("div",{className:"bg-gray-100 p-3 rounded-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(K,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"text-gray-700 font-medium",children:y})]}),e.jsx("button",{type:"button",onClick:V,className:"text-red-500 hover:text-red-700",children:e.jsx($e,{className:"h-4 w-4"})})]})}),e.jsx("input",{type:"hidden",...p.register("manuscriptFile")})]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs(ke,{isLoading:p.formState.isSubmitting,type:"submit",className:"h-12 w-full rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-medium flex items-center justify-center",disabled:p.formState.isSubmitting,children:[e.jsx(Ee,{className:"h-5 w-5 mr-2"}),n?"Update Submission":"Submit Manuscript"]})})]})})})}function Qe(){var P,M,B,l,o,f,S,b,u,C,d,w,L,X,G,Q,W,Y,Z,ee,te,ae,se,re;const m=xe(),[i,F]=j.useState(1),[h,n]=j.useState(10),[x,g]=j.useState(""),[y,N]=j.useState(!1),[A,c]=j.useState(""),[s,r]=j.useState(!1),t=H({api:`${O.getAllSubmissions}?page=${i}&limit=${h}&q=${x}`,key:"getAllSubmissions",value:[i,h,x],options:{enabled:!0}}),p=a=>{N(!0),r(!0),c(a)},q=a=>{m(`/journal/submissions/${a}`)},V=a=>{g(a.target.value)},R=a=>{a.preventDefault(),F(1),t.refetch()},J=({submission:a,handleViewDetails:z})=>{var I,$;return e.jsx(fe,{className:"mb-4",children:e.jsxs(je,{className:"pt-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:a==null?void 0:a.title}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(I=a==null?void 0:a.journal)==null?void 0:I.title," • Submitted by ",($=a==null?void 0:a.author)==null?void 0:$.fullName]})]}),e.jsx(ne,{variant:"outline"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:a==null?void 0:a.abstract}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(E,{size:"sm",onClick:()=>p(a==null?void 0:a._id),className:"flex items-center gap-1",children:[e.jsx(ie,{size:14})," Edit"]}),e.jsxs(E,{size:"sm",variant:"destructive",className:"flex items-center gap-1",children:[e.jsx(le,{size:14})," Delete"]})]}),e.jsx("div",{className:"flex ",children:e.jsxs(E,{size:"sm",variant:"outline",onClick:()=>z(a==null?void 0:a._id),children:[e.jsx(K,{size:14,className:"mr-2"})," View Details"]})})]})]})})};return e.jsxs("main",{className:"container mx-auto px-4 py-6",children:[e.jsx(Ge,{open:y,setOpen:N,title:s?"Edit Submission":"Add Submission",id:A,edit:s,setEdit:r,refetch:t.refetch}),e.jsx("div",{className:"bg-white rounded-lg shadow",children:e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6",children:[e.jsx(ue,{className:"text-xl font-bold",children:"Submission Management"}),e.jsxs("div",{className:"flex flex-col sm:flex-row w-full md:w-auto gap-3",children:[e.jsxs("form",{onSubmit:R,className:"relative w-full sm:w-64",children:[e.jsx("input",{type:"text",placeholder:"Search submissions...",value:x,onChange:V,className:"w-full h-10 pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"}),e.jsx(De,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"})]}),e.jsxs(E,{className:"flex items-center gap-2 whitespace-nowrap",onClick:()=>{r(!1),c(""),N(!0)},children:[e.jsx(He,{size:18}),"Add Submission"]})]})]}),e.jsxs(he,{className:"mb-4",children:["Total Submissions: ",((M=(P=t==null?void 0:t.data)==null?void 0:P.data)==null?void 0:M.totalDocs)||0]}),t!=null&&t.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(oe,{})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs(ge,{children:[e.jsx(Ne,{children:e.jsxs(U,{children:[e.jsx(k,{className:"w-12",children:"#"}),e.jsx(k,{children:"Title"}),e.jsx(k,{children:"Journal"}),e.jsx(k,{children:"Submitted By"}),e.jsx(k,{children:"Status"}),e.jsx(k,{className:"text-right",children:"Actions"})]})}),e.jsx(ye,{children:((o=(l=(B=t==null?void 0:t.data)==null?void 0:B.data)==null?void 0:l.docs)==null?void 0:o.length)===0?e.jsx(U,{children:e.jsx(T,{colSpan:7,className:"text-center py-8",children:"No submissions found"})}):(b=(S=(f=t==null?void 0:t.data)==null?void 0:f.data)==null?void 0:S.docs)==null?void 0:b.map((a,z)=>{var I,$;return e.jsxs(U,{children:[e.jsx(T,{children:i*h-h+z+1}),e.jsx(T,{className:"font-medium",children:a==null?void 0:a.title}),e.jsx(T,{children:(I=a==null?void 0:a.journal)==null?void 0:I.title}),e.jsx(T,{children:($=a==null?void 0:a.author)==null?void 0:$.fullName}),e.jsx(T,{children:e.jsx(ne,{variant:"outline",className:"capitalize",children:(a==null?void 0:a.status)||"N/A"})}),e.jsx(T,{className:"text-right",children:e.jsxs(Re,{children:[e.jsx(Je,{asChild:!0,children:e.jsxs(E,{variant:"outline",size:"sm",className:"h-8 ml-auto flex items-center gap-1",children:["Actions ",e.jsx(me,{size:14})]})}),e.jsxs(Ue,{align:"end",children:[e.jsxs(D,{onClick:()=>p(a==null?void 0:a._id),children:[e.jsx(ie,{size:14,className:"mr-2"})," Edit"]}),e.jsxs(D,{onClick:()=>q(a==null?void 0:a._id),children:[e.jsx(K,{size:14,className:"mr-2"})," View Details"]}),e.jsxs(D,{className:"text-red-600",children:[e.jsx(le,{size:14,className:"mr-2"})," Delete"]})]})]})})]},a==null?void 0:a._id)})})]})}),e.jsx("div",{className:"md:hidden",children:((d=(C=(u=t==null?void 0:t.data)==null?void 0:u.data)==null?void 0:C.docs)==null?void 0:d.length)===0?e.jsx("div",{className:"text-center py-8",children:"No submissions found"}):(X=(L=(w=t==null?void 0:t.data)==null?void 0:w.data)==null?void 0:L.docs)==null?void 0:X.map((a,z)=>e.jsx(J,{submission:a,index:z,handleViewDetails:q},a==null?void 0:a._id))}),e.jsx(Ve,{className:"my-4"}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",(i-1)*h+1," to ",Math.min(i*h,((Q=(G=t==null?void 0:t.data)==null?void 0:G.data)==null?void 0:Q.totalDocs)||0)," of ",((Y=(W=t==null?void 0:t.data)==null?void 0:W.data)==null?void 0:Y.totalDocs)||0," entries"]}),e.jsx(we,{page:i,perPage:h,totalPage:(ee=(Z=t==null?void 0:t.data)==null?void 0:Z.data)==null?void 0:ee.totalDocs,hasNextPage:(ae=(te=t==null?void 0:t.data)==null?void 0:te.data)==null?void 0:ae.hasNextPage,hasPrevPage:(re=(se=t==null?void 0:t.data)==null?void 0:se.data)==null?void 0:re.hasPrevPage,setPage:F,setPerPage:n})]})]})]})})]})}function vt(){return e.jsx(pe,{title:"Submission List",children:e.jsx("div",{children:e.jsx(Qe,{})})})}export{vt as default};
