import{j as e,r as T,_ as C,B as P,S as oe,C as xe}from"./index-28nypth3.js";import{P as pe}from"./index-DonUvE_z.js";import{r as f}from"./router-DMIetGpf.js";import{c as he,d as je,C as me,a as ue}from"./card-CvN-M-qi.js";import{T as fe,a as ge,b as B,c as v,d as ve,e as u,P as Se}from"./index-T0kutfHW.js";import{u as ye,k as Ne,l as E,a as we,o as Fe,F as Ce,R as ae,n as Pe,B as Te,c as Ae,b as z,p as re,T as le}from"./useCustomQuery-DJCcqIQ9.js";import{R as ke,S as ie}from"./separator-BE2tWqEJ.js";import{R as se}from"./RHFUploadFiled-Dd6Xpbmf.js";import{D as Le}from"./index-BI5uV9xV.js";import{B as ce}from"./badge-Buxkn7MR.js";import{D as Ie,a as Me,b as $e,c as R,S as de}from"./dropdown-menu-24AWFc5K.js";import{S as ze}from"./search-0i0XZ5Oq.js";import{C as qe}from"./circle-plus-tIKXcEGq.js";import{F as ne}from"./file-text-CDSWsKkO.js";import"./axios-DmypytPv.js";import"./check-BlNKLXrO.js";const Be=Ae().shape({title:z().required("Title is required"),abstract:z().required("Abstract is required"),keywords:z(),journalId:z().required("Journal is required"),manuscriptFile:re().required("Manuscript file is required"),coverLetter:re()});function Re({open:i,setOpen:S,title:d,id:y,edit:n,setEdit:N,refetch:A}){var I,M,$;const w=ye({}),q=Ne({}),{data:l,isFetching:k}=E({api:`${T.getSubmissionsById}/${y}`,options:{enabled:n}}),j=E({api:`${T.getAllJournal}?page=1&limit=100`,options:{enabled:!0}}),t=we({defaultValues:{title:"",abstract:"",keywords:"",journalId:"",manuscriptFile:void 0,coverLetter:null},resolver:Fe(Be)}),L=async r=>{var o,x,p,h;try{const s=new FormData;s.append("title",r.title),s.append("abstract",r.abstract),r.keywords&&s.append("keywords",r.keywords),s.append("journalId",r.journalId);const m=Array.isArray(r.manuscriptFile)?r.manuscriptFile[0]:r.manuscriptFile;if(s.append("manuscriptFile",m),r.coverLetter){const c=Array.isArray(r.coverLetter)?r.coverLetter[0]:r.coverLetter;s.append("coverLetter",c)}if(n&&y){const c=await q.mutateAsync({api:`${T.updateSubmissions}/${y}`,data:s,headers:{"Content-Type":"multipart/form-data"}});(o=c.data)!=null&&o.success?C.success((x=c==null?void 0:c.data)==null?void 0:x.message):C.error("Submission not updated successfully")}else{const c=await w.mutateAsync({api:T.createSubmissions,data:s,headers:{"Content-Type":"multipart/form-data"}});(p=c.data)!=null&&p.success?C.success((h=c==null?void 0:c.data)==null?void 0:h.message):C.error("Submission not created successfully")}S(!1),N&&N(!1),A&&A()}catch{C.error("Failed to submit the form")}};return f.useEffect(()=>{var r,o,x,p,h,s,m;n&&l?t.reset({title:(r=l==null?void 0:l.data)==null?void 0:r.title,abstract:(o=l==null?void 0:l.data)==null?void 0:o.abstract,keywords:(p=(x=l==null?void 0:l.data)==null?void 0:x.keywords)==null?void 0:p.join(", "),journalId:((s=(h=l==null?void 0:l.data)==null?void 0:h.journalId)==null?void 0:s._id)||((m=l==null?void 0:l.data)==null?void 0:m.journalId),manuscriptFile:void 0,coverLetter:null}):t.reset({title:"",abstract:"",keywords:"",journalId:"",manuscriptFile:void 0,coverLetter:null})},[n,l,t.reset]),e.jsx(Le,{open:i,setOpen:S,title:d,setEdit:N,edit:n,isLoading:k,children:e.jsx(Ce,{methods:t,onSubmit:t.handleSubmit(L),children:e.jsxs("div",{className:"grid grid-cols-1 gap-x-2 gap-y-4",children:[e.jsx("div",{children:e.jsx(ae,{name:"title",label:"Title",placeholder:"Enter title"})}),e.jsx("div",{children:e.jsx(ke,{name:"abstract",label:"Abstract",placeholder:"Enter abstract",rows:5})}),e.jsx("div",{children:e.jsx(ae,{name:"keywords",label:"Keywords",placeholder:"Comma separated keywords"})}),e.jsx("div",{children:e.jsx(Pe,{name:"journalId",label:"Journal",data:($=(M=(I=j==null?void 0:j.data)==null?void 0:I.data)==null?void 0:M.docs)==null?void 0:$.map(r=>({label:r.title,value:r._id}))})}),e.jsx("div",{children:e.jsx(se,{name:"manuscriptFile",label:"Manuscript File",accept:".pdf,.doc,.docx",required:!0})}),e.jsx("div",{children:e.jsx(se,{name:"coverLetter",label:"Cover Letter (Optional)",accept:".pdf,.doc,.docx"})}),e.jsx(ie,{}),e.jsx("div",{children:e.jsx(Te,{isLoading:t.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Submit"})})]})})})}function Ee(){var r,o,x,p,h,s,m,c,_,H,b,J,V,K,O,G,Q,U,W,X,Y,Z,D,ee;const[i,S]=f.useState(1),[d,y]=f.useState(10),[n,N]=f.useState(""),[A,w]=f.useState(!1),[q,l]=f.useState(""),[k,j]=f.useState(!1),t=E({api:`${T.getAllSubmissions}?page=${i}&limit=${d}&q=${n}`,key:"getAllSubmissions",value:[i,d,n],options:{enabled:!0}}),L=a=>{w(!0),j(!0),l(a)},I=a=>{N(a.target.value)},M=a=>{a.preventDefault(),S(1),t.refetch()},$=({submission:a})=>{var g,F;return e.jsx(me,{className:"mb-4",children:e.jsxs(ue,{className:"pt-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:a==null?void 0:a.title}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(g=a==null?void 0:a.journal)==null?void 0:g.title," â€¢ Submitted by ",(F=a==null?void 0:a.author)==null?void 0:F.fullName]})]}),e.jsx(ce,{variant:"outline"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:a==null?void 0:a.abstract}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(P,{size:"sm",onClick:()=>L(a==null?void 0:a._id),className:"flex items-center gap-1",children:[e.jsx(de,{size:14})," Edit"]}),e.jsxs(P,{size:"sm",variant:"destructive",className:"flex items-center gap-1",children:[e.jsx(le,{size:14})," Delete"]})]}),e.jsxs(P,{size:"sm",variant:"outline",children:[e.jsx(ne,{size:14,className:"mr-2"})," View Files"]})]})]})})};return e.jsxs("main",{className:"container mx-auto px-4 py-6",children:[e.jsx(Re,{open:A,setOpen:w,title:k?"Edit Submission":"Add Submission",id:q,edit:k,setEdit:j,refetch:t.refetch}),e.jsx("div",{className:"bg-white rounded-lg shadow",children:e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6",children:[e.jsx(he,{className:"text-xl font-bold",children:"Submission Management"}),e.jsxs("div",{className:"flex flex-col sm:flex-row w-full md:w-auto gap-3",children:[e.jsxs("form",{onSubmit:M,className:"relative w-full sm:w-64",children:[e.jsx("input",{type:"text",placeholder:"Search submissions...",value:n,onChange:I,className:"w-full h-10 pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"}),e.jsx(ze,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"})]}),e.jsxs(P,{className:"flex items-center gap-2 whitespace-nowrap",onClick:()=>{j(!1),l(""),w(!0)},children:[e.jsx(qe,{size:18}),"Add Submission"]})]})]}),e.jsxs(je,{className:"mb-4",children:["Total Submissions: ",((o=(r=t==null?void 0:t.data)==null?void 0:r.data)==null?void 0:o.totalDocs)||0]}),t!=null&&t.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(oe,{})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs(fe,{children:[e.jsx(ge,{children:e.jsxs(B,{children:[e.jsx(v,{className:"w-12",children:"#"}),e.jsx(v,{children:"Title"}),e.jsx(v,{children:"Journal"}),e.jsx(v,{children:"Submitted By"}),e.jsx(v,{children:"Status"}),e.jsx(v,{className:"text-right",children:"Actions"})]})}),e.jsx(ve,{children:((h=(p=(x=t==null?void 0:t.data)==null?void 0:x.data)==null?void 0:p.docs)==null?void 0:h.length)===0?e.jsx(B,{children:e.jsx(u,{colSpan:7,className:"text-center py-8",children:"No submissions found"})}):(c=(m=(s=t==null?void 0:t.data)==null?void 0:s.data)==null?void 0:m.docs)==null?void 0:c.map((a,g)=>{var F,te;return e.jsxs(B,{children:[e.jsx(u,{children:i*d-d+g+1}),e.jsx(u,{className:"font-medium",children:a==null?void 0:a.title}),e.jsx(u,{children:(F=a==null?void 0:a.journal)==null?void 0:F.title}),e.jsx(u,{children:(te=a==null?void 0:a.author)==null?void 0:te.fullName}),e.jsx(u,{children:e.jsx(ce,{variant:"outline",children:"Pending"})}),e.jsx(u,{className:"text-right",children:e.jsxs(Ie,{children:[e.jsx(Me,{asChild:!0,children:e.jsxs(P,{variant:"outline",size:"sm",className:"h-8 ml-auto flex items-center gap-1",children:["Actions ",e.jsx(xe,{size:14})]})}),e.jsxs($e,{align:"end",children:[e.jsxs(R,{onClick:()=>L(a==null?void 0:a._id),children:[e.jsx(de,{size:14,className:"mr-2"})," Edit"]}),e.jsxs(R,{className:"text-red-600",children:[e.jsx(le,{size:14,className:"mr-2"})," Delete"]}),e.jsxs(R,{children:[e.jsx(ne,{size:14,className:"mr-2"})," View Files"]})]})]})})]},a==null?void 0:a._id)})})]})}),e.jsx("div",{className:"md:hidden",children:((b=(H=(_=t==null?void 0:t.data)==null?void 0:_.data)==null?void 0:H.docs)==null?void 0:b.length)===0?e.jsx("div",{className:"text-center py-8",children:"No submissions found"}):(K=(V=(J=t==null?void 0:t.data)==null?void 0:J.data)==null?void 0:V.docs)==null?void 0:K.map((a,g)=>e.jsx($,{submission:a,index:g},a==null?void 0:a._id))}),e.jsx(ie,{className:"my-4"}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",(i-1)*d+1," to ",Math.min(i*d,((G=(O=t==null?void 0:t.data)==null?void 0:O.data)==null?void 0:G.totalDocs)||0)," of ",((U=(Q=t==null?void 0:t.data)==null?void 0:Q.data)==null?void 0:U.totalDocs)||0," entries"]}),e.jsx(Se,{page:i,perPage:d,totalPage:(X=(W=t==null?void 0:t.data)==null?void 0:W.data)==null?void 0:X.totalDocs,hasNextPage:(Z=(Y=t==null?void 0:t.data)==null?void 0:Y.data)==null?void 0:Z.hasNextPage,hasPrevPage:(ee=(D=t==null?void 0:t.data)==null?void 0:D.data)==null?void 0:ee.hasPrevPage,setPage:S,setPerPage:y})]})]})]})})]})}function tt(){return e.jsx(pe,{title:"Submission List",children:e.jsx("div",{children:e.jsx(Ee,{})})})}export{tt as default};
