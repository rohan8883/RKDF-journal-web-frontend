import{j as e,X as pe,f as ue,r as M,_ as b,S as xe,C as he}from"./index-CKu6NIiG.js";import{P as fe}from"./index-C-nDxbD5.js";import{r as j,u as je}from"./router-GXfyPTrP.js";import{B as G}from"./button-BtqIQZ7y.js";import{c as ge,d as ye,C as Ne,a as we}from"./card-iexY_BUt.js";import{T as ve,a as be,b as te,c as k,d as Se,e as A,P as Fe}from"./index-B-aXdpul.js";import{C as Ce,d as Ae,o as Te,F as Be,j as le,R as ke,B as Me,f as T,k as Pe,e as ce}from"./file-upload-DNLm3yYb.js";import{R as Ie}from"./RHFTextArea-Dx42pAc1.js";import{u as ze,b as $e,c as D,T as ie}from"./useCustomQuery-DER8A81U.js";import{D as qe,T as Ee,S as _e}from"./index-BzEzFeJs.js";import{B as ne}from"./book-open-HDU3og-I.js";import{B as Oe}from"./book-LAJ4qmyE.js";import{A as Ve}from"./archive-D4vRkrXA.js";import{U as de}from"./upload-vl0hs8xR.js";import{F as se}from"./file-text-Cc4OIgFF.js";import{S as Re}from"./separator-DHP5LbXO.js";import{B as oe}from"./badge-pIIdSOa0.js";import{D as Je,a as Ue,b as He,c as ae}from"./dropdown-menu-Df8_QS7x.js";import{S as Ke}from"./search-Dyd9pq4u.js";import{C as Le}from"./circle-plus-5Kt-r0pX.js";import{S as me}from"./square-pen-qh323m7S.js";import"./axios-DmypytPv.js";import"./chevron-right-C76pcm54.js";import"./index-CAeIp94X.js";import"./check-DES72nMJ.js";const Xe=({control:N,name:u,label:i,placeholder:n})=>{const[o,x]=j.useState([]),[g,w]=j.useState(""),y=(c,r)=>{if((c.key==="Enter"||c.key===",")&&g.trim()){c.preventDefault();const l=g.trim().replace(/,/g,"");if(l&&!o.includes(l)){const t=[...o,l];x(t),r(t.join(", "))}w("")}if(c.key==="Backspace"&&!g&&o.length>0){const l=o.slice(0,-1);x(l),r(l.join(", "))}},P=(c,r)=>{const l=o.filter(t=>t!==c);x(l),r(l.join(", "))};return j.useEffect(()=>()=>{x([]),w("")},[]),e.jsx(Ce,{name:u,control:N,render:({field:c,fieldState:r})=>(j.useEffect(()=>{if(c.value&&typeof c.value=="string"){const l=c.value.split(",").map(t=>t.trim()).filter(t=>t);x(l)}},[c.value]),e.jsxs("div",{className:"w-full",children:[i&&e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:i}),e.jsxs("div",{className:`flex flex-wrap items-center gap-2 p-2 border rounded-md focus-within:ring-2 focus-within:ring-blue-500 focus-within:border-blue-500 ${r.error?"border-red-500":"border-gray-300"} bg-white`,children:[o.map((l,t)=>e.jsxs("div",{className:"flex items-center bg-blue-100 text-blue-800 text-sm px-2 py-1 rounded-md",children:[e.jsx("span",{children:l}),e.jsx("button",{type:"button",onClick:()=>P(l,c.onChange),className:"ml-1 text-blue-600 hover:text-blue-800 focus:outline-none",children:e.jsx(pe,{className:"h-3 w-3"})})]},t)),e.jsx("input",{type:"text",value:g,onChange:l=>w(l.target.value),onKeyDown:l=>y(l,c.onChange),onBlur:()=>{if(c.onBlur(),g.trim()){const l=g.trim();if(!o.includes(l)){const t=[...o,l];x(t),c.onChange(t.join(", "))}w("")}},placeholder:o.length===0?n||"Add keywords...":"",className:"flex-1 outline-none text-sm min-w-[120px]"})]}),r.error&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.error.message})]}))})},Ge=Xe,Qe=N=>{const u={title:T().required("Title is required"),submittedBy:N!=="Author"?T().required("Author is required"):T().notRequired(),abstract:T().required("Abstract is required"),keywords:T(),journalId:T().required("Journal is required"),manuscriptFile:Pe().test("fileRequired","Manuscript file is required",i=>N==="EDIT_MODE"?!0:!!i).test("fileType","Only PDF, DOC or DOCX files are accepted",i=>{if(!i)return!0;const n=Array.isArray(i)?i[0]:i;return n&&["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(n.type)}).test("fileSize","File size must be less than 10MB",i=>{if(!i)return!0;const n=Array.isArray(i)?i[0]:i;return n&&n.size<=10485760})};return N!=="Author"?ce().shape({...u,submittedBy:T().required("Author is required")}):ce().shape(u)};function We({open:N,setOpen:u,title:i,id:n,edit:o,setEdit:x,refetch:g}){var z,$,q,E,_,O;const[w,y]=j.useState(""),P=ze({}),c=$e({}),{user:r}=ue(),l=Qe((r==null?void 0:r.role)||""),{data:t,isFetching:Q}=D({api:`${M.getSubmissionsById}/${n}`,options:{enabled:o}}),B=D({api:`${M.getAllJournal}?page=1&limit=100`,options:{enabled:!0}}),I=D({api:`${M.getAvailableAuthors}?page=1&limit=100`,options:{enabled:!0}}),h=Ae({defaultValues:{title:"",abstract:"",keywords:"",journalId:"",manuscriptFile:void 0,...(r==null?void 0:r.role)!=="Author"&&{submittedBy:""}},resolver:Te(l)}),ee=s=>{if(s.target.files&&s.target.files[0]){const m=s.target.files[0];if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(m.type)){b.error("Only PDF, DOC or DOCX files are allowed");return}if(m.size>10*1024*1024){b.error("File size should not exceed 10MB");return}h.setValue("manuscriptFile",m),y(m.name),b.success("Manuscript file selected successfully")}},W=()=>{h.setValue("manuscriptFile",""),y("")},Y=async s=>{var m,f,S,F;try{const p=new FormData;if(p.append("title",s.title),p.append("abstract",s.abstract),(r==null?void 0:r.role)!=="Author"&&(s!=null&&s.submittedBy)&&p.append("submittedBy",s==null?void 0:s.submittedBy),s.keywords){const d=s.keywords.split(",").map(v=>v.trim()).filter(v=>v);p.append("keywords",JSON.stringify(d))}if(p.append("journalId",s.journalId),s.manuscriptFile&&typeof s.manuscriptFile!="string"){const d=Array.isArray(s.manuscriptFile)?s.manuscriptFile[0]:s.manuscriptFile;p.append("manuscriptFile",d)}if(o&&n){const d=await c.mutateAsync({api:`${M.updateSubmissions}/${n}`,data:p,headers:{"Content-Type":"multipart/form-data"}});(m=d.data)!=null&&m.success?b.success((f=d==null?void 0:d.data)==null?void 0:f.message):b.error("Submission not updated successfully")}else{const d=await P.mutateAsync({api:M.createSubmissions,data:p,headers:{"Content-Type":"multipart/form-data"}});(S=d.data)!=null&&S.success?b.success((F=d==null?void 0:d.data)==null?void 0:F.message):b.error("Submission not created successfully")}u(!1),x&&x(!1),g&&g()}catch{b.error("Failed to submit the form")}};j.useEffect(()=>{var s,m,f,S,F,p,d,v,V,R,J,U,H;if(o&&t){const C={title:(s=t==null?void 0:t.data)==null?void 0:s.title,abstract:(m=t==null?void 0:t.data)==null?void 0:m.abstract,keywords:(S=(f=t==null?void 0:t.data)==null?void 0:f.keywords)==null?void 0:S.join(", "),journalId:((p=(F=t==null?void 0:t.data)==null?void 0:F.journalId)==null?void 0:p._id)||((d=t==null?void 0:t.data)==null?void 0:d.journalId),manuscriptFile:(v=t==null?void 0:t.data)==null?void 0:v.manuscriptFile};(r==null?void 0:r.role)!=="Author"&&(C.submittedBy=((R=(V=t==null?void 0:t.data)==null?void 0:V.submittedBy)==null?void 0:R._id)||((J=t==null?void 0:t.data)==null?void 0:J.submittedBy)),h.reset(C),(U=t==null?void 0:t.data)!=null&&U.manuscriptFile&&y(((H=t==null?void 0:t.data)==null?void 0:H.manuscriptFile.split("/").pop())||"Current manuscript file")}else{const C={title:"",abstract:"",keywords:"",journalId:"",manuscriptFile:void 0};(r==null?void 0:r.role)!=="Author"&&(C.submittedBy=""),h.reset(C),y("")}},[o,t,h.reset,r==null?void 0:r.role]);const Z=()=>{const s=h.formState.errors,m=Object.entries(s).map(([,f])=>f==null?void 0:f.message).filter(Boolean);m.length>0&&b.error(m.join(", "))};return e.jsx(qe,{open:N,setOpen:u,title:i,setEdit:x,edit:o,isLoading:Q,children:e.jsx(Be,{methods:h,onSubmit:h.handleSubmit(Y,Z),children:e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"space-y-4 max-h-[75vh] overflow-y-auto pr-2",children:[(r==null?void 0:r.role)!=="Author"&&e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-800 mb-3 flex items-center",children:[e.jsx(ne,{className:"h-5 w-5 mr-2 text-blue-600"}),"Author Information"]}),e.jsx("div",{className:"space-y-4",children:e.jsx(le,{name:"submittedBy",label:"Select Author",data:(q=($=(z=I==null?void 0:I.data)==null?void 0:z.data)==null?void 0:$.docs)==null?void 0:q.map(s=>({label:s.fullName,value:s._id})),className:"pr-2 pl-2"})})]}),e.jsxs("div",{className:"bg-white p-3 rounded-lg shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-800 mb-3 flex items-center",children:[e.jsx(Oe,{className:"h-5 w-5 mr-2 text-blue-600"}),"Basic Information"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative",children:e.jsx(ke,{name:"title",label:"Submission Title",placeholder:"Enter a descriptive title for your submission",className:"pr-2 pl-2"})}),e.jsx("div",{className:"relative w-full",children:e.jsx(Ie,{name:"abstract",label:"Abstract",placeholder:"Provide a concise summary of your submission",rows:4,className:"w-full border rounded-md p-1 shadow-sm"})}),e.jsx("div",{className:"flex flex-col w-full",children:e.jsx(Ge,{control:h.control,name:"keywords",label:"Keywords",placeholder:"Type and press Enter to add keywords"})})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-800 mb-3 flex items-center",children:[e.jsx(ne,{className:"h-5 w-5 mr-2 text-blue-600"}),"Journal Information"]}),e.jsx("div",{className:"space-y-4",children:e.jsx(le,{name:"journalId",label:"Select Journal",data:(O=(_=(E=B==null?void 0:B.data)==null?void 0:E.data)==null?void 0:_.docs)==null?void 0:O.map(s=>({label:s.title,value:s._id})),className:"pr-2 pl-2"})})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-800 mb-3 flex items-center",children:[e.jsx(Ve,{className:"h-5 w-5 mr-2 text-blue-600"}),"Manuscript File"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"border-2 border-dashed border-blue-200 rounded-lg p-4 bg-blue-50 hover:bg-blue-100 transition-colors",children:e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-2",children:[e.jsx(de,{className:"h-10 w-10 text-blue-500"}),e.jsx("p",{className:"text-sm text-gray-600 text-center",children:"Upload your manuscript file (PDF, DOC, DOCX - max 10MB)"}),e.jsx("input",{type:"file",id:"manuscriptUpload",accept:".pdf,.doc,.docx,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document",onChange:ee,className:"hidden"}),e.jsxs("label",{htmlFor:"manuscriptUpload",className:"px-4 py-2 bg-blue-600 text-white rounded-md cursor-pointer hover:bg-blue-700 transition-colors",children:[e.jsx(de,{className:"h-4 w-4 inline mr-2"}),"Select Manuscript File"]})]})}),w&&e.jsx("div",{className:"bg-gray-100 p-3 rounded-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"text-gray-700 font-medium",children:w})]}),e.jsx("button",{type:"button",onClick:W,className:"text-red-500 hover:text-red-700",children:e.jsx(Ee,{className:"h-4 w-4"})})]})})]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs(Me,{isLoading:h.formState.isSubmitting,type:"submit",className:"h-12 w-full rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-medium flex items-center justify-center",disabled:h.formState.isSubmitting,children:[e.jsx(_e,{className:"h-5 w-5 mr-2"}),o?"Update Submission":"Submit Manuscript"]})})]})})})}function Ye(){var W,Y,Z,z,$,q,E,_,O,s,m,f,S,F,p,d,v,V,R,J,U,H,C,re;const N=je(),[u,i]=j.useState(1),[n,o]=j.useState(10),[x,g]=j.useState(""),[w,y]=j.useState(!1),[P,c]=j.useState(""),[r,l]=j.useState(!1),t=D({api:`${M.getAllSubmissions}?page=${u}&limit=${n}&q=${x}`,key:"getAllSubmissions",value:[u,n,x],options:{enabled:!0}}),Q=a=>{y(!0),l(!0),c(a)},B=a=>{N(`/journal/submissions/${a}`)},I=a=>{g(a.target.value)},h=a=>{a.preventDefault(),i(1),t.refetch()},ee=({submission:a,handleViewDetails:K})=>{var L,X;return e.jsx(Ne,{className:"mb-4",children:e.jsxs(we,{className:"pt-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:a==null?void 0:a.title}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(L=a==null?void 0:a.journal)==null?void 0:L.title," â€¢ Submitted by ",(X=a==null?void 0:a.author)==null?void 0:X.fullName]})]}),e.jsx(oe,{variant:"outline"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:a==null?void 0:a.abstract}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(G,{size:"sm",onClick:()=>Q(a==null?void 0:a._id),className:"flex items-center gap-1",children:[e.jsx(me,{size:14})," Edit"]}),e.jsxs(G,{size:"sm",variant:"destructive",className:"flex items-center gap-1",children:[e.jsx(ie,{size:14})," Delete"]})]}),e.jsx("div",{className:"flex ",children:e.jsxs(G,{size:"sm",variant:"outline",onClick:()=>K(a==null?void 0:a._id),children:[e.jsx(se,{size:14,className:"mr-2"})," View Details"]})})]})]})})};return e.jsxs("main",{className:"container mx-auto px-4 py-6",children:[e.jsx(We,{open:w,setOpen:y,title:r?"Edit Submission":"Add Submission",id:P,edit:r,setEdit:l,refetch:t.refetch}),e.jsx("div",{className:"bg-white rounded-lg shadow",children:e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6",children:[e.jsx(ge,{className:"text-xl font-bold",children:"Submission Management"}),e.jsxs("div",{className:"flex flex-col sm:flex-row w-full md:w-auto gap-3",children:[e.jsxs("form",{onSubmit:h,className:"relative w-full sm:w-64",children:[e.jsx("input",{type:"text",placeholder:"Search submissions...",value:x,onChange:I,className:"w-full h-10 pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"}),e.jsx(Ke,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"})]}),e.jsxs(G,{className:"flex items-center gap-2 whitespace-nowrap",onClick:()=>{l(!1),c(""),y(!0)},children:[e.jsx(Le,{size:18}),"Add Submission"]})]})]}),e.jsxs(ye,{className:"mb-4",children:["Total Submissions: ",((Y=(W=t==null?void 0:t.data)==null?void 0:W.data)==null?void 0:Y.totalDocs)||0]}),t!=null&&t.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(xe,{})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs(ve,{children:[e.jsx(be,{children:e.jsxs(te,{children:[e.jsx(k,{className:"w-12",children:"#"}),e.jsx(k,{children:"Title"}),e.jsx(k,{children:"Journal"}),e.jsx(k,{children:"Submitted By"}),e.jsx(k,{children:"Status"}),e.jsx(k,{className:"text-right",children:"Actions"})]})}),e.jsx(Se,{children:(($=(z=(Z=t==null?void 0:t.data)==null?void 0:Z.data)==null?void 0:z.docs)==null?void 0:$.length)===0?e.jsx(te,{children:e.jsx(A,{colSpan:7,className:"text-center py-8",children:"No submissions found"})}):(_=(E=(q=t==null?void 0:t.data)==null?void 0:q.data)==null?void 0:E.docs)==null?void 0:_.map((a,K)=>{var L,X;return e.jsxs(te,{children:[e.jsx(A,{children:u*n-n+K+1}),e.jsx(A,{className:"font-medium",children:a==null?void 0:a.title}),e.jsx(A,{children:(L=a==null?void 0:a.journal)==null?void 0:L.title}),e.jsx(A,{children:(X=a==null?void 0:a.author)==null?void 0:X.fullName}),e.jsx(A,{children:e.jsx(oe,{variant:"outline",className:"capitalize",children:(a==null?void 0:a.status)||"N/A"})}),e.jsx(A,{className:"text-right",children:e.jsxs(Je,{children:[e.jsx(Ue,{asChild:!0,children:e.jsxs(G,{variant:"outline",size:"sm",className:"h-8 ml-auto flex items-center gap-1",children:["Actions ",e.jsx(he,{size:14})]})}),e.jsxs(He,{align:"end",children:[e.jsxs(ae,{onClick:()=>Q(a==null?void 0:a._id),children:[e.jsx(me,{size:14,className:"mr-2"})," Edit"]}),e.jsxs(ae,{onClick:()=>B(a==null?void 0:a._id),children:[e.jsx(se,{size:14,className:"mr-2"})," View Details"]}),e.jsxs(ae,{className:"text-red-600",children:[e.jsx(ie,{size:14,className:"mr-2"})," Delete"]})]})]})})]},a==null?void 0:a._id)})})]})}),e.jsx("div",{className:"md:hidden",children:((m=(s=(O=t==null?void 0:t.data)==null?void 0:O.data)==null?void 0:s.docs)==null?void 0:m.length)===0?e.jsx("div",{className:"text-center py-8",children:"No submissions found"}):(F=(S=(f=t==null?void 0:t.data)==null?void 0:f.data)==null?void 0:S.docs)==null?void 0:F.map((a,K)=>e.jsx(ee,{submission:a,index:K,handleViewDetails:B},a==null?void 0:a._id))}),e.jsx(Re,{className:"my-4"}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",(u-1)*n+1," to ",Math.min(u*n,((d=(p=t==null?void 0:t.data)==null?void 0:p.data)==null?void 0:d.totalDocs)||0)," of ",((V=(v=t==null?void 0:t.data)==null?void 0:v.data)==null?void 0:V.totalDocs)||0," entries"]}),e.jsx(Fe,{page:u,perPage:n,totalPage:(J=(R=t==null?void 0:t.data)==null?void 0:R.data)==null?void 0:J.totalDocs,hasNextPage:(H=(U=t==null?void 0:t.data)==null?void 0:U.data)==null?void 0:H.hasNextPage,hasPrevPage:(re=(C=t==null?void 0:t.data)==null?void 0:C.data)==null?void 0:re.hasPrevPage,setPage:i,setPerPage:o})]})]})]})})]})}function bt(){return e.jsx(fe,{title:"Submission List",children:e.jsx("div",{children:e.jsx(Ye,{})})})}export{bt as default};
