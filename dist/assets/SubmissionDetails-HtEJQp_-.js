import{c as w,j as e,d as Q,f as ce,r as v,C as de,_ as E}from"./index-DNOp9Mq_.js";import{r as x,b as oe}from"./router-GXfyPTrP.js";import{u as me,c as B,L as T,S as xe,d as he,e as je,f as pe,g as M}from"./useCustomQuery-DIWV-ZbL.js";import{B as y}from"./button-CadRtFnb.js";import{B as D}from"./badge-h25j2HHp.js";import{D as ue,a as fe,b as Ne,c as ye}from"./dialog-Zy9yw8Pe.js";import{U as ge}from"./users-DdDPZ_ud.js";import{B as be}from"./book-CQvx--Ic.js";import{T as ve}from"./tag-7_UfNHIG.js";import{B as we}from"./book-open-DIVT1uuZ.js";import{C as Ce}from"./calendar-FpXnkpMA.js";import{C as _}from"./clock-DAtTeGjW.js";import{U as ee}from"./user-CUlDVYds.js";import{F as R}from"./file-text-rK9265Qz.js";import{E as Se}from"./external-link-DZ4EkrqY.js";import{C as se}from"./circle-alert-DyUpdaYs.js";import{C as Me}from"./circle-check-big-DlVivG1r.js";import{C as Re}from"./circle-x-dT50D2Ki.js";import{f}from"./format-CWZx4aKk.js";import"./axios-DmypytPv.js";/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=w("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=w("ClipboardCheck",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=w("CornerUpRight",[["polyline",{points:"15 14 20 9 15 4",key:"1tbx3s"}],["path",{d:"M4 20v-7a4 4 0 0 1 4-4h12",key:"1lu4f8"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=w("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=w("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);function u({className:s,...l}){return e.jsx("div",{className:Q("animate-pulse rounded-md bg-primary/10",s),...l})}const U=x.forwardRef(({className:s,...l},a)=>e.jsx("textarea",{className:Q("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),ref:a,...l}));U.displayName="Textarea";const Ie={submitted:{color:"bg-blue-100 text-blue-800",icon:e.jsx(R,{className:"h-4 w-4"})},pending:{color:"bg-yellow-100 text-yellow-800",icon:e.jsx(_,{className:"h-4 w-4"})},under_review:{color:"bg-blue-100 text-blue-800",icon:e.jsx(se,{className:"h-4 w-4"})},accepted:{color:"bg-green-100 text-green-800",icon:e.jsx(Me,{className:"h-4 w-4"})},rejected:{color:"bg-red-100 text-red-800",icon:e.jsx(Re,{className:"h-4 w-4"})},revisions_required:{color:"bg-purple-100 text-purple-800",icon:e.jsx(R,{className:"h-4 w-4"})}},Ee=()=>e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(u,{className:"h-8 w-3/4"}),e.jsx(u,{className:"h-4 w-1/4"}),e.jsx(u,{className:"h-24 w-full"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(u,{className:"h-12 w-full"}),e.jsx(u,{className:"h-12 w-full"})]})]})}),Be=s=>{const l={color:"bg-gray-100 text-gray-800",icon:e.jsx(se,{className:"h-4 w-4"})};return s&&Ie[s]||l},Te=({message:s,authorName:l})=>{var a;return e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"bg-blue-100 rounded-full p-2 mr-3",children:e.jsx(ee,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-800",children:((a=s==null?void 0:s.reviewerId)==null?void 0:a.name)||"Anonymous Reviewer"}),e.jsx("p",{className:"text-xs text-gray-500",children:f(new Date(s==null?void 0:s.createdAt),"MMM dd, yyyy")})]}),e.jsx(D,{className:"bg-blue-100 text-blue-800 border-none",children:(s==null?void 0:s.messageType)||"Comment"})]}),e.jsx("p",{className:"text-gray-700 whitespace-pre-line",children:s==null?void 0:s.content}),(s==null?void 0:s.response)&&e.jsx("div",{className:"mt-3 ml-4 pl-3 border-l-2 border-gray-200",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(ke,{className:"h-4 w-4 text-gray-400 mr-2 mt-1"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-gray-500 mb-1",children:["Response from ",l||"Author"," Â· ",f(new Date(s==null?void 0:s.responseDate),"MMM dd, yyyy")]}),e.jsx("p",{className:"text-gray-700",children:s==null?void 0:s.response})]})]})})]})]})})},Le=({messages:s,loading:l,expanded:a,onToggle:r,authorName:d})=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer mb-2",onClick:r,children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 flex items-center",children:[e.jsx(Z,{className:"h-5 w-5 mr-2 text-blue-600"}),"Reviewer Messages (",(s==null?void 0:s.length)||0,")"]}),a?e.jsx(Ae,{className:"h-5 w-5 text-gray-500"}):e.jsx(de,{className:"h-5 w-5 text-gray-500"})]}),a&&e.jsx("div",{className:"space-y-4 mt-2",children:l?e.jsxs("div",{className:"space-y-4",children:[e.jsx(u,{className:"h-24 w-full"}),e.jsx(u,{className:"h-24 w-full"})]}):(s==null?void 0:s.length)>0?s.map((c,n)=>e.jsx(Te,{message:c,authorName:d},n)):e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx(Z,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{children:"No reviewer messages yet"})]})})]}),Ue=({author:s})=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[e.jsx(ee,{className:"h-5 w-5 mr-2 text-blue-600"}),"Author Information"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Name"}),e.jsx("p",{className:"text-gray-800",children:(s==null?void 0:s.fullName)||"Author information not available"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Email"}),e.jsx("p",{className:"text-gray-800",children:(s==null?void 0:s.email)||"Email not available"})]}),(s==null?void 0:s.affiliation)&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Affiliation"}),e.jsx("p",{className:"text-gray-800",children:s==null?void 0:s.affiliation})]})]})]}),_e=({manuscriptUrl:s,manuscriptFile:l})=>{const a=r=>{window.open(r,"_blank")};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[e.jsx(R,{className:"h-5 w-5 mr-2 text-blue-600"}),"Files"]}),e.jsx("div",{className:"space-y-4",children:s?e.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-blue-100 rounded-full p-2",children:e.jsx(R,{className:"h-4 w-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-800",children:"Manuscript"}),e.jsx("p",{className:"text-xs text-gray-500",children:l||"manuscript.pdf"})]})]}),e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>a(s),children:e.jsx(Se,{className:"h-4 w-4"})})]})}):e.jsx("div",{className:"text-center py-4 text-gray-500",children:e.jsx("p",{children:"No files available"})})})]})},Fe=({submission:s})=>{var c;const{reviewerAssignments:l=[],submissionDate:a,createdAt:r,status:d}=s||{};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[e.jsx(_,{className:"h-5 w-5 mr-2 text-blue-600"}),"Review Timeline"]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"relative pl-6 space-y-6 before:absolute before:left-2 before:top-0 before:h-full before:w-0.5 before:bg-gray-200",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -left-6 mt-1.5 h-3 w-3 rounded-full border-2 border-white bg-blue-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-blue-600",children:a?f(new Date(a),"MMM dd, yyyy"):""}),e.jsx("h3",{className:"text-sm font-medium text-gray-800",children:"SUBMISSION RECEIVED"}),((c=s==null?void 0:s.submittedBy)==null?void 0:c.fullName)&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Submitted by: ",s.submittedBy.fullName]})]})]}),(l==null?void 0:l.length)>0&&l.map((n,o)=>{var m;return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -left-6 mt-1.5 h-3 w-3 rounded-full border-2 border-white bg-blue-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-blue-600",children:n.commentedAt?f(new Date(n.commentedAt),"MMM dd, yyyy"):f(new Date,"MMM dd, yyyy")}),e.jsx("h3",{className:"text-sm font-medium text-gray-800",children:"REVIEWER ASSIGNED"}),((m=n.reviewer)==null?void 0:m.fullName)&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Reviewer: ",n.reviewer.fullName]}),n.comment&&e.jsxs("p",{className:"text-xs text-gray-600 mt-1 italic",children:['"',n.comment,'"']})]})]},o)}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -left-6 mt-1.5 h-3 w-3 rounded-full border-2 border-white bg-blue-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-blue-600",children:r?f(new Date(r),"MMM dd, yyyy"):""}),e.jsx("h3",{className:"text-sm font-medium text-gray-800",children:d?d.replace(/_/g," ").toUpperCase():"SUBMITTED"})]})]})]})})]})},$e=({reviewers:s,loading:l,open:a,onClose:r,onAssign:d})=>{const[c,n]=x.useState(null),[o,m]=x.useState(!1),h=async()=>{if(c){m(!0);try{await d(c)}finally{m(!1)}}};return e.jsx(ue,{open:a,onOpenChange:r,children:e.jsxs(fe,{children:[e.jsx(Ne,{children:e.jsx(ye,{children:"Assign Reviewer"})}),l?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(L,{className:"h-6 w-6 animate-spin"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Select Reviewer"}),e.jsxs("select",{className:"w-full p-2 border rounded-md",value:c||"",onChange:i=>n(i.target.value),children:[e.jsx("option",{value:"",children:"Select a reviewer"}),s==null?void 0:s.map(i=>e.jsxs("option",{value:i==null?void 0:i._id,children:[i==null?void 0:i.fullName," (",i==null?void 0:i.email,")"]},i==null?void 0:i._id))]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(y,{variant:"outline",onClick:r,children:"Cancel"}),e.jsxs(y,{disabled:!c||o,onClick:h,children:[o?e.jsx(L,{className:"h-4 w-4 animate-spin mr-2"}):null,"Assign"]})]})]})]})})},Oe=({submissionId:s,reviewRoundId:l,onSubmit:a})=>{const[r,d]=x.useState(""),[c,n]=x.useState(""),[o,m]=x.useState(""),[h,i]=x.useState(!1),g=async()=>{if(r){i(!0);try{await a({reviewRoundId:l,submissionId:s,recommendation:r,comments:c,confidentialComments:o})}finally{i(!1)}}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(T,{children:"Recommendation"}),e.jsxs(xe,{onValueChange:d,value:r,children:[e.jsx(he,{children:e.jsx(je,{placeholder:"Select recommendation"})}),e.jsxs(pe,{children:[e.jsx(M,{value:"accept",children:"Accept"}),e.jsx(M,{value:"minor_revisions",children:"Minor Revisions"}),e.jsx(M,{value:"major_revisions",children:"Major Revisions"}),e.jsx(M,{value:"reject",children:"Reject"})]})]})]}),e.jsxs("div",{children:[e.jsx(T,{children:"Comments to Author"}),e.jsx(U,{value:c,onChange:b=>n(b.target.value),placeholder:"Enter your comments for the author",rows:5})]}),e.jsxs("div",{children:[e.jsx(T,{children:"Confidential Comments to Editor"}),e.jsx(U,{value:o,onChange:b=>m(b.target.value),placeholder:"Enter confidential comments for the editor",rows:3})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(y,{disabled:!r||h,onClick:g,children:[h?e.jsx(L,{className:"h-4 w-4 animate-spin mr-2"}):null,"Submit Review"]})})]})};function rs(){var $,O,V,z,J,P,q,H,G,K,W,X;const s=me({}),{submissionId:l}=oe(),{user:a}=ce(),[r,d]=x.useState(!0),[c,n]=x.useState(!1),[o,m]=x.useState(!1),{data:h,isLoading:i}=B({api:`${($=v)==null?void 0:$.getSubmissionsById}/${l}`,options:{enabled:!!l}}),{data:g,isLoading:b}=B({api:`${(O=v)==null?void 0:O.getReviewerMessages}?submissionId=${l}`,options:{enabled:!!l}}),{data:A,isLoading:te}=B({api:`${(V=v)==null?void 0:V.getAvailableReviewers}?submissionId=${l}`,options:{enabled:!!l&&(a==null?void 0:a.role)==="Admin"}}),t=h==null?void 0:h.data,le=((z=g==null?void 0:g.data)==null?void 0:z.docs)||[],ae=((J=A==null?void 0:A.data)==null?void 0:J.docs)||[],C=(a==null?void 0:a.role)==="Reviewer",ie=((P=t==null?void 0:t.submittedBy)==null?void 0:P._id)===(a==null?void 0:a._id),k=(a==null?void 0:a.role)==="Admin",F=j=>{if(!j)return"N/A";try{return f(new Date(j),"MMM dd, yyyy")}catch{return"Invalid date"}},re=async j=>{var p,S;try{const I=await s.mutateAsync({api:v.assignReviewer,data:{submissionId:l,reviewerId:j}});(p=I.data)!=null&&p.success?(E.success("Reviewer assigned successfully"),window.location.reload()):E.error(((S=I.data)==null?void 0:S.message)||"Failed to assign reviewer")}catch{E.error("Something went wrong while assigning reviewer")}},ne=async j=>{var p;try{if(!(await fetch(`${(p=v)==null?void 0:p.submitReview}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(j)})).ok)throw new Error("Review submission failed");m(!1),window.location.reload()}catch{}};if(i)return e.jsx(Ee,{});const N=Be(t==null?void 0:t.status);return e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg shadow-md",children:[e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2 md:mb-0",children:t==null?void 0:t.title}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(D,{className:`${N==null?void 0:N.color} flex items-center gap-1 px-3 py-1 text-sm font-medium`,children:[N==null?void 0:N.icon,(q=t==null?void 0:t.status)==null?void 0:q.replace("_"," ").toUpperCase()]}),k&&e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>n(!0),children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Assign Reviewer"]}),C&&!o&&e.jsxs(y,{variant:"default",size:"sm",onClick:()=>m(!0),children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Submit Review"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[e.jsx(be,{className:"h-5 w-5 mr-2 text-blue-600"}),"Submission Details"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Abstract"}),e.jsx("p",{className:"text-gray-800 whitespace-pre-line",children:t==null?void 0:t.abstract})]}),((H=t==null?void 0:t.keywords)==null?void 0:H.length)>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(ve,{className:"h-4 w-4 mr-1 text-blue-600"}),"Keywords"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(G=t==null?void 0:t.keywords)==null?void 0:G.map((j,p)=>e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full",children:j},p))})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(we,{className:"h-4 w-4 mr-1 text-blue-600"}),"Journal"]}),e.jsx("p",{className:"text-gray-800",children:((K=t==null?void 0:t.journalId)==null?void 0:K.title)||"Journal information not available"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(Ce,{className:"h-4 w-4 mr-1 text-blue-600"}),"Submission Date"]}),e.jsx("p",{className:"text-gray-800",children:F((t==null?void 0:t.submissionDate)||(t==null?void 0:t.createdAt))})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-500 mb-1 flex items-center",children:[e.jsx(_,{className:"h-4 w-4 mr-1 text-blue-600"}),"Last Updated"]}),e.jsx("p",{className:"text-gray-800",children:F(t==null?void 0:t.updatedAt)})]})]})]})]}),(ie||C)&&e.jsx(Le,{messages:le,loading:b,expanded:r,onToggle:()=>d(!r),authorName:(W=t==null?void 0:t.submittedBy)==null?void 0:W.fullName}),C&&o&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-5",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[e.jsx(Y,{className:"h-5 w-5 mr-2 text-blue-600"}),"Submit Your Review"]}),e.jsx(Oe,{submissionId:l,reviewRoundId:(X=t==null?void 0:t.currentReviewRound)==null?void 0:X._id,onSubmit:ne})]})]}),e.jsxs("div",{className:"space-y-6",children:[(k||C)&&e.jsx(Ue,{author:t==null?void 0:t.submittedBy}),e.jsx(_e,{manuscriptUrl:t==null?void 0:t.fullManuscriptUrl,manuscriptFile:t==null?void 0:t.manuscriptFile}),e.jsx(Fe,{submission:t})]})]})]}),k&&e.jsx($e,{reviewers:ae,loading:te,open:c,onClose:()=>n(!1),onAssign:re})]})}export{rs as default};
