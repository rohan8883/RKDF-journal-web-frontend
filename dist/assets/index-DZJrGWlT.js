import{j as e,r as P,_ as C,B as E,S as ne,C as ce}from"./index-28nypth3.js";import{P as de}from"./index-DonUvE_z.js";import{r as f}from"./router-DMIetGpf.js";import{c as oe,d as ie,C as me,a as xe}from"./card-CvN-M-qi.js";import{T as pe,a as he,b as R,c as j,d as ue,e as h,P as je}from"./index-T0kutfHW.js";import{u as fe,k as ge,l as _,a as be,o as ve,F as Ne,n as Ie,R as z,B as ye,c as we,b,p as Se,T as ae}from"./useCustomQuery-DJCcqIQ9.js";import{R as Ce,S as se}from"./separator-BE2tWqEJ.js";import{R as Pe}from"./RHFUploadFiled-Dd6Xpbmf.js";import{D as Te}from"./index-BI5uV9xV.js";import{B as Me}from"./badge-Buxkn7MR.js";import{D as Fe,a as Ae,b as $e,c as te,S as le}from"./dropdown-menu-24AWFc5K.js";import{S as qe}from"./search-0i0XZ5Oq.js";import{C as Ee}from"./circle-plus-tIKXcEGq.js";import{f as re}from"./format-CWZx4aKk.js";import"./axios-DmypytPv.js";import"./check-BlNKLXrO.js";const ze=we().shape({journalId:b().required("Journal is required"),volume:b().required("Volume is required"),issueNumber:b().required("Issue number is required"),title:b().required("Title is required"),publicationDate:b().required("Publication date is required"),description:b(),coverImage:Se()});function Be({open:o,setOpen:v,title:c,id:N,edit:d,setEdit:I,refetch:T}){var A,$,q;const y=fe({}),B=ge({}),{data:l,isFetching:M}=_({api:`${P.getIssueById}/${N}`,options:{enabled:d}}),u=_({api:`${P.getAllJournal}?page=1&limit=100`,options:{enabled:!0}}),t=be({defaultValues:{journalId:"",volume:"",issueNumber:"",title:"",publicationDate:"",description:"",coverImage:null},resolver:ve(ze)}),F=async r=>{var i,m,x,p;try{const n=new FormData;if(n.append("journalId",r.journalId),n.append("volume",r.volume),n.append("issueNumber",r.issueNumber),n.append("title",r.title),n.append("publicationDate",r.publicationDate),r.description&&n.append("description",r.description),r.coverImage){const s=Array.isArray(r.coverImage)?r.coverImage[0]:r.coverImage;n.append("coverImage",s)}if(d&&N){const s=await B.mutateAsync({api:`${P.updateIssue}/${N}`,data:n,headers:{"Content-Type":"multipart/form-data"}});(i=s.data)!=null&&i.success?C.success((m=s==null?void 0:s.data)==null?void 0:m.message):C.error("Issue not updated successfully")}else{const s=await y.mutateAsync({api:P.createIssue,data:n,headers:{"Content-Type":"multipart/form-data"}});(x=s.data)!=null&&x.success?C.success((p=s==null?void 0:s.data)==null?void 0:p.message):C.error("Issue not created successfully")}v(!1),I&&I(!1),T&&T()}catch{C.error("Failed to submit the form")}};return f.useEffect(()=>{var r,i,m,x,p,n,s,w,S;d&&l?t.reset({journalId:((i=(r=l==null?void 0:l.data)==null?void 0:r.journalId)==null?void 0:i._id)||((m=l==null?void 0:l.data)==null?void 0:m.journalId),volume:(x=l==null?void 0:l.data)==null?void 0:x.volume,issueNumber:(p=l==null?void 0:l.data)==null?void 0:p.issueNumber,title:(n=l==null?void 0:l.data)==null?void 0:n.title,publicationDate:(w=(s=l==null?void 0:l.data)==null?void 0:s.publicationDate)==null?void 0:w.split("T")[0],description:(S=l==null?void 0:l.data)==null?void 0:S.description,coverImage:null}):t.reset({journalId:"",volume:"",issueNumber:"",title:"",publicationDate:"",description:"",coverImage:null})},[d,l,t.reset]),e.jsx(Te,{open:o,setOpen:v,title:c,setEdit:I,edit:d,isLoading:M,children:e.jsx(Ne,{methods:t,onSubmit:t.handleSubmit(F),children:e.jsxs("div",{className:"grid grid-cols-1 gap-x-2 gap-y-4",children:[e.jsx("div",{children:e.jsx(Ie,{name:"journalId",label:"Journal",data:(q=($=(A=u==null?void 0:u.data)==null?void 0:A.data)==null?void 0:$.docs)==null?void 0:q.map(r=>({label:r.title,value:r._id}))})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(z,{name:"volume",label:"Volume",placeholder:"Enter volume"}),e.jsx(z,{name:"issueNumber",label:"Issue Number",placeholder:"Enter issue number"})]}),e.jsx("div",{children:e.jsx(z,{name:"title",label:"Title",placeholder:"Enter title"})}),e.jsx("div",{children:e.jsx(z,{name:"publicationDate",label:"Publication Date",placeholder:"YYYY-MM-DD",type:"date"})}),e.jsx("div",{children:e.jsx(Ce,{name:"description",label:"Description",placeholder:"Enter description"})}),e.jsx("div",{children:e.jsx(Pe,{name:"coverImage",label:"Cover Image",accept:"image/*"})}),e.jsx(se,{}),e.jsx("div",{children:e.jsx(ye,{isLoading:t.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Submit"})})]})})})}function Re(){var r,i,m,x,p,n,s,w,S,k,D,H,V,L,J,Y,G,K,O,Q,U,W,X,Z;const[o,v]=f.useState(1),[c,N]=f.useState(10),[d,I]=f.useState(""),[T,y]=f.useState(!1),[B,l]=f.useState(""),[M,u]=f.useState(!1),t=_({api:`${P.getAllIssue}?page=${o}&limit=${c}&q=${d}`,key:"getAllIssues",value:[o,c,d],options:{enabled:!0}}),F=a=>{y(!0),u(!0),l(a)},A=a=>{I(a.target.value)},$=a=>{a.preventDefault(),v(1),t.refetch()},q=({issue:a})=>{var g;return e.jsx(me,{className:"mb-4",children:e.jsxs(xe,{className:"pt-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:a==null?void 0:a.title}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(g=a==null?void 0:a.journal)==null?void 0:g.title," â€¢ Vol. ",a==null?void 0:a.volume,", No. ",a==null?void 0:a.issueNumber]})]}),e.jsx(Me,{variant:"outline",children:re(new Date(a==null?void 0:a.publicationDate),"MMM d, yyyy")})]}),(a==null?void 0:a.description)&&e.jsx("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:a.description}),e.jsx("div",{className:"flex justify-between items-center mt-2",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(E,{size:"sm",onClick:()=>F(a==null?void 0:a._id),className:"flex items-center gap-1",children:[e.jsx(le,{size:14})," Edit"]}),e.jsxs(E,{size:"sm",variant:"destructive",className:"flex items-center gap-1",children:[e.jsx(ae,{size:14})," Delete"]})]})})]})})};return e.jsxs("main",{className:"container mx-auto px-4 py-6",children:[e.jsx(Be,{open:T,setOpen:y,title:M?"Edit Issue":"Add Issue",id:B,edit:M,setEdit:u,refetch:t.refetch}),e.jsx("div",{className:"bg-white rounded-lg shadow",children:e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6",children:[e.jsx(oe,{className:"text-xl font-bold",children:"Issue Management"}),e.jsxs("div",{className:"flex flex-col sm:flex-row w-full md:w-auto gap-3",children:[e.jsxs("form",{onSubmit:$,className:"relative w-full sm:w-64",children:[e.jsx("input",{type:"text",placeholder:"Search issues...",value:d,onChange:A,className:"w-full h-10 pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"}),e.jsx(qe,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"})]}),e.jsxs(E,{className:"flex items-center gap-2 whitespace-nowrap",onClick:()=>{u(!1),l(""),y(!0)},children:[e.jsx(Ee,{size:18}),"Add Issue"]})]})]}),e.jsxs(ie,{className:"mb-4",children:["Total Issues: ",((i=(r=t.data)==null?void 0:r.data)==null?void 0:i.totalDocs)||0]}),t.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(ne,{})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs(pe,{children:[e.jsx(he,{children:e.jsxs(R,{children:[e.jsx(j,{className:"w-12",children:"#"}),e.jsx(j,{children:"Journal"}),e.jsx(j,{children:"Title"}),e.jsx(j,{children:"Volume"}),e.jsx(j,{children:"Issue"}),e.jsx(j,{children:"Publication Date"}),e.jsx(j,{className:"text-right",children:"Actions"})]})}),e.jsx(ue,{children:((p=(x=(m=t==null?void 0:t.data)==null?void 0:m.data)==null?void 0:x.docs)==null?void 0:p.length)===0?e.jsx(R,{children:e.jsx(h,{colSpan:7,className:"text-center py-8",children:"No issues found"})}):(w=(s=(n=t==null?void 0:t.data)==null?void 0:n.data)==null?void 0:s.docs)==null?void 0:w.map((a,g)=>{var ee;return e.jsxs(R,{children:[e.jsx(h,{children:o*c-c+g+1}),e.jsx(h,{className:"font-medium",children:(ee=a==null?void 0:a.journal)==null?void 0:ee.title}),e.jsx(h,{children:a==null?void 0:a.title}),e.jsxs(h,{children:["Vol. ",a==null?void 0:a.volume]}),e.jsxs(h,{children:["No. ",a==null?void 0:a.issueNumber]}),e.jsx(h,{children:re(new Date(a==null?void 0:a.publicationDate),"MMM d, yyyy")}),e.jsx(h,{className:"text-right",children:e.jsxs(Fe,{children:[e.jsx(Ae,{asChild:!0,children:e.jsxs(E,{variant:"outline",size:"sm",className:"h-8 ml-auto flex items-center gap-1",children:["Actions ",e.jsx(ce,{size:14})]})}),e.jsxs($e,{align:"end",children:[e.jsxs(te,{onClick:()=>F(a==null?void 0:a._id),children:[e.jsx(le,{size:14,className:"mr-2"})," Edit"]}),e.jsxs(te,{className:"text-red-600",children:[e.jsx(ae,{size:14,className:"mr-2"})," Delete"]})]})]})})]},a==null?void 0:a._id)})})]})}),e.jsx("div",{className:"md:hidden",children:((D=(k=(S=t==null?void 0:t.data)==null?void 0:S.data)==null?void 0:k.docs)==null?void 0:D.length)===0?e.jsx("div",{className:"text-center py-8",children:"No issues found"}):(L=(V=(H=t==null?void 0:t.data)==null?void 0:H.data)==null?void 0:V.docs)==null?void 0:L.map((a,g)=>e.jsx(q,{issue:a,index:g},a==null?void 0:a._id))}),e.jsx(se,{className:"my-4"}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",(o-1)*c+1," to ",Math.min(o*c,((Y=(J=t==null?void 0:t.data)==null?void 0:J.data)==null?void 0:Y.totalDocs)||0)," of ",((K=(G=t==null?void 0:t.data)==null?void 0:G.data)==null?void 0:K.totalDocs)||0," entries"]}),e.jsx(je,{page:o,perPage:c,totalPage:(Q=(O=t==null?void 0:t.data)==null?void 0:O.data)==null?void 0:Q.totalDocs,hasNextPage:(W=(U=t==null?void 0:t.data)==null?void 0:U.data)==null?void 0:W.hasNextPage,hasPrevPage:(Z=(X=t==null?void 0:t.data)==null?void 0:X.data)==null?void 0:Z.hasPrevPage,setPage:v,setPerPage:N})]})]})]})})]})}function ea(){return e.jsx(de,{title:"Issue List",children:e.jsx("div",{children:e.jsx(Re,{})})})}export{ea as default};
